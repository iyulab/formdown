"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[396],{3396:(e,t,r)=>{r.d(t,{A:()=>C,FM:()=>d,getSchema:()=>T,R7:()=>h,F3:()=>u,jr:()=>A,l:()=>I});class i{register(e){let t=this.hooks.get(e.name)||[];t.push(e),t.sort((e,t)=>t.priority-e.priority),this.hooks.set(e.name,t),this.emit("hook-registered",{hook:e.name,priority:e.priority}),this.options.debug&&console.debug("[Formdown] Hook registered: ".concat(e.name," (priority: ").concat(e.priority,")"))}unregister(e,t){let r=this.hooks.get(e)||[],i=r.filter(e=>e.handler!==t);i.length!==r.length&&(this.hooks.set(e,i),this.emit("hook-unregistered",{hook:e}),this.options.debug&&console.debug("[Formdown] Hook unregistered: ".concat(e)))}async execute(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];let a=this.hooks.get(e)||[],s=[];for(let r of(this.emit("hooks-executing",{hook:e,count:a.length}),a)){let n=null;try{n=this.options.timeout?this.createTimeoutPromise(this.options.timeout):null;let a=Promise.resolve(r.handler(t,...i)),o=n?await Promise.race([a,n.promise]):await a;null==n||n.cleanup(),void 0!==o&&s.push(o),this.emit("hook-executed",{hook:e,success:!0})}catch(t){null==n||n.cleanup(),this.handleHookError(e,t)}}return this.emit("hooks-completed",{hook:e,results:s.length}),s}executeSync(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];let a=this.hooks.get(e)||[],s=[];for(let r of(this.emit("hooks-executing",{hook:e,count:a.length}),a))try{let n=r.handler(t,...i);void 0!==n&&s.push(n),this.emit("hook-executed",{hook:e,success:!0})}catch(t){this.handleHookError(e,t)}return this.emit("hooks-completed",{hook:e,results:s.length}),s}clear(e){e?(this.hooks.delete(e),this.emit("hooks-cleared",{hook:e})):(this.hooks.clear(),this.emit("hooks-cleared",{all:!0})),this.options.debug&&console.debug("[Formdown] Hooks cleared: ".concat(e||"all"))}getHooks(e){return[...this.hooks.get(e)||[]]}getHookNames(){return Array.from(this.hooks.keys())}getHookCount(){return Array.from(this.hooks.values()).reduce((e,t)=>e+t.length,0)}createTimeoutPromise(e){let t;return{promise:new Promise((r,i)=>{t=setTimeout(()=>{i(Error("Hook execution timeout after ".concat(e,"ms")))},e)}),cleanup:()=>{clearTimeout(t)}}}handleHookError(e,t){let r="Hook execution failed: ".concat(e," - ").concat(t.message||t);switch(this.emit("hook-error",{hook:e,error:r}),this.options.errorStrategy){case"ignore":break;case"warn":console.warn("[Formdown] ".concat(r));break;default:throw Error(r)}}emit(e,t){if(this.eventEmitter){let r={type:e,data:t,timestamp:Date.now()};this.eventEmitter.emit(e,r)}}constructor(e={},t){this.options=e,this.hooks=new Map,this.eventEmitter=t}}class n{async register(e){if(this.plugins.has(e.metadata.name))throw Error("Plugin '".concat(e.metadata.name,"' is already registered"));if(await this.validateDependencies(e),this.plugins.set(e.metadata.name,e),e.hooks)for(let t of e.hooks)this.hookManager.register(t);if(e.fieldTypes)for(let r of e.fieldTypes){var t;this.fieldTypes.set(r.type,r),null==(t=this.fieldTypeRegistry)||t.register(r)}if(e.validators)for(let t of e.validators)this.validators.set(t.name,t);if(e.renderers)for(let t of e.renderers)this.renderers.set(t.template,t);if(e.themes)for(let t of e.themes)this.themes.set(t.name,t);if(this.emit("plugin-registered",{plugin:e.metadata.name,version:e.metadata.version}),this.options.debug&&console.debug("[Formdown] Plugin registered: ".concat(e.metadata.name," v").concat(e.metadata.version)),this.initialized&&e.initialize)try{await e.initialize(),this.emit("plugin-initialized",{plugin:e.metadata.name})}catch(t){this.handlePluginError(e.metadata.name,"initialization",t)}}async unregister(e){let t=this.plugins.get(e);if(t){if(t.destroy)try{await t.destroy(),this.emit("plugin-destroyed",{plugin:e})}catch(t){this.handlePluginError(e,"cleanup",t)}if(t.hooks)for(let e of t.hooks)this.hookManager.unregister(e.name,e.handler);if(t.fieldTypes)for(let e of t.fieldTypes){var r;this.fieldTypes.delete(e.type),null==(r=this.fieldTypeRegistry)||r.unregister(e.type)}if(t.validators)for(let e of t.validators)this.validators.delete(e.name);if(t.renderers)for(let e of t.renderers)this.renderers.delete(e.template);if(t.themes)for(let e of t.themes)this.themes.delete(e.name);this.plugins.delete(e),this.emit("plugin-unregistered",{plugin:e}),this.options.debug&&console.debug("[Formdown] Plugin unregistered: ".concat(e))}}get(e){return this.plugins.get(e)}getAll(){return Array.from(this.plugins.values())}isRegistered(e){return this.plugins.has(e)}async initialize(){if(this.initialized)return;this.emit("plugins-initializing",{count:this.plugins.size});let e=[];for(let t of this.plugins.values())t.initialize&&e.push(Promise.resolve(t.initialize()).catch(e=>this.handlePluginError(t.metadata.name,"initialization",e)));await Promise.all(e),this.initialized=!0,this.emit("plugins-initialized",{count:this.plugins.size}),this.options.debug&&console.debug("[Formdown] ".concat(this.plugins.size," plugins initialized"))}async destroy(){if(!this.initialized)return;this.emit("plugins-destroying",{count:this.plugins.size});let e=[];for(let t of this.plugins.values())t.destroy&&e.push(Promise.resolve(t.destroy()).catch(e=>this.handlePluginError(t.metadata.name,"cleanup",e)));await Promise.all(e),this.plugins.clear(),this.fieldTypes.clear(),this.validators.clear(),this.renderers.clear(),this.themes.clear(),this.initialized=!1,this.emit("plugins-destroyed",{count:0}),this.options.debug&&console.debug("[Formdown] All plugins destroyed and cleared")}getFieldTypes(){return new Map(this.fieldTypes)}getFieldType(e){return this.fieldTypes.get(e)}hasFieldType(e){return this.fieldTypes.has(e)}getValidators(){return new Map(this.validators)}getRenderers(){return new Map(this.renderers)}getThemes(){return new Map(this.themes)}async validateDependencies(e){if(e.metadata.dependencies){for(let t of e.metadata.dependencies)if(!this.isRegistered(t))throw Error("Plugin '".concat(e.metadata.name,"' requires dependency '").concat(t,"' which is not registered"))}}handlePluginError(e,t,r){let i="Plugin ".concat(t," failed: ").concat(e," - ").concat(r.message||r);switch(this.emit("plugin-error",{plugin:e,operation:t,error:i}),this.options.errorStrategy){case"ignore":break;case"warn":console.warn("[Formdown] ".concat(i));break;default:throw Error(i)}}emit(e,t){this.eventEmitter&&this.eventEmitter.emit(e,t)}constructor(e,t={},r,i){this.hookManager=e,this.options=t,this.eventEmitter=r,this.fieldTypeRegistry=i,this.plugins=new Map,this.fieldTypes=new Map,this.validators=new Map,this.renderers=new Map,this.themes=new Map,this.initialized=!1}}class a{on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){let r=this.listeners.get(e);r&&(r.delete(t),0===r.size&&this.listeners.delete(e))}emit(e,t){let r=this.listeners.get(e);if(!r)return;let i={type:e,data:t,timestamp:Date.now()};for(let t of r)try{t(i)}catch(t){console.error("[Formdown] Event listener error in '".concat(e,"':"),t)}}once(e,t){let r=e=>{t(e),this.off(e.type,r)};this.on(e,r)}removeAllListeners(e){e?this.listeners.delete(e):this.listeners.clear()}listenerCount(e){var t;return(null==(t=this.listeners.get(e))?void 0:t.size)||0}eventNames(){return Array.from(this.listeners.keys())}constructor(){this.listeners=new Map}}class s{register(e){if(this.fieldTypes.has(e.type))throw Error("Field type '".concat(e.type,"' is already registered"));this.fieldTypes.set(e.type,e),e.styles&&this.styleCache.set(e.type,e.styles),e.clientScript&&this.scriptCache.set(e.type,e.clientScript)}unregister(e){this.fieldTypes.delete(e),this.styleCache.delete(e),this.scriptCache.delete(e)}get(e){return this.fieldTypes.get(e)}has(e){return this.fieldTypes.has(e)}getAll(){return new Map(this.fieldTypes)}parseField(e,t){for(let r of this.fieldTypes.values())if(r.parser){let i=r.parser(e,t);if(i)return r.defaultAttributes&&(i.attributes={...r.defaultAttributes,...i.attributes}),i}return null}generateFieldHTML(e,t){let r=this.fieldTypes.get(e.type);return(null==r?void 0:r.generator)?r.generator(e,t):null}validateField(e,t){let r=this.fieldTypes.get(e.type);return(null==r?void 0:r.validator)?r.validator(e,t):[]}processFieldData(e,t,r){var i,n,a,s,o,l,c,d;let u=this.fieldTypes.get(e.type),h=null==u?void 0:u.dataProcessor;if(!h)return t;switch(r){case"input":return null!=(n=null==(i=h.processInput)?void 0:i.call(h,t,e))?n:t;case"output":return null!=(s=null==(a=h.processOutput)?void 0:a.call(h,t,e))?s:t;case"serialize":return null!=(l=null==(o=h.serialize)?void 0:o.call(h,t,e))?l:t;case"deserialize":return null!=(d=null==(c=h.deserialize)?void 0:c.call(h,t,e))?d:t;default:return t}}validateFieldData(e,t){let r=this.fieldTypes.get(e.type),i=null==r?void 0:r.dataProcessor;return(null==i?void 0:i.validate)?i.validate(t,e):{valid:!0}}generateFieldSchema(e){let t=this.fieldTypes.get(e.type);return(null==t?void 0:t.schemaGenerator)?t.schemaGenerator(e):null}getAllStyles(){return Array.from(this.styleCache.values()).join("\n")}getStylesForTypes(e){return e.map(e=>this.styleCache.get(e)).filter(Boolean).join("\n")}getAllScripts(){return Array.from(this.scriptCache.values()).join("\n")}getScriptsForTypes(e){return e.map(e=>this.scriptCache.get(e)).filter(Boolean).join("\n")}getStats(){return{registeredTypes:Array.from(this.fieldTypes.keys()),totalTypes:this.fieldTypes.size,typesWithStyles:Array.from(this.styleCache.keys()),typesWithScripts:Array.from(this.scriptCache.keys())}}clear(){this.fieldTypes.clear(),this.styleCache.clear(),this.scriptCache.clear()}constructor(){this.fieldTypes=new Map,this.styleCache=new Map,this.scriptCache=new Map}}new s;let o={metadata:{name:"formdown-core",version:"1.0.0",description:"Built-in field types and validators for Formdown",author:"Formdown Team"},fieldTypes:[{type:"text",parser:e=>{let t=e.match(/@(\w+):\s*\[text\](.*)/);if(!t)return null;let[,r,i]=t,n=l(i);return{name:r,type:"text",label:n.label||r,required:n.required||!1,placeholder:n.placeholder,pattern:n.pattern,attributes:n}},validator:(e,t)=>{let r=[];return e.required&&(!t||""===t.trim())&&r.push({type:"required",message:"".concat(e.label," is required")}),e.pattern&&t&&!new RegExp(e.pattern).test(t)&&r.push({type:"pattern",value:e.pattern,message:"".concat(e.label," does not match the required pattern")}),r},generator:e=>{let t=['type="text"','name="'.concat(e.name,'"'),'id="'.concat(e.name,'"'),e.placeholder?'placeholder="'.concat(e.placeholder,'"'):"",e.required?"required":"",e.pattern?'pattern="'.concat(e.pattern,'"'):""].filter(Boolean).join(" ");return"<input ".concat(t," />")}},{type:"email",parser:e=>{let t=e.match(/@(\w+):\s*\[email\](.*)/);if(!t)return null;let[,r,i]=t,n=l(i);return{name:r,type:"email",label:n.label||r,required:n.required||!1,placeholder:n.placeholder,attributes:n}},validator:(e,t)=>{let r=[];return e.required&&(!t||""===t.trim())&&r.push({type:"required",message:"".concat(e.label," is required")}),t&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)&&r.push({type:"pattern",message:"".concat(e.label," must be a valid email address")}),r},generator:e=>{let t=['type="email"','name="'.concat(e.name,'"'),'id="'.concat(e.name,'"'),e.placeholder?'placeholder="'.concat(e.placeholder,'"'):"",e.required?"required":""].filter(Boolean).join(" ");return"<input ".concat(t," />")}},{type:"select",parser:e=>{let t=e.match(/@(\w+):\s*\[select\](.*)/);if(!t)return null;let[,r,i]=t,n=l(i),a=function(e){let t=e.match(/options=\[([^\]]*)\]/);return t?t[1].split(",").map(e=>e.trim().replace(/"/g,"")).filter(Boolean):[]}(i);return{name:r,type:"select",label:n.label||r,required:n.required||!1,options:a,allowOther:n.allowOther||!1,attributes:n}},generator:e=>{let t=['name="'.concat(e.name,'"'),'id="'.concat(e.name,'"'),e.required?"required":""].filter(Boolean).join(" "),r=(e.options||[]).map(e=>'<option value="'.concat(e,'">').concat(e,"</option>")).join("\n");return"<select ".concat(t,">\n").concat(r,"\n</select>")}},{type:"range",parser:(e,t)=>{for(let t of[/@(\w+)(?:\(([^)]+)\))?\s*:\s*\[range\](.*)/,/@(\w+)(?:\(([^)]+)\))?\s*:\s*\[range\s+([^\]]+)\](.*)/]){let r=e.match(t);if(r){let[,e,t,i="",n=""]=r,a=function(e){let t={},r=e.match(/min=(\d+)/);r&&(t.min=parseInt(r[1]));let i=e.match(/max=(\d+)/);i&&(t.max=parseInt(i[1]));let n=e.match(/step=(\d+\.?\d*)/);n&&(t.step=parseFloat(n[1]));let a=e.match(/value=(\d+\.?\d*)/);a&&(t.value=parseFloat(a[1]));let s=e.match(/unit="([^"]*)"/);s&&(t.unit=s[1]),e.includes("hideValue")&&(t.showValue=!1),e.includes("required")&&(t.required=!0);let o=e.match(/label="([^"]*)"/);return o&&(t.label=o[1]),t}((i||"")+(n||""));return{name:e,type:"range",label:t||a.label||e.split(/[_-]/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),required:a.required||!1,attributes:{min:a.min||0,max:a.max||100,step:a.step||1,value:a.value||Math.floor(((a.min||0)+(a.max||100))/2),showValue:!1!==a.showValue,unit:a.unit||"",...a}}}}return null},validator:(e,t)=>{let r=[],i=Number(t);if(e.required&&(null==t||""===t)&&r.push({type:"required",message:"".concat(e.label," is required")}),null!=t&&""!==t)if(isNaN(i))r.push({type:"type",message:"".concat(e.label," must be a number")});else{var n,a,s;let t=(null==(n=e.attributes)?void 0:n.min)||0,o=(null==(a=e.attributes)?void 0:a.max)||100;i<t&&r.push({type:"min",value:t,message:"".concat(e.label," must be at least ").concat(t)}),i>o&&r.push({type:"max",value:o,message:"".concat(e.label," must be at most ").concat(o)});let l=(null==(s=e.attributes)?void 0:s.step)||1;l>0&&(i-t)%l!=0&&r.push({type:"step",value:l,message:"".concat(e.label," must be a multiple of ").concat(l)})}return r},generator:(e,t)=>{var r;let{name:i,label:n,required:a,attributes:s={}}=e,{min:o=0,max:l=100,step:c=1,value:d=Math.floor((o+l)/2),showValue:u=!0,unit:h=""}=s,p="".concat(i,"-output"),m=null==(r=t.metadata)?void 0:r.formId,f=Object.entries({type:"range",id:i,name:i,min:o,max:l,step:c,value:d,...a&&{required:!0},...m&&{form:m},...Object.fromEntries(Object.entries(s).filter(e=>{let[t]=e;return!["min","max","step","value","showValue","unit","label"].includes(t)}))}).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" "),g=u?'<output id="'.concat(p,'" for="').concat(i,'" class="formdown-range-output">').concat(d).concat(h,"</output>"):"";return'\n<div class="formdown-field formdown-range-field">\n    <label for="'.concat(i,'">').concat(n).concat(a?" *":"",'</label>\n    <div class="formdown-range-container">\n        <input ').concat(f," oninput=\"document.getElementById('").concat(p,"').textContent = this.value + '").concat(h,"'\">\n        ").concat(g,"\n    </div>\n</div>")},dataProcessor:{processInput:(e,t)=>{let r=Number(e);return isNaN(r)?null:r},processOutput:(e,t)=>{var r;if(null==e)return"";let i=(null==(r=t.attributes)?void 0:r.unit)||"";return"".concat(e).concat(i)},validate:(e,t)=>{let r=Number(e);return null!=e&&""!==e&&isNaN(r)?{valid:!1,error:"Value must be a number"}:{valid:!0}},serialize:(e,t)=>String(e),deserialize:(e,t)=>{let r=Number(e);return isNaN(r)?null:r}},schemaGenerator:e=>{var t,r,i;let n={type:"number",minimum:(null==(t=e.attributes)?void 0:t.min)||0,maximum:(null==(r=e.attributes)?void 0:r.max)||100};return(null==(i=e.attributes)?void 0:i.step)&&(n.multipleOf=e.attributes.step),e.required&&(n.required=!0),e.label&&(n.title=e.label),n},styles:'\n        .formdown-range-field .formdown-range-container {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n        \n        .formdown-range-field input[type="range"] {\n            flex: 1;\n            min-width: 100px;\n        }\n        \n        .formdown-range-output {\n            min-width: 60px;\n            text-align: center;\n            font-weight: 600;\n            padding: 4px 8px;\n            background: #f5f5f5;\n            border-radius: 4px;\n            font-family: monospace;\n        }\n        \n        .formdown-range-field label {\n            display: block;\n            margin-bottom: 8px;\n            font-weight: 500;\n        }\n    ',clientScript:"\n        // Enhanced range field interactions\n        document.addEventListener('DOMContentLoaded', function() {\n            const rangeFields = document.querySelectorAll('.formdown-range-field input[type=\"range\"]');\n            \n            rangeFields.forEach(function(input) {\n                // Add keyboard navigation enhancement\n                input.addEventListener('keydown', function(e) {\n                    const step = parseFloat(this.step) || 1;\n                    const currentValue = parseFloat(this.value);\n                    \n                    if (e.key === 'ArrowLeft' || e.key === 'ArrowDown') {\n                        e.preventDefault();\n                        this.value = Math.max(parseFloat(this.min), currentValue - step);\n                        this.dispatchEvent(new Event('input', { bubbles: true }));\n                    } else if (e.key === 'ArrowRight' || e.key === 'ArrowUp') {\n                        e.preventDefault();\n                        this.value = Math.min(parseFloat(this.max), currentValue + step);\n                        this.dispatchEvent(new Event('input', { bubbles: true }));\n                    }\n                });\n                \n                // Add visual feedback on interaction\n                input.addEventListener('input', function() {\n                    this.classList.add('active');\n                    setTimeout(() => this.classList.remove('active'), 150);\n                });\n            });\n        });\n    ",defaultAttributes:{min:0,max:100,step:1,showValue:!0}}],validators:[{name:"required",validate:e=>null!=e&&""!==e,getMessage:(e,t)=>e.message||"".concat(t.label," is required")},{name:"pattern",validate:(e,t)=>!e||!t.value||new RegExp(t.value).test(e),getMessage:(e,t)=>e.message||"".concat(t.label," does not match the required pattern")},{name:"minlength",validate:(e,t)=>!e||e.length>=(t.value||0),getMessage:(e,t)=>e.message||"".concat(t.label," must be at least ").concat(e.value," characters long")}]};function l(e){let t={};e.includes("required")&&(t.required=!0);let r=e.match(/placeholder="([^"]*)"/);r&&(t.placeholder=r[1]);let i=e.match(/label="([^"]*)"/);i&&(t.label=i[1]);let n=e.match(/pattern="([^"]*)"/);return n&&(t.pattern=n[1]),e.includes("allowOther")&&(t.allowOther=!0),t}class c{async initialize(){if(!this.initialized){this.eventEmitter.emit("extension-system-initializing");try{await this.pluginManager.register(o),await this.pluginManager.initialize(),this.initialized=!0,this.eventEmitter.emit("extension-system-initialized"),this.context.options.debug&&console.debug("[Formdown] Extension system initialized")}catch(e){throw this.eventEmitter.emit("extension-system-error",{phase:"initialization",error:e instanceof Error?e.message:String(e)}),e}}}async destroy(){if(this.initialized){this.eventEmitter.emit("extension-system-destroying");try{await this.pluginManager.destroy(),this.hookManager.clear(),this.eventEmitter.removeAllListeners(),this.initialized=!1,this.eventEmitter.emit("extension-system-destroyed"),this.context.options.debug&&console.debug("[Formdown] Extension system destroyed")}catch(e){throw this.eventEmitter.emit("extension-system-error",{phase:"destruction",error:e instanceof Error?e.message:String(e)}),e}}}async registerPlugin(e){return this.ensureInitialized(),this.pluginManager.register(e)}async unregisterPlugin(e){return this.ensureInitialized(),this.pluginManager.unregister(e)}registerHook(e){this.ensureInitialized(),this.hookManager.register(e)}async executeHooks(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return this.ensureInitialized(),this.hookManager.execute(e,t,...i)}executeHooksSync(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return this.ensureInitialized(),this.hookManager.executeSync(e,t,...i)}getContext(){return{...this.context}}getFieldTypeRegistry(){return this.fieldTypeRegistry}getEventEmitter(){return this.eventEmitter}getStats(){return{initialized:this.initialized,plugins:this.pluginManager.getAll().map(e=>({name:e.metadata.name,version:e.metadata.version})),hookCount:this.hookManager.getHookCount(),registeredHooks:this.hookManager.getHookNames(),fieldTypes:Array.from(this.pluginManager.getFieldTypes().keys()),validators:Array.from(this.pluginManager.getValidators().keys()),renderers:Array.from(this.pluginManager.getRenderers().keys()),themes:Array.from(this.pluginManager.getThemes().keys())}}enableDebug(){this.context.options.debug=!0,console.debug("[Formdown] Debug mode enabled"),console.debug("[Formdown] Extension system stats:",this.getStats())}disableDebug(){this.context.options.debug=!1}setupErrorHandling(){this.eventEmitter.on("hook-error",e=>{this.context.options.debug&&console.error("[Formdown] Hook error:",e.data)}),this.eventEmitter.on("plugin-error",e=>{this.context.options.debug&&console.error("[Formdown] Plugin error:",e.data)}),this.eventEmitter.on("extension-system-error",e=>{console.error("[Formdown] Extension system error:",e.data)})}ensureInitialized(){if(!this.initialized)throw Error("Extension system must be initialized before use")}constructor(e={}){this.initialized=!1;let t={async:!0,timeout:1e3,errorStrategy:"warn",debug:!1,...e};this.eventEmitter=new a,this.hookManager=new i(t,this.eventEmitter),this.fieldTypeRegistry=new s,this.pluginManager=new n(this.hookManager,t,this.eventEmitter,this.fieldTypeRegistry),this.context={hooks:this.hookManager,plugins:this.pluginManager,fieldTypes:this.fieldTypeRegistry,options:t},this.setupErrorHandling()}}let d=new c;async function u(e){return d.registerPlugin(e)}function h(e){return d.registerHook(e)}class p{parseFormdown(e){this.formDeclarations=[],this.datalistDeclarations=[],this.currentFormId=null,this.formCounter=1,this.defaultFormCreated=!1;let{fields:t,cleanedMarkdown:r}=this.extractFields(e);return{markdown:this.options.preserveMarkdown?r:"",forms:t,formDeclarations:this.formDeclarations,datalistDeclarations:this.datalistDeclarations}}parse(e){let{fields:t}=this.extractFields(e);return{fields:t,errors:[]}}extractFields(e){let t=[],r=e.split("\n"),i=[];for(let e=0;e<r.length;e++){let n=r[e],a=this.parseFormDeclaration(n);if(a){this.formDeclarations.push(a),this.currentFormId=a.id,i.push("");continue}let s=this.parseDatalistDeclaration(n);if(s){this.datalistDeclarations.push(s),i.push("");continue}let o=this.parseBlockField(n);if(o){this.associateFieldWithForm(o),t.push(o),i.push("\x3c!--FORMDOWN_FIELD_".concat(t.length-1,"--\x3e"));continue}let{cleanedLine:l,inlineFields:c}=this.parseInlineFields(n);c.forEach(e=>this.associateFieldWithForm(e)),t.push(...c),i.push(l)}return{fields:t,cleanedMarkdown:i.join("\n")}}parseBlockField(e){let t=e.trim(),r=d.getFieldTypeRegistry().parseField(t,{input:t});if(r)return r;let i=this.parseActionElement(t);if(i)return i;if(/^@\w+\*/.test(t)||/^@\w+\{.*?\}/.test(t)||/^@\w+\s*:\s*(dt|d|[#@%&t?TrscRFCMW$])\d*\[/.test(t)||/^@\w+\([^)]+\)\*/.test(t)||/^@\w+\([^)]+\)\{.*?\}/.test(t)||/^@\w+\([^)]+\)\s*:\s*(dt|d|[#@%&t?TrscRFCMW$])\d*\[/.test(t)){let e=this.parseShorthandBlockField(t);if(e)return e}let n=t.match(/^@(\w+)(?:\(([^)]+)\))?\s*:\s*\[([^\]]*)\].*$/);if(!n)return null;let[,a,s,o]=n;return this.createField(a,s,o)}parseShorthandBlockField(e){let t=e.match(/^@(\w+)(\*)?(?:\{(.*?)\})?(?:\(([^)]+)\))?\s*:\s*(dt|d|[#@%&t?TrscRFCMW$])?(\d*)\[([^\]]*)\].*$/);if(!t&&(t=e.match(/^@(\w+)(?:\(([^)]+)\))?(\*)?(?:\{(.*?)\})?\s*:\s*(dt|d|[#@%&t?TrscRFCMW$])?(\d*)\[([^\]]*)\].*$/))){let[,e,r,i,n,a,s,o]=t;t=[t[0],e,i,n,r,a,s,o]}if(!t)return null;let[,r,i,n,a,s,o,l]=t;return i||void 0!==n||a||s||o?this.convertShorthandToField(r,i,n,a,s||"",o,l):null}parseInlineFields(e){let t=[],r=this.options.inlineFieldDelimiter,i=RegExp("(dt|d|[#@%&t?TrscRFCMW$]?)".concat(r,"@(\\w+)(\\*)?(?:\\{(.*?)\\})?(?:\\(([^)]+)\\))?(?:\\[([^\\]]*)\\])?"),"g"),n=e.replace(i,(e,r,i,n,a,s,o)=>{if(!r&&!n&&!a)return e;let l=this.convertShorthandToField(i,n,a,s,r,"",o||"");if(l){l.inline=!0,t.push(l);let e=l.required?' data-required="true"':"";return'<span contenteditable="true" data-field-name="'.concat(i,'" data-field-type="').concat(l.type,'" data-placeholder="').concat(l.label||i,'" class="formdown-inline-field" role="textbox"').concat(e,">").concat(l.label||i,"</span>")}return e}),a=RegExp("".concat(r,"@(\\w+)(?:\\(([^)]+)\\))?(?:\\[([^\\]]*)\\])?"),"g");return{cleanedLine:n=n.replace(a,(e,r,i,n)=>{if(t.some(e=>e.name===r))return e;let a=this.createField(r,i,void 0!==n?n:"text");if(a){a.inline=!0,t.push(a);let e=a.required?' data-required="true"':"";return'<span contenteditable="true" data-field-name="'.concat(r,'" data-field-type="').concat(a.type,'" data-placeholder="').concat(a.label||r,'" class="formdown-inline-field" role="textbox"').concat(e,">").concat(a.label||r,"</span>")}return e}),inlineFields:t}}convertShorthandToField(e,t,r,i,n,a,s){let o={"@":"email","#":"number","%":"tel","&":"url",d:"date",t:"time",dt:"datetime-local","?":"password",T:"textarea",r:"radio",s:"select",c:"checkbox",R:"range",F:"file",C:"color",M:"month",W:"week",$:"number"}[n]||"text",l=s?this.parseAttributes(s):{};if("*"===t&&(l.required=!0),"textarea"===o&&a&&(l.rows=parseInt(a,10)),"$"===n&&(l.inputmode="decimal",l.step="0.01",l.placeholder||(l.placeholder="0.00")),r){let e=this.interpretContent(r,n);l={...l,...e}}let c=this.buildTypeAndAttributesString(o,l);return this.createField(e,i,c)}interpretContent(e,t){if(["r","s","c"].includes(t)){let t=e.split(",").map(e=>e.trim()).filter(e=>e.length>0),r=!1,i="Other",n={options:t.filter(e=>"*"===e?(r=!0,!1):!(e.startsWith("*(")&&e.endsWith(")"))||(r||(r=!0,i=e.slice(2,-1)),!1)).join(",")||""};return r&&(n["allow-other"]=!0,"Other"!==i&&(n["other-label"]=i)),n}if(["d","t","dt"].includes(t))return{format:e};let r=e.includes(","),i=e.match(/^\^.*\$$/)||e.includes("[")&&e.includes("]")&&!r||e.includes("\\"),n=e.includes("#")||!r&&e.includes("*");if(i||n){let t=e;return(e.includes("#")||e.includes("*")&&!e.match(/^\^.*\$$/))&&(t="^"+e.replace(/[().\/]/g,"\\$&").replace(/-/g,"\\-").replace(/#{1,}/g,e=>"\\d{".concat(e.length,"}")).replace(/\*/g,".*").replace(/\?/g,".")+"$"),{pattern:t}}if(e&&!["r","s","c","d","t","dt"].includes(t)){let t=e.split(",").map(e=>e.trim()).filter(e=>e.length>0);if(t.length>0){let r=this.generateDatalistId(e);return this.datalistDeclarations.find(e=>e.id===r)||this.datalistDeclarations.push({id:r,options:t}),{list:r}}}return{pattern:e}}parseAttributes(e){let t={};for(let r of Array.from(e.matchAll(/([\w-]+)(?:=(?:"([^"]*)"|'([^']*)'|([^\s]+)))?/g))){let[,e,i,n,a]=r;if("required"===e)t.required=!0;else if(void 0!==i||void 0!==n||void 0!==a){let r=void 0!==i?i:void 0!==n?n:a;t[e]=this.parseAttributeValue(r)}else t[e]=!0}return t}buildTypeAndAttributesString(e,t){let r=[e];for(let[e,i]of Object.entries(t))!0===i?r.push(e):"string"==typeof i?r.push("".concat(e,'="').concat(i,'"')):r.push("".concat(e,"=").concat(i));return r.join(" ")}createField(e,t,r){if(/^\d/.test(e)||!e.trim())return null;if(!r.trim())return{name:e,type:"text",label:t||this.formatLabel(e),attributes:{}};let i=Array.from(r.matchAll(/([\w-]+)(?:=(?:"([^"]*)"|'([^']*)'|([^\s]+)))?/g));if(0===i.length)return null;let n="text",a=-1;for(let e=0;e<i.length;e++){let[,t,r,s,o]=i[e];if(!r&&!s&&!o&&["text","email","password","number","tel","url","search","date","time","datetime-local","month","week","color","file","range","radio","checkbox","select","textarea","submit","reset","button","hidden"].includes(t)){n=t,a=e;break}}let s={name:e,type:n,label:t||this.formatLabel(e),attributes:{}};for(let e=0;e<i.length;e++){if(e===a)continue;let[,t,r,o,l]=i[e];if("required"===t)s.required=!0;else if("label"===t&&(void 0!==r||void 0!==o||void 0!==l))s.label=r||o||l;else if("placeholder"===t&&(void 0!==r||void 0!==o||void 0!==l))s.placeholder=r||o||l;else if("options"===t&&(void 0!==r||void 0!==o||void 0!==l)){let e=r||o||l;if(["radio","checkbox","select"].includes(n))if(e){let t=e.split(",").map(e=>e.trim()).filter(e=>e.length>0),r=!1,i="Other";s.options=t.filter(e=>"*"===e?(r=!0,!1):!(e.startsWith("*(")&&e.endsWith(")"))||(r||(r=!0,i=e.slice(2,-1)),!1)),r&&(s.allowOther=!0,"Other"!==i&&(s.otherLabel=i))}else s.options=[]}else if("allow-other"===t)s.allowOther=!0;else if("other-label"===t&&(void 0!==r||void 0!==o||void 0!==l))s.otherLabel=r||o||l;else if("format"===t&&(void 0!==r||void 0!==o||void 0!==l))s.format=r||o||l;else if("pattern"===t&&(void 0!==r||void 0!==o||void 0!==l))s.pattern=r||o||l;else if("content"===t&&(void 0!==r||void 0!==o||void 0!==l))s.content=r||o||l;else if("value"===t)void 0!==r||void 0!==o?s.value=void 0!==r?r:o:void 0!==l?s.value=this.parseAttributeValue(l):s.value="";else if("datalist"===t&&(void 0!==r||void 0!==o||void 0!==l))s.attributes.list=r||o||l;else if(void 0!==r||void 0!==o||void 0!==l){let e=r||o||l;s.attributes[t]=this.parseAttributeValue(e)}else s.attributes[t]=!0}return s}formatLabel(e){return e.includes("_")?e.split("_").map(e=>this.capitalizeWord(e)).join(" "):/[a-z][A-Z]/.test(e)?e.replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(e=>this.capitalizeWord(e)).join(" "):this.capitalizeWord(e)}capitalizeWord(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e}parseActionElement(e){let t=e.match(/^@\[(\w+)\s+"([^"]+)"([^\]]*)\]$/);if(!t)return null;let[,r,i,n]=t;if(!["submit","reset","button","image"].includes(r))return null;let a="".concat(r,"_").concat(Math.random().toString(36).substr(2,9)),s={};n.trim()&&Object.assign(s,this.parseAttributes(n.trim()));let o={name:a,type:"image"===r?"image":"button",label:i,attributes:{type:r,...s}};return"image"!==r||s.src||console.warn("Image action element missing src attribute: ".concat(e)),o}parseAttributeValue(e){return""===e?"":/^-?\d+$/.test(e)?parseInt(e,10):/^-?\d*\.\d+$/.test(e)?parseFloat(e):"true"===e||"false"!==e&&e}parseFormDeclaration(e){let t=e.trim().match(/^@form\[([^\]]*)\]\s*$/);if(!t)return null;let r=t[1],i=this.parseAttributes(r),n=i.id||this.generateFormId();return i.id&&delete i.id,{id:n,attributes:i}}generateFormId(){return"formdown-form-".concat(this.formCounter++)}generateDatalistId(e){let t=e.toLowerCase().replace(/\s+/g,"").replace(/,/g,"-").split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0);return"datalist-".concat(Math.abs(t))}parseDatalistDeclaration(e){let t=e.trim().match(/^@datalist\[([^\]]*)\]\s*$/);if(!t)return null;let r=t[1],i=this.parseAttributes(r);if(!i.id)return console.warn("Datalist declaration missing required id attribute:",e),null;if(void 0===i.options)return console.warn("Datalist declaration missing required options attribute:",e),null;let n="string"==typeof i.options?i.options.split(",").map(e=>e.trim()).filter(e=>e.length>0):[];return 0===n.length?(console.warn("Datalist declaration has empty options:",e),null):{id:i.id,options:n}}getDefaultFormId(){return this.defaultFormCreated||(this.defaultFormCreated=!0,this.formDeclarations.push({id:"formdown-form-default",attributes:{action:".",method:"GET"}})),"formdown-form-default"}associateFieldWithForm(e){var t;if(null==(t=e.attributes)?void 0:t.form){this.formDeclarations.some(t=>t.id===e.attributes.form)||(console.warn('FormDown: Referenced form "'.concat(e.attributes.form,'" does not exist. Using current or default form.')),e.attributes.form=this.currentFormId||this.getDefaultFormId());return}this.currentFormId?(e.attributes||(e.attributes={}),e.attributes.form=this.currentFormId):(e.attributes||(e.attributes={}),e.attributes.form=this.getDefaultFormId())}constructor(e={}){this.formDeclarations=[],this.datalistDeclarations=[],this.currentFormId=null,this.formCounter=1,this.defaultFormCreated=!1,this.options={preserveMarkdown:!0,fieldPrefix:"@",inlineFieldDelimiter:"___",autoGenerateFormIds:!0,...e}}}var m=r(7003);class f{escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}generateSmartLabel(e){if(/^\d/.test(e))throw Error("Invalid field name '".concat(e,"': Field names cannot start with a number"));return e.includes("_")?e.split("_").map(e=>this.capitalizeWord(e)).join(" "):/[a-z][A-Z]/.test(e)?e.replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(e=>this.capitalizeWord(e)).join(" "):this.capitalizeWord(e)}capitalizeWord(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e}determineFormId(e,t){var r;return(null==(r=e.attributes)?void 0:r.form)?e.attributes.form:t||(t?void 0:this.generateDefaultFormId())}generateDefaultFormId(){return 0===this.formCounter?"formdown-form-default":"formdown-form-".concat(this.formCounter++)}ensureDefaultForm(e,t){return 0===t.length?e:0===e.length?[{id:this.generateDefaultFormId(),attributes:{}}]:e}createFormContext(e,t){let r=new Map;if(0===t.length)return r;let i=[...t].sort((e,t)=>(e.position||0)-(t.position||0)),n=i[0].id;return e.forEach(e=>{var a;if(null==(a=e.attributes)?void 0:a.form){let i=e.attributes.form;t.some(e=>e.id===i)?r.set(e,i):(console.warn("Form '".concat(i,"' referenced by field '").concat(e.name,"' does not exist. Using default form.")),r.set(e,n))}else{let t=this.findNearestForm(e,i);r.set(e,(null==t?void 0:t.id)||n)}}),r}findNearestForm(e,t){let r;if(!e.position)return t[0];for(let i of t)if(!i.position||i.position<=e.position)r=i;else break;return r||t[0]}generateHTML(e){this.usedIds.clear(),this.fieldCounter=0;let t=e.markdown?(0,m.xI)(e.markdown):"";return"string"==typeof t?this.processContentWithHiddenForms(t,e.forms,e.formDeclarations||[],e.datalistDeclarations||[]):this.generateLegacyHTML(e)}processContentWithHiddenForms(e,t,r,i){if(0===t.length&&0===r.length&&0===i.length)return e;let n=this.ensureDefaultForm(r,t),a=this.generateHiddenFormsHTML(n),s=this.generateDatalistHTML(i),o=this.createFormContext(t,n),l=[],c=[];t.forEach(e=>{e.inline?l.push(e):c.push(e)});let d=e;return l.forEach((e,r)=>{let i="\x3c!--FORMDOWN_FIELD_".concat(t.indexOf(e),"--\x3e"),n=o.get(e),a=this.generateInlineFieldHTML(e,n);d=d.replace(RegExp(i,"g"),a)}),c.forEach(e=>{let r=t.indexOf(e),i=o.get(e),n=this.generateStandaloneFieldHTML(e,i);d=d.replace(RegExp("\x3c!--FORMDOWN_FIELD_".concat(r,"--\x3e"),"g"),n)}),a+s+d}processContent(e,t){if(0===t.length)return e;let r=[],i=[];t.forEach(e=>{e.inline?r.push(e):i.push(e)});let n=e;return r.forEach((e,r)=>{let i="\x3c!--FORMDOWN_FIELD_".concat(t.indexOf(e),"--\x3e"),a=this.generateInlineFieldHTML(e);n=n.replace(RegExp(i,"g"),a)}),i.forEach(e=>{let r=t.indexOf(e),i=this.generateSingleFieldFormHTML(e);n=n.replace(RegExp("\x3c!--FORMDOWN_FIELD_".concat(r,"--\x3e"),"g"),i)}),n}processFieldPlaceholders(e,t){let r=e;return t.forEach((e,t)=>{let i=this.generateStandaloneFieldHTML(e);r=r.replace(RegExp("\x3c!--FORMDOWN_FIELD_".concat(t,"--\x3e"),"g"),i)}),r}generateLegacyHTML(e){return(e.markdown?(0,m.xI)(e.markdown):"")+this.generateFormHTML(e.forms)}generateStandaloneFieldHTML(e,t){if(e.inline)return this.generateInlineFieldHTML(e,t);let r=this.generateFieldHTML(e,t);if(r.includes('<div class="formdown-field">')||["submit","reset","button"].includes(e.type))return'\n<div class="formdown-field-container">\n'.concat(r,"\n</div>");let i=this.generateUniqueId(e.name,t),n=e.label||this.generateSmartLabel(e.name),a=this.determineFormId(e,t),s=e.required?" *":"";return'\n<div class="formdown-field-container">\n<div class="formdown-field">\n    <label for="'.concat(i,'">').concat(n).concat(s,"</label>\n    ").concat(r.replace(/id="[^"]*"/,'id="'.concat(i,'"')).replace(/form="[^"]*"/,a?'form="'.concat(a,'"'):""),"\n</div>\n</div>")}generateSingleFormHTML(e){if(console.warn("generateSingleFormHTML() is deprecated. Use Hidden Form Architecture instead."),0===e.length)return"";let t="form_multi_".concat(Math.random().toString(36).substr(2,9)),r=e.map(e=>this.generateFieldHTML(e,t)).join("\n");return'\n<form class="formdown-form" role="form" id="'.concat(t,'">\n').concat(r,"\n</form>")}generateSingleFieldFormHTML(e){console.warn("generateSingleFieldFormHTML() is deprecated and violates Hidden Form Architecture. Use generateStandaloneFieldHTML() instead.");let t="form_".concat(e.name,"_").concat(Math.random().toString(36).substr(2,9)),r=this.generateFieldHTML(e,t);return'\n<form class="formdown-form" role="form" id="'.concat(t,'">\n').concat(r,"\n</form>")}generateInlineFieldHTML(e,t){let{name:r,type:i,required:n,placeholder:a,attributes:s}=e,o=e.label||this.generateSmartLabel(r),l=this.determineFormId(e,t),c=Object.entries({"data-field-name":r,"data-field-type":i,"data-placeholder":a||o,class:"formdown-inline-field",contenteditable:"true",role:"textbox",...n&&{"data-required":"true"},...l&&{"data-form":l},...s&&s}).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" ");return"<span ".concat(c,">").concat(o,"</span>")}generateFormHTML(e){if(console.warn("generateFormHTML() is deprecated. Use Hidden Form Architecture instead."),0===e.length)return"";let t="formdown-legacy-".concat(Math.random().toString(36).substr(2,9)),r=e.map(e=>this.generateFieldHTML(e,t)).join("\n");return'\n<form class="formdown-form" id="'.concat(t,'">\n').concat(r,"\n</form>")}generateFieldHTML(e,t){let{name:r,type:i,label:n,required:a,placeholder:s,attributes:o,options:l,description:c,errorMessage:u,pattern:h,format:p,allowOther:m,content:f,value:g}=e,v=d.getFieldTypeRegistry().generateFieldHTML(e,{field:e,metadata:{formId:t}});if(v)return v;let y=n||this.generateSmartLabel(r),b="checkbox"===i?f||n||this.generateSmartLabel(r):y,w=this.generateUniqueId(r,t),E=c?"".concat(w,"-description"):void 0,x=u?"".concat(w,"-error"):void 0,F=this.determineFormId(e,t),k={name:"name",first_name:"given-name",last_name:"family-name",email:"email",phone:"tel",phone_number:"tel",password:"current-password",new_password:"new-password",confirm_password:"new-password",username:"username",company:"organization",address:"street-address",city:"address-level2",state:"address-level1",zip:"postal-code",country:"country",birth_date:"bday",birthday:"bday"}[r.toLowerCase()]||("email"===i?"email":"tel"===i?"tel":"password"===i?"current-password":void 0),C={id:w,name:r,...a&&{required:!0},...s&&{placeholder:s},...h&&{pattern:h},...p&&{format:p},...null!=g&&!["textarea","select","radio","checkbox","range","file"].includes(i)&&{value:g},...c&&{"aria-describedby":E},...u&&{"aria-describedby":"".concat(E?E+" ":"").concat(x)},...F&&{form:F},...k&&!(null==o?void 0:o.autocomplete)&&{autocomplete:k},...o},S=Object.entries(C).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" "),T=()=>{let e="";return c&&(e+='\n    <div id="'.concat(E,'" class="formdown-field-description">').concat(c,"</div>")),u&&(e+='\n    <div id="'.concat(x,'" class="formdown-field-error" role="alert">').concat(u,"</div>")),e};switch(i){case"textarea":let A=g?this.escapeHtml(String(g)):"";return'\n<div class="formdown-field">\n    <label for="'.concat(w,'">').concat(y).concat(a?" *":"","</label>\n    <textarea ").concat(S,">").concat(A,"</textarea>").concat(T(),"\n</div>");case"select":let I=(null==l?void 0:l.map(e=>{let t=g&&String(g)===e?" selected":"";return'<option value="'.concat(e,'"').concat(t,">").concat(e,"</option>")}).join("\n"))||"",D=m?'\n        <option value="">'.concat(this.escapeHtml(e.otherLabel||"Other")," (please specify)</option>"):"",M=m?'\n    <input type="text" id="'.concat(w,'_other" placeholder="Please specify..." style="display: none; margin-top: 8px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; background: #fff; width: 100%; max-width: 300px;" class="formdown-other-input">'):"";return'\n<div class="formdown-field">\n    <label for="'.concat(w,'">').concat(y).concat(a?" *":"","</label>\n    <select ").concat(S," ").concat(m?"onchange=\"var container = this.closest('.formdown-field'); var otherInput = container ? container.querySelector('#".concat(w,"_other') : null; if(otherInput) { if(this.value === '') { otherInput.style.display = 'block'; otherInput.focus(); } else { otherInput.style.display = 'none'; } }\""):"",">\n        ").concat(I).concat(D,"\n    </select>").concat(M).concat(m?"\n    <script>\n        document.getElementById('".concat(w,"_other').addEventListener('input', function() {\n            var select = document.getElementById('").concat(w,"');\n            if (select && select.value === '') {\n                select.value = this.value;\n            }\n        });\n    <\/script>"):"").concat(T(),"\n</div>");case"radio":if(!l||0===l.length)return'\n<div class="formdown-field">\n    <label for="'.concat(w,'">').concat(y).concat(a?" *":"",'</label>\n    <input type="text" ').concat(S,">").concat(T(),"\n</div>");let L=l.map((e,i)=>{let n=this.generateUniqueId("".concat(r,"_").concat(i),t),s=a&&0===i,o=g&&String(g)===e;return'\n        <label for="'.concat(n,'" class="formdown-option-label">\n            <input type="radio" id="').concat(n,'" name="').concat(r,'" value="').concat(e,'"').concat(s?" required":"").concat(o?" checked":"").concat(E?' aria-describedby="'.concat(E,'"'):"").concat(m?" onchange=\"var container = this.closest('.formdown-field'); var otherInput = container ? container.querySelector('.formdown-other-input') : null; if(otherInput) { otherInput.style.display = 'none'; }\"":"",">\n            <span>").concat(e,"</span>\n        </label>")}).join("\n"),V=this.generateUniqueId("".concat(r,"_other_radio"),t),_=m?'\n        <label for="'.concat(V,'" class="formdown-option-label">\n            <input type="radio" id="').concat(V,'" name="').concat(r,'" value="" ').concat(E?'aria-describedby="'.concat(E,'"'):""," onchange=\"var container = this.closest('.formdown-field'); var otherInput = container ? container.querySelector('.formdown-other-input') : null; if(otherInput) { otherInput.style.display = 'inline-block'; otherInput.focus(); this.value = otherInput.value || ''; }\"\n            <span>").concat(this.escapeHtml(e.otherLabel||"Other"),':</span>\n            <input type="text" placeholder="Please specify..." style="display: none; margin-left: 8px; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; background: #fff;" class="formdown-other-input" onclick="var container = this.closest(\'.formdown-field\'); var otherRadio = container ? container.querySelector(\'#').concat(V,"') : null; if(otherRadio) { otherRadio.checked = true; otherRadio.value = this.value; }\" oninput=\"var container = this.closest('.formdown-field'); var otherRadio = container ? container.querySelector('#").concat(V,"') : null; if(otherRadio) { otherRadio.checked = true; otherRadio.value = this.value; otherRadio.dispatchEvent(new Event('change', {bubbles: true})); }\"\n        </label>"):"",R=(null==o?void 0:o.layout)==="vertical";return'\n<div class="formdown-field">\n    <fieldset '.concat(E?'aria-describedby="'.concat(E,'"'):"",">\n        <legend>").concat(y).concat(a?" *":"",'</legend>\n        <div class="').concat(R?"radio-group vertical":"radio-group inline",'" role="radiogroup">\n').concat(L).concat(_,"\n        </div>\n    </fieldset>").concat(T(),"\n</div>");case"checkbox":if(l&&0!==l.length){let i=g?String(g).split(",").map(e=>e.trim()):[],n=l.map((e,n)=>{let s=this.generateUniqueId("".concat(r,"_").concat(n),t),o=a&&0===n,l=i.includes(e);return'\n        <label for="'.concat(s,'" class="formdown-option-label">\n            <input type="checkbox" id="').concat(s,'" name="').concat(r,'" value="').concat(e,'"').concat(o?" required":"").concat(l?" checked":"").concat(E?' aria-describedby="'.concat(E,'"'):"",">\n            <span>").concat(e,"</span>\n        </label>")}).join("\n"),s=this.generateUniqueId("".concat(r,"_other_checkbox"),t),c=m?'\n        <label for="'.concat(s,'" class="formdown-option-label">\n            <input type="checkbox" id="').concat(s,'" name="').concat(r,'" value="" ').concat(E?'aria-describedby="'.concat(E,'"'):""," onchange=\"var container = this.closest('.formdown-field'); var otherInput = container ? container.querySelector('.formdown-other-input') : null; if(otherInput) { if(this.checked) { otherInput.style.display = 'inline-block'; otherInput.focus(); this.value = otherInput.value || ''; } else { otherInput.style.display = 'none'; this.value = ''; } }\"\n            <span>").concat(this.escapeHtml(e.otherLabel||"Other"),':</span>\n            <input type="text" placeholder="Please specify..." style="display: none; margin-left: 8px; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; background: #fff;" class="formdown-other-input" onclick="var container = this.closest(\'.formdown-field\'); var otherCheckbox = container ? container.querySelector(\'#').concat(s,"') : null; if(otherCheckbox) { otherCheckbox.checked = true; otherCheckbox.value = this.value; }\" oninput=\"var container = this.closest('.formdown-field'); var otherCheckbox = container ? container.querySelector('#").concat(s,"') : null; if(otherCheckbox && otherCheckbox.checked) { otherCheckbox.value = this.value; otherCheckbox.dispatchEvent(new Event('change', {bubbles: true})); }\">\n        </label>"):"",d=(null==o?void 0:o.layout)==="vertical";return'\n<div class="formdown-field">\n    <fieldset '.concat(E?'aria-describedby="'.concat(E,'"'):"",">\n        <legend>").concat(y).concat(a?" *":"",'</legend>\n        <div class="').concat(d?"checkbox-group vertical":"checkbox-group inline",'" role="group">\n').concat(n).concat(c,"\n        </div>\n    </fieldset>").concat(T(),"\n</div>")}{let e=g&&(!0===g||"true"===g||"true"===String(g).toLowerCase()),t={...C};delete t.id,delete t.name,delete t.form;let i=Object.entries(t).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" "),n=F?' form="'.concat(F,'"'):"";return'\n<div class="formdown-field">\n    <label for="'.concat(w,'" class="formdown-checkbox-label">\n        <input type="checkbox" id="').concat(w,'" name="').concat(r,'" value="true"').concat(a?" required":"").concat(e?" checked":"").concat(n," ").concat(i,">\n        <span>").concat(this.escapeHtml(b)).concat(a?" *":"","</span>\n    </label>").concat(T(),"\n</div>")}case"range":let O=(null==o?void 0:o.min)||0,q=(null==o?void 0:o.max)||100;null==o||o.step;let B=void 0!==g?g:(null==o?void 0:o.value)||Math.floor((O+q)/2);return'\n<div class="formdown-field">\n    <label for="'.concat(w,'">').concat(y).concat(a?" *":"",'</label>\n    <input type="range" ').concat(S,' value="').concat(B,'">\n    <output for="').concat(w,'" class="formdown-range-output">').concat(B,"</output>").concat(T(),"\n</div>");case"file":return'\n<div class="formdown-field">\n    <label for="'.concat(w,'">').concat(y).concat(a?" *":"",'</label>\n    <input type="file" ').concat(S,">").concat(T(),"\n</div>");case"color":return'\n<div class="formdown-field">\n    <label for="'.concat(w,'">').concat(y).concat(a?" *":"",'</label>\n    <input type="color" ').concat(S,">").concat(T(),"\n</div>");case"week":return'\n<div class="formdown-field">\n    <label for="'.concat(w,'">').concat(y).concat(a?" *":"",'</label>\n    <input type="week" ').concat(S,">").concat(T(),"\n</div>");case"month":return'\n<div class="formdown-field">\n    <label for="'.concat(w,'">').concat(y).concat(a?" *":"",'</label>\n    <input type="month" ').concat(S,">").concat(T(),"\n</div>");case"submit":let H=F?' form="'.concat(F,'"'):"",N=Object.entries(o||{}).filter(e=>{let[t]=e;return!["form"].includes(t)}).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" ");return'<button type="submit" id="'.concat(w,'"').concat(H).concat(N?" ".concat(N):"",">").concat(e.label||"Submit","</button>");case"reset":let P=F?' form="'.concat(F,'"'):"",z=Object.entries(o||{}).filter(e=>{let[t]=e;return!["form"].includes(t)}).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" ");return'<button type="reset" id="'.concat(w,'"').concat(P).concat(z?" ".concat(z):"",">").concat(e.label||"Reset","</button>");case"button":let j=(null==o?void 0:o.type)||"button",U=F?' form="'.concat(F,'"'):"",W=Object.entries(o||{}).filter(e=>{let[t]=e;return!["form","type"].includes(t)}).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" ");return'<button type="'.concat(j,'" id="').concat(w,'"').concat(U).concat(W?" ".concat(W):"",">").concat(e.label||"Button","</button>");case"image":let $=(null==o?void 0:o.src)||"",G=(null==o?void 0:o.alt)||e.label||"Submit",Y=F?' form="'.concat(F,'"'):"",Z=Object.entries(o||{}).filter(e=>{let[t]=e;return!["form","src","alt","type"].includes(t)}).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" ");return'<input type="image" id="'.concat(w,'" src="').concat($,'" alt="').concat(G,'"').concat(Y).concat(Z?" ".concat(Z):"",">");default:return'\n<div class="formdown-field">\n    <label for="'.concat(w,'">').concat(y).concat(a?" *":"",'</label>\n    <input type="').concat(i,'" ').concat(S,">").concat(T(),"\n</div>")}}generateHiddenFormsHTML(e){return 0===e.length?"":e.map(e=>this.generateHiddenFormHTML(e)).join("")}generateHiddenFormHTML(e){let t=Object.entries(e.attributes).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" ");return'<form hidden id="'.concat(e.id,'" ').concat(t,"></form>\n")}generateDatalistHTML(e){return 0===e.length?"":e.map(e=>this.generateSingleDatalistHTML(e)).join("")}generateSingleDatalistHTML(e){let t=e.options.map(e=>'<option value="'.concat(this.escapeHtml(e),'">').concat(this.escapeHtml(e),"</option>")).join("");return'<datalist id="'.concat(e.id,'">').concat(t,"</datalist>\n")}generateUniqueId(e,t){let r=e;if(this.usedIds.has(r)&&t){let i=t.replace(/^formdown-form-/,"").replace(/-/g,"_");r="".concat(i,"_").concat(e)}for(this.usedIds.has(r)&&(r="".concat(e,"_").concat(++this.fieldCounter));this.usedIds.has(r);)r="".concat(e,"_").concat(++this.fieldCounter);return this.usedIds.add(r),r}constructor(){this.formCounter=0,this.fieldCounter=0,this.usedIds=new Set}}class g{extractSchema(e){let t=this.parser.parse(e),r={};return t.fields.forEach((e,t)=>{r[e.name]=this.convertFieldToSchema(e,t)}),r}convertFieldToSchema(e,t){let r={type:e.type,label:e.label,required:e.required,position:t+1,isInline:e.inline};e.placeholder&&(r.placeholder=e.placeholder),void 0!==e.value&&(r.value=e.value),e.options&&(r.options=e.options),e.allowOther&&(r.allowOther=e.allowOther),e.format&&(r.format=e.format),e.pattern&&(r.pattern=e.pattern),e.description&&(r.description=e.description),e.errorMessage&&(r.errorMessage=e.errorMessage);let i=this.extractValidationRules(e.attributes||{}),n=this.extractFieldValidationRules(e);(i||n)&&(r.validation={...i,...n});let a=this.extractHtmlAttributes(e.attributes||{});return a&&Object.keys(a).length>0&&(r.htmlAttributes=a),r.layout=e.inline?"inline":"vertical",r}extractValidationRules(e){let t={},r=!1;return void 0!==e.min&&(t.min=e.min,r=!0),void 0!==e.max&&(t.max=e.max,r=!0),void 0!==e.step&&(t.step=e.step,r=!0),void 0!==e.minlength&&(t.minlength=e.minlength,r=!0),void 0!==e.maxlength&&(t.maxlength=e.maxlength,r=!0),void 0!==e.pattern&&(t.pattern=e.pattern,r=!0),void 0!==e.accept&&(t.accept=e.accept,r=!0),r?t:void 0}extractFieldValidationRules(e){let t={},r=!1;return void 0!==e.pattern&&(t.pattern=e.pattern,r=!0),r?t:void 0}extractHtmlAttributes(e){let t={},r=new Set(["min","max","step","minlength","maxlength","pattern","accept","required","placeholder","options","allow-other","format"]),i=!1;for(let[n,a]of Object.entries(e))r.has(n)||(t[n]=a,i=!0);return i?t:void 0}constructor(){this.parser=new p}}function v(e){return new g().extractSchema(e)}class y{static register(e,t){this.instances.set(e,t)}static get(e){return this.instances.get(e)}static cleanup(e){this.instances.delete(e)}}y.instances=new WeakMap;class b{set(e,t){this.isUpdating||this.data[e]!==t&&(this.data[e]=t,this.notifyFieldChange(e,t),this.notifyChange(),this.validateField(e,t))}get(e){return e in this.data?this.data[e]:this.schema&&this.schema[e]&&void 0!==this.schema[e].value?this.schema[e].value:void 0}getAll(){return{...this.getSchemaDefaults(),...this.data}}updateAll(e){this.updateInternal(e,!0)}reset(){let e=this.getSchemaDefaults();this.data={},this.updateInternal(e,!0)}isDirty(){let e=this.getAll(),t=this.getSchemaDefaults();return JSON.stringify(e)!==JSON.stringify(t)}validateField(e,t){if(!this.schema||!this.schema[e])return[];let r=A(void 0!==t?t:this.get(e),{...this.schema[e],name:e});return this.notifyValidation(e,r),r}validate(){if(!this.schema)return{isValid:!0,errors:[]};let e=I(this.getAll(),this.schema),t=new Map;return e.errors.forEach(e=>{t.has(e.field)||t.set(e.field,[]),t.get(e.field).push(e)}),t.forEach((e,t)=>{this.notifyValidation(t,e)}),e}subscribe(e){return this.changeListeners.add(e),()=>this.changeListeners.delete(e)}subscribeToField(e){return this.fieldChangeListeners.add(e),()=>this.fieldChangeListeners.delete(e)}subscribeToValidation(e){return this.validationListeners.add(e),()=>this.validationListeners.delete(e)}updateSchema(e){this.schema=e,this.initializeFromSchema(),this.notifyChange()}getSchemaDefaults(){if(!this.schema)return{};let e={};return Object.entries(this.schema).forEach(t=>{let[r,i]=t;void 0!==i.value&&(e[r]=i.value)}),e}getModifiedFields(){return Object.keys(this.data)}clear(e){if(e in this.data){delete this.data[e];let t=this.get(e);this.notifyFieldChange(e,t),this.notifyChange()}}hasExplicitValue(e){return e in this.data}createSnapshot(){return{...this.data}}restoreSnapshot(e){this.data={...e},this.notifyChange()}updateInternal(e,t){if(!this.isUpdating){this.isUpdating=!0;try{let r=[];Object.entries(e).forEach(e=>{let[t,i]=e;this.data[t]!==i&&(this.data[t]=i,r.push({field:t,value:i}))}),t&&r.length>0&&(r.forEach(e=>{let{field:t,value:r}=e;this.notifyFieldChange(t,r),this.validateField(t,r)}),this.notifyChange())}finally{this.isUpdating=!1}}}initializeFromSchema(){this.schema&&Object.entries(this.schema).forEach(e=>{let[t,r]=e;void 0===r.value||t in this.data||(this.data[t]=r.value)})}notifyChange(){if(this.isUpdating)return;let e=this.getAll();this.changeListeners.forEach(t=>{try{t(e)}catch(e){console.error("Error in FormDataBinding change listener:",e)}})}notifyFieldChange(e,t){if(this.isUpdating)return;let r=this.getAll();this.fieldChangeListeners.forEach(i=>{try{i(e,t,r)}catch(e){console.error("Error in FormDataBinding field change listener:",e)}})}notifyValidation(e,t){this.validationListeners.forEach(r=>{try{r(e,t)}catch(e){console.error("Error in FormDataBinding validation listener:",e)}})}constructor(e=null,t={}){this.schema=e,this.data={},this.changeListeners=new Set,this.fieldChangeListeners=new Set,this.validationListeners=new Set,this.isUpdating=!1,this.initializeFromSchema(),this.updateInternal(t,!1)}}class w{processCheckboxGroup(e,t){try{let r=t.querySelectorAll('input[type="checkbox"][name="'.concat(e,'"]'));if(0===r.length)return{success:!1,value:null,errors:["No checkboxes found"]};if(1===r.length&&"true"===r[0].value)return{success:!0,value:r[0].checked||!1};{let e=[];return r.forEach(r=>{if(r.checked)if(""===r.value&&r.id.includes("_other_checkbox")){let i=t.querySelector("#".concat(r.id.replace("_checkbox","_input")));i&&i.value.trim()&&e.push(i.value.trim())}else""!==r.value&&e.push(r.value)}),{success:!0,value:e}}}catch(e){return{success:!1,value:null,errors:["Checkbox processing error: ".concat(e)]}}}processRadioGroup(e,t){try{let r=t.querySelectorAll('input[type="radio"][name="'.concat(e,'"]'));if(0===r.length)return{success:!1,value:"",errors:["No radio buttons found"]};let i="";return r.forEach(e=>{if(e.checked)if(""===e.value&&e.id.includes("_other_radio")){let r=t.querySelector("#".concat(e.id.replace("_radio","_input")));r&&r.value.trim()&&(i=r.value.trim())}else i=e.value}),{success:!0,value:i}}catch(e){return{success:!1,value:"",errors:["Radio processing error: ".concat(e)]}}}processOtherOption(e,t){let r=!t.includes(e)&&""!==e.trim();return{hasOtherValue:r,otherValue:r?e:void 0,regularValues:t}}extractFieldValue(e,t){if(e.hasAttribute("contenteditable")){var r;return(null==(r=e.textContent)?void 0:r.trim())||""}switch(t){case"checkbox":return e.checked||!1;case"radio":return e.checked?e.value:"";case"number":case"range":let i=parseFloat(e.value);return isNaN(i)?0:i;case"date":case"time":case"datetime-local":case"month":case"week":default:return e.value||"";case"file":return e.value&&e.value.split("\\").pop()||""}}setFieldValue(e,t,r,i){try{if(e.hasAttribute("contenteditable"))return Array.isArray(t)?t.join(", "):String(t),e.textContent,!0;switch(r){case"checkbox":if(Array.isArray(t)){if(!t.includes(e.value)&&e.id.includes("_other_checkbox")&&""===e.value&&i){let r=e.name,n=i.querySelectorAll('input[type="checkbox"][name="'.concat(r,'"]:not([id*="_other_checkbox"])')).map(e=>e.value).filter(e=>""!==e);t.filter(e=>!n.includes(e)&&""!==e).length}return!0}if("boolean"==typeof t);return!0;case"radio":let n=String(t);if(e.value!==n&&e.id.includes("_other_radio")&&""===e.value&&i){let t=e.name,r=i.querySelectorAll('input[type="radio"][name="'.concat(t,'"]:not([id*="_other_radio"])')).map(e=>e.value).filter(e=>""!==e);n&&r.includes(n)}return!0;case"select":default:return Array.isArray(t)?t.join(", "):String(t),!0;case"number":case"range":let a="number"==typeof t?t:parseFloat(String(t));if(!isNaN(a))return!0;return!1}}catch(e){return!1}}validateFieldValue(e,t,r){let i=[];switch((null==r?void 0:r.required)&&(null==e||""===e||Array.isArray(e)&&0===e.length)&&i.push("This field is required"),t){case"email":e&&"string"==typeof e&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||i.push("Please enter a valid email address"));break;case"url":if(e&&"string"==typeof e)try{new URL(e)}catch(e){i.push("Please enter a valid URL")}break;case"number":case"range":if(""!==e&&null!=e){let t=Number(e);isNaN(t)?i.push("Please enter a valid number"):((null==r?void 0:r.min)!==void 0&&t<r.min&&i.push("Value must be at least ".concat(r.min)),(null==r?void 0:r.max)!==void 0&&t>r.max&&i.push("Value must be at most ".concat(r.max)))}break;case"tel":e&&"string"==typeof e&&(/^[\d\s\-\+\(\)]+$/.test(e)||i.push("Please enter a valid phone number"))}return(null==r?void 0:r.pattern)&&e&&"string"==typeof e&&(new RegExp(r.pattern).test(e)||i.push(r.patternMessage||"Value does not match required format")),"string"==typeof e&&((null==r?void 0:r.minLength)&&e.length<r.minLength&&i.push("Must be at least ".concat(r.minLength," characters")),(null==r?void 0:r.maxLength)&&e.length>r.maxLength&&i.push("Must be at most ".concat(r.maxLength," characters"))),{success:0===i.length,value:e,errors:i.length>0?i:void 0}}getFieldType(e){var t;switch(null==(t=e.type)?void 0:t.toLowerCase()){case"email":return"email";case"password":return"password";case"tel":return"tel";case"url":return"url";case"number":return"number";case"date":return"date";case"time":return"time";case"datetime-local":return"datetime-local";case"month":return"month";case"week":return"week";case"radio":return"radio";case"checkbox":return"checkbox";case"file":return"file";case"color":return"color";case"range":return"range";case"search":return"search";case"hidden":return"hidden";case"button":return"button";case"submit":return"submit";case"reset":return"reset";case"textarea":return"textarea";case"select":return"select";default:return"text"}}}class E{bindFieldToElement(e,t,r){return this.fieldRegistry[e]||(this.fieldRegistry[e]=new Set),this.fieldRegistry[e].add(t),this.setupElementEventHandlers(t,e,r),{fieldName:e,elements:this.fieldRegistry[e],unbind:()=>this.unbindElement(e,t)}}syncFormData(e,t){if(!this.isUpdatingUI){this.isUpdatingUI=!0;try{let r=Object.keys(this.fieldRegistry),i=Object.keys(e);[...new Set([...r,...i])].forEach(r=>{var i;let n=null!=(i=e[r])?i:"",a=this.fieldRegistry[r];a&&a.forEach(e=>{this.setElementValue(e,n,t)})})}finally{this.isUpdatingUI=!1}}}setupEventDelegation(e,t){}setupElementEventHandlers(e,t,r){let i=()=>{let i;if(!this.isUpdatingUI){if("checkbox"===e.type){let e=this.fieldProcessor.processCheckboxGroup(t,r);if(!e.success)return void console.error("Checkbox processing failed:",e.errors);i=e.value}else if("radio"===e.type){let e=this.fieldProcessor.processRadioGroup(t,r);if(!e.success)return void console.error("Radio processing failed:",e.errors);i=e.value}else{let t=this.fieldProcessor.getFieldType(e);i=this.fieldProcessor.extractFieldValue(e,t)}this.emitFieldChange(t,i,e)}};this.eventListeners.set(e,[{event:"input",handler:i},{event:"change",handler:i}])}setupOtherInputHandlers(e,t,r){let i=()=>{if(this.isUpdatingUI)return;let i=r.querySelector("#".concat(t,"_other_radio")),n=r.querySelector("#".concat(t,"_other_checkbox")),a=e.value.trim();if(i&&a)this.emitFieldChange(t,a,e);else if(n&&a){let i=this.fieldProcessor.processCheckboxGroup(t,r);i.success&&this.emitFieldChange(t,i.value,e)}};this.eventListeners.set(e,[{event:"input",handler:i},{event:"change",handler:i}])}setupContentEditableBehaviors(e,t){let{placeholder:r,selectOnFocus:i}=t,n=[{event:"focus",handler:()=>{var t;null==(t=e.textContent)||t.trim()}},{event:"blur",handler:()=>{var t;null==(t=e.textContent)||t.trim()}}];this.eventListeners.set(e,n)}setElementValue(e,t,r){let i=this.fieldProcessor.getFieldType(e);this.fieldProcessor.setFieldValue(e,t,i,r)}emitFieldChange(e,t,r){}unbindElement(e,t){this.fieldRegistry[e]&&(this.fieldRegistry[e].delete(t),0===this.fieldRegistry[e].size&&delete this.fieldRegistry[e]),this.eventListeners.get(t)&&this.eventListeners.delete(t)}getRegisteredFields(){return Object.keys(this.fieldRegistry)}getFieldElements(e){return this.fieldRegistry[e]}clearAllBindings(){Object.keys(this.fieldRegistry).forEach(e=>{this.fieldRegistry[e].forEach(t=>{this.unbindElement(e,t)})}),this.fieldRegistry={},this.eventListeners.clear()}validateAllFields(e,t){let r={};return Object.keys(this.fieldRegistry).forEach(i=>{let n=e[i],a=null==t?void 0:t[i];if(a){let e=this.fieldProcessor.getFieldType(a),t=this.fieldProcessor.validateFieldValue(n,e,a);r[i]=t}}),r}constructor(){this.fieldRegistry={},this.eventListeners=new Map,this.isUpdatingUI=!1,this.fieldProcessor=new w}}class x{registerCustomValidator(e,t){this.customValidators.set(e,t)}createValidationPipeline(e){return{rules:e,executeOrder:"fail-fast",skipOnError:!0}}async validateAsync(e,t,r){let i=this.getCacheKey(e.fieldName,t);if(this.validationCache.has(i))return this.validationCache.get(i);let n=this.buildValidationRules(e),a=this.createValidationPipeline(n),s=await this.executeValidationPipeline(a,e,t,r);return this.validationCache.set(i,s),s}async executeValidationPipeline(e,t,r,i){let n=[],a=[];switch(e.executeOrder){case"fail-fast":for(let s of e.rules){let o=await this.executeValidationRule(s,t,r,i);if(!o.isValid&&(n.push(...o.errors),e.skipOnError))break;o.warnings&&a.push(...o.warnings)}break;case"sequential":for(let s of e.rules){let e=await this.executeValidationRule(s,t,r,i);e.isValid||n.push(...e.errors),e.warnings&&a.push(...e.warnings)}break;case"parallel":(await Promise.all(e.rules.map(e=>this.executeValidationRule(e,t,r,i)))).forEach(e=>{e.isValid||n.push(...e.errors),e.warnings&&a.push(...e.warnings)})}return{isValid:0===n.length,errors:n,warnings:a.length>0?a:void 0}}async executeValidationRule(e,t,r,i){try{let n=await e.validator(r,t,i);if("boolean"==typeof n)return{isValid:n,errors:n?[]:[{field:t.fieldName,code:e.name,message:e.message||"Validation failed for ".concat(t.fieldName),severity:"error"}]};if("string"==typeof n)return{isValid:!1,errors:[{field:t.fieldName,code:e.name,message:n,severity:"error"}]};return n}catch(e){return{isValid:!1,errors:[{field:t.fieldName,code:"validation_error",message:"Validation error: ".concat(e),severity:"error"}]}}}buildValidationRules(e){let t=[];if(e.constraints.required&&t.push({name:"required",validator:t=>!(null==t||""===t||Array.isArray(t)&&0===t.length)||e.constraints.requiredMessage||"".concat(e.schema.label||e.fieldName," is required")}),t.push(...this.getTypeSpecificRules(e)),e.constraints.pattern&&t.push({name:"pattern",validator:t=>!t||new RegExp(e.constraints.pattern).test(String(t))||e.constraints.patternMessage||"Value does not match required format"}),(e.constraints.minLength||e.constraints.maxLength)&&t.push({name:"length",validator:t=>{if(!t)return!0;let r=String(t);return e.constraints.minLength&&r.length<e.constraints.minLength?"Must be at least ".concat(e.constraints.minLength," characters"):!e.constraints.maxLength||!(r.length>e.constraints.maxLength)||"Must be at most ".concat(e.constraints.maxLength," characters")}}),e.constraints.customValidator&&this.customValidators.has(e.constraints.customValidator)){let r=this.customValidators.get(e.constraints.customValidator);t.push({name:e.constraints.customValidator,validator:r,async:!0})}return e.constraints.serverValidation&&t.push({name:"server_validation",validator:(e,t,r)=>this.validateOnServer(e,t,r),async:!0}),t}getTypeSpecificRules(e){let t=[];switch(e.fieldType){case"email":t.push({name:"email_format",validator:e=>!e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e))||"Please enter a valid email address"});break;case"url":t.push({name:"url_format",validator:e=>{if(!e)return!0;try{return new URL(String(e)),!0}catch(e){return"Please enter a valid URL"}}});break;case"number":case"range":t.push({name:"number_format",validator:(e,t)=>{if(!e&&0!==e)return!0;let r=Number(e);return isNaN(r)?"Please enter a valid number":void 0!==t.constraints.min&&r<t.constraints.min?"Value must be at least ".concat(t.constraints.min):void 0===t.constraints.max||!(r>t.constraints.max)||"Value must be at most ".concat(t.constraints.max)}});break;case"tel":t.push({name:"phone_format",validator:e=>!e||/^[\d\s\-\+\(\)]+$/.test(String(e))||"Please enter a valid phone number"});break;case"date":t.push({name:"date_format",validator:(e,t)=>{if(!e)return!0;let r=new Date(String(e));if(isNaN(r.getTime()))return"Please enter a valid date";if(t.constraints.min){let e=new Date(t.constraints.min);if(r<e)return"Date must be after ".concat(e.toLocaleDateString())}if(t.constraints.max){let e=new Date(t.constraints.max);if(r>e)return"Date must be before ".concat(e.toLocaleDateString())}return!0}})}return t}async validateOnServer(e,t,r){let i=t.constraints.serverValidation;return new Promise(n=>{let a=this.asyncValidationTimers.get(t.fieldName);a&&clearTimeout(a);let s=setTimeout(async()=>{try{let a=await this.makeValidationRequest(e,t,r,i);n(a)}catch(e){n({isValid:!1,errors:[{field:t.fieldName,code:"server_error",message:"Server validation failed",severity:"error"}]})}},i.debounceMs||500);this.asyncValidationTimers.set(t.fieldName,s)})}async makeValidationRequest(e,t,r,i){return t.fieldName,{isValid:!0,errors:[]}}validateCrossFields(e,t){let r=[];return t.forEach(t=>{try{let i=t.validator(e);"string"==typeof i?r.push({field:t.fields[0],code:t.name,message:i,severity:"error"}):"object"!=typeof i||i.isValid||r.push(...i.errors)}catch(e){r.push({field:t.fields[0],code:"cross_field_error",message:"Cross-field validation error: ".concat(e),severity:"error"})}}),{isValid:0===r.length,errors:r}}clearCache(e){if(e)for(let t of this.validationCache.keys())t.startsWith("".concat(e,":"))&&this.validationCache.delete(t);else this.validationCache.clear()}getCacheKey(e,t){return"".concat(e,":").concat(JSON.stringify(t))}dispose(){this.asyncValidationTimers.forEach(e=>clearTimeout(e)),this.asyncValidationTimers.clear(),this.validationCache.clear()}constructor(){this.customValidators=new Map,this.validationCache=new Map,this.asyncValidationTimers=new Map}}let F={FORM_INITIALIZED:"formdown:form:initialized",FORM_READY:"formdown:form:ready",FORM_DESTROYED:"formdown:form:destroyed",FIELD_CHANGE:"formdown:field:change",FIELD_INVALID:"formdown:field:invalid",FIELD_VALID:"formdown:field:valid",DATA_CHANGE:"formdown:data:change",DATA_SYNC:"formdown:data:sync",VALIDATION_START:"formdown:validation:start",VALIDATION_SUCCESS:"formdown:validation:success",VALIDATION_ERROR:"formdown:validation:error",UI_RENDER_COMPLETE:"formdown:ui:render:complete",UI_UPDATE:"formdown:ui:update",EDITOR_CONTENT_CHANGE:"formdown:editor:content:change",EDITOR_PREVIEW_UPDATE:"formdown:editor:preview:update",EDITOR_ERROR:"formdown:editor:error",EXTENSION_LOADED:"formdown:extension:loaded",SCHEMA_CHANGE:"formdown:schema:change"};class k{createEventBus(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"bus_".concat(Date.now()),t=new Map,r={emit:(r,i)=>{let n=t.get(r);n&&n.forEach(e=>{try{e(i)}catch(e){console.error("Error in event handler for ".concat(r,":"),e)}}),this.globalEventConfig.bubbleEvents&&"global"!==e&&this.globalEventBus.emit(r,{source:e,data:i})},on:(e,r)=>(t.has(e)||t.set(e,new Set),t.get(e).add(r),()=>{var i;null==(i=t.get(e))||i.delete(r)}),off:(e,r)=>{var i;null==(i=t.get(e))||i.delete(r)},once:(e,t)=>{let i=n=>{t(n),r.off(e,i)};return r.on(e,i)},clear:()=>{t.clear()}};return this.eventBuses.set(e,r),r}bridgeComponentEvents(e,t,r){let i="".concat(e.id,"_to_").concat(t.id),n={source:e,target:t,eventMappings:r,isActive:!0};return r.forEach(r=>{e.on&&e.on(r.sourceEvent,e=>{if(!n.isActive||r.condition&&!r.condition(e))return;let i=e;if(r.transformer)try{i=r.transformer(e)}catch(e){console.error("Error in event transformer for ".concat(r.sourceEvent,":"),e);return}t.emit&&t.emit(r.targetEvent,i)})}),this.eventBridges.set(i,n),i}setupGlobalEventHandling(){this.globalEventConfig.enableFormEvents&&this.setupFormEventHandlers(),this.globalEventConfig.enableFieldEvents&&this.setupFieldEventHandlers(),this.globalEventConfig.enableValidationEvents&&this.setupValidationEventHandlers(),this.globalEventConfig.enableLifecycleEvents&&this.setupLifecycleEventHandlers()}setupFormEventHandlers(){this.globalEventBus.on(F.FORM_INITIALIZED,e=>{console.debug("Form initialized:",e)}),this.globalEventBus.on(F.DATA_CHANGE,e=>{this.globalEventBus.emit(F.DATA_SYNC,e)}),this.globalEventBus.on(F.FORM_DESTROYED,e=>{this.cleanupFormEventBridges(null==e?void 0:e.formId)})}setupFieldEventHandlers(){this.globalEventBus.on(F.FIELD_CHANGE,e=>{this.globalEventBus.emit(F.VALIDATION_START,{fieldName:e.fieldName,value:e.value})}),this.globalEventBus.on(F.FIELD_INVALID,e=>{console.debug("Field validation error:",e)})}setupValidationEventHandlers(){this.globalEventBus.on(F.VALIDATION_ERROR,e=>{console.debug("Validation error:",e)}),this.globalEventBus.on(F.VALIDATION_SUCCESS,e=>{console.debug("Validation success:",e)})}setupLifecycleEventHandlers(){this.globalEventBus.on(F.UI_RENDER_COMPLETE,e=>{this.globalEventBus.emit(F.FORM_READY,e)}),this.globalEventBus.on(F.EXTENSION_LOADED,e=>{console.debug("Extension loaded:",e)})}createCoreUIBridge(e,t){let r=[{sourceEvent:F.DATA_CHANGE,targetEvent:F.UI_UPDATE,transformer:e=>({formData:e.formData})},{sourceEvent:F.VALIDATION_ERROR,targetEvent:F.FIELD_INVALID,transformer:e=>({fieldName:e.field,errors:e.errors})},{sourceEvent:F.VALIDATION_SUCCESS,targetEvent:F.FIELD_VALID,transformer:e=>({fieldName:e.field})},{sourceEvent:F.FIELD_CHANGE,targetEvent:F.DATA_CHANGE,transformer:e=>({fieldName:e.fieldName,value:e.value,formData:e.formData})}];return this.bridgeComponentEvents(e,t,r)}createCoreEditorBridge(e,t){let r=[{sourceEvent:F.SCHEMA_CHANGE,targetEvent:F.EDITOR_PREVIEW_UPDATE,transformer:e=>({schema:e.schema})},{sourceEvent:F.EDITOR_CONTENT_CHANGE,targetEvent:F.SCHEMA_CHANGE,transformer:e=>({content:e.content})},{sourceEvent:F.VALIDATION_ERROR,targetEvent:F.EDITOR_ERROR,transformer:e=>({errors:e.errors})}];return this.bridgeComponentEvents(e,t,r)}getGlobalEventBus(){return this.globalEventBus}getEventBus(e){return this.eventBuses.get(e)}removeBridge(e){let t=this.eventBridges.get(e);t&&(t.isActive=!1,this.eventBridges.delete(e))}cleanupFormEventBridges(e){if(e)for(let[t,r]of this.eventBridges.entries())t.includes(e)&&this.removeBridge(t)}getActiveBridges(){return Array.from(this.eventBridges.values()).filter(e=>e.isActive)}dispose(){this.eventBuses.forEach(e=>e.clear()),this.eventBuses.clear(),this.eventBridges.forEach(e=>{e.isActive=!1}),this.eventBridges.clear(),this.globalEventBus.clear()}configureEvents(e){this.globalEventConfig={...this.globalEventConfig,...e},this.setupGlobalEventHandling()}getEventStats(){return{totalEventBuses:this.eventBuses.size,totalBridges:this.eventBridges.size,activeBridges:this.getActiveBridges().length}}constructor(e={}){this.eventBuses=new Map,this.eventBridges=new Map,this.globalEventConfig={enableFormEvents:!0,enableFieldEvents:!0,enableValidationEvents:!0,enableLifecycleEvents:!0,bubbleEvents:!0,eventPrefix:"formdown",...e},this.globalEventBus=this.createEventBus("global")}}class C{parse(e){return this.content=e,this.parsedContent=this.parser.parseFormdown(e),this.schema=v(e),this.dataBinding=new b(this.schema),this.setupDataBindingEvents(),this.parsedContent}render(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.parsedContent)throw Error("No content parsed. Call parse() first.");return"json"===e.outputFormat?JSON.stringify(this.parsedContent,null,2):this.generator.generateHTML(this.parsedContent)}getSchema(){return this.schema?{...this.schema}:null}getData(){return this.dataBinding?this.dataBinding.getAll():{}}setFieldValue(e,t){this.dataBinding&&this.dataBinding.set(e,t)}updateData(e){this.dataBinding&&this.dataBinding.updateAll(e)}reset(){this.dataBinding&&(this.dataBinding.reset(),this.emit("form-reset",{formData:this.getData()}))}validate(){return this.dataBinding?this.dataBinding.validate():{isValid:!0,errors:[]}}getDefaultValues(){return this.dataBinding?this.dataBinding.getSchemaDefaults():{}}isDirty(){return!!this.dataBinding&&this.dataBinding.isDirty()}getField(e){return this.parsedContent&&this.parsedContent.forms.find(t=>t.name===e)||null}getFields(){var e;return(null==(e=this.parsedContent)?void 0:e.forms)||[]}getFormDeclarations(){var e;return(null==(e=this.parsedContent)?void 0:e.formDeclarations)||[]}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t)}off(e,t){let r=this.eventListeners.get(e);r&&r.delete(t)}emit(e,t){let r=this.eventListeners.get(e);r&&r.forEach(r=>{try{r(t)}catch(t){console.error("Error in FormManager event handler for '".concat(e,"':"),t)}})}setupDataBindingEvents(){this.dataBinding&&(this.dataBinding.subscribeToField((e,t,r)=>{this.emit("data-change",{field:e,value:t,formData:r})}),this.dataBinding.subscribeToValidation((e,t)=>{t.length>0&&this.emit("validation-error",{field:e,errors:t})}))}clone(){return new C(this.options)}export(){return{content:this.content,data:this.getData(),schema:this.getSchema(),options:{...this.options}}}import(e){e.options&&(Object.assign(this.options,e.options),this.parser=new p(this.options)),this.parse(e.content),e.data&&this.updateData(e.data)}createFieldProcessor(){return this.fieldProcessor||(this.fieldProcessor=new w),this.fieldProcessor}createDOMBinder(){return this.domBinder||(this.domBinder=new E),this.domBinder}createValidationManager(){return this.validationManager||(this.validationManager=new x),this.validationManager}createEventOrchestrator(){return this.eventOrchestrator||(this.eventOrchestrator=new k),this.eventOrchestrator}processFieldValue(e,t){let r=this.createFieldProcessor(),i=this.getField(e);if(!i)return console.warn("Field ".concat(e," not found in schema")),t;let n=r.getFieldType({id:e,name:e,value:String(t),type:i.type||"text",hasAttribute:()=>!1,getAttribute:()=>null});return r.extractFieldValue({id:e,name:e,value:String(t),type:i.type||"text",hasAttribute:()=>!1,getAttribute:()=>null},n)}async validateFieldWithPipeline(e,t){let r=this.createValidationManager(),i=this.getField(e),n=this.createFieldProcessor();if(!i)return{isValid:!1,errors:["Field ".concat(e," not found")]};let a=n.getFieldType({id:e,name:e,value:String(t),type:i.type||"text",hasAttribute:()=>!1,getAttribute:()=>null}),s={fieldName:e,fieldType:a,constraints:i.attributes||{},schema:i};return await r.validateAsync(s,t,this.getData())}setupComponentBridge(e){let t=this.createEventOrchestrator(),r={id:"formdown-core",type:"core",emit:(e,t)=>{"formdown:data:change"===e?this.emit("data-change",t):"formdown:validation:error"===e&&this.emit("validation-error",t)},on:(e,t)=>("formdown:field:change"===e&&this.on("data-change",t),()=>{})};return"ui"===e.type?t.createCoreUIBridge(r,e):"editor"===e.type?t.createCoreEditorBridge(r,e):t.bridgeComponentEvents(r,e,[])}renderToTemplate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.parsedContent)throw Error("No content parsed. Call parse() first.");return{fields:this.getFields(),formDeclarations:this.getFormDeclarations(),schema:this.getSchema(),data:this.getData(),html:this.render(),options:e}}handleUIEvent(e,t){t||(t=this.createDOMBinder());let r=e.target,i=(null==r?void 0:r.name)||(null==r?void 0:r.id);if(i&&"change"===e.type){let e=this.createFieldProcessor(),t=e.getFieldType(r),n=e.extractFieldValue(r,t);this.setFieldValue(i,n)}}createPreviewTemplate(e){try{let t=new C(this.options);return t.parse(e),{html:t.render(),errors:[],schema:t.getSchema(),fields:t.getFields()}}catch(e){return{html:"",errors:[String(e)],schema:null,fields:[]}}}getCoreModules(){return{fieldProcessor:this.fieldProcessor,domBinder:this.domBinder,validationManager:this.validationManager,eventOrchestrator:this.eventOrchestrator}}dispose(){this.validationManager&&(this.validationManager.dispose(),this.validationManager=null),this.domBinder&&(this.domBinder.clearAllBindings(),this.domBinder=null),this.eventOrchestrator&&(this.eventOrchestrator.dispose(),this.eventOrchestrator=null),this.fieldProcessor=null,this.eventListeners.clear(),this.dataBinding&&(this.dataBinding=null)}constructor(e={}){this.options=e,this.content="",this.parsedContent=null,this.schema=null,this.dataBinding=null,this.eventListeners=new Map,this.fieldProcessor=null,this.domBinder=null,this.validationManager=null,this.eventOrchestrator=null,this.parser=new p(e),this.generator=new f,[].forEach(e=>{this.eventListeners.set(e,new Set)})}}class S{static get(e,t){let r=this.resolveForm(t);if(!r)return null;switch(this.getFieldType(e,r)){case"checkbox":return this.getCheckboxValues(e,r);case"radio":case"select":return this.getSingleValue(e,r);case"text":case"textarea":return this.getTextValue(e,r);default:return this.warn("Unknown field type for field: ".concat(e)),null}}static set(e,t,r){let i={...this.defaultOptions,...r},n=this.resolveForm();if(!n)return!1;let a=this.getFieldType(e,n);try{switch(a){case"checkbox":return this.setCheckboxValues(e,Array.isArray(t)?t:t?[t]:[],n,i);case"radio":return this.setRadioValue(e,t,n,i);case"select":return this.setSelectValue(e,t,n,i);case"text":case"textarea":return this.setTextValue(e,t,n,i);default:return this.warn("Cannot set value for unknown field type: ".concat(e),i),!1}}catch(e){return this.warn("Error setting field value: ".concat(e),i),!1}}static add(e,t,r){let i={...this.defaultOptions,...r},n=this.resolveForm();if(!n)return!1;let a=this.getFieldType(e,n);return"checkbox"!==a?(this.warn("add() can only be used with checkbox fields. Field '".concat(e,"' is type: ").concat(a),i),!1):this.addCheckboxValue(e,t,n,i)}static remove(e,t,r){let i={...this.defaultOptions,...r},n=this.resolveForm();if(!n)return!1;let a=this.getFieldType(e,n);return"checkbox"!==a?(this.warn("remove() can only be used with checkbox fields. Field '".concat(e,"' is type: ").concat(a),i),!1):this.removeCheckboxValue(e,t,n,i)}static toggle(e,t,r){let i={...this.defaultOptions,...r},n=this.resolveForm();if(!n)return!1;let a=this.getFieldType(e,n);return"checkbox"!==a?(this.warn("toggle() can only be used with checkbox fields. Field '".concat(e,"' is type: ").concat(a),i),!1):this.getCheckboxValues(e,n).includes(t)?this.removeCheckboxValue(e,t,n,i):this.addCheckboxValue(e,t,n,i)}static clear(e,t){let r={...this.defaultOptions,...t},i=this.resolveForm();if(!i)return!1;let n=this.getFieldType(e,i);try{switch(n){case"checkbox":return this.clearCheckboxValues(e,i,r);case"radio":return this.clearRadioValues(e,i,r);case"select":return this.clearSelectValue(e,i,r);case"text":case"textarea":return this.clearTextValue(e,i,r);default:return this.warn("Cannot clear unknown field type: ".concat(e),r),!1}}catch(e){return this.warn("Error clearing field: ".concat(e),r),!1}}static has(e,t,r){let i=this.get(e,r);return Array.isArray(i)?i.includes(t):i===t}static getFieldType(e,t){let r=this.resolveForm(t);return r?r.querySelector('input[type="radio"][name="'.concat(e,'"]'))?"radio":r.querySelector('input[type="checkbox"][name="'.concat(e,'"]'))?"checkbox":r.querySelector('select[name="'.concat(e,'"]'))?"select":r.querySelector('textarea[name="'.concat(e,'"]'))?"textarea":r.querySelector('input[name="'.concat(e,'"]'))?"text":"unknown":"unknown"}static isOtherValue(e,t,r){let i=this.resolveForm(r);if(!i)return!1;switch(this.getFieldType(e,i)){case"radio":case"checkbox":return!i.querySelector('input[name="'.concat(e,'"][value="').concat(t,'"]'));case"select":let n=i.querySelector('select[name="'.concat(e,'"]'));if(!n)return!1;return!n.querySelector('option[value="'.concat(t,'"]'));default:return!1}}static resolveForm(e){if(e)return e;let t=document.querySelectorAll("form");return 1===t.length?t[0]:(0===t.length?this.warn("No forms found in document"):this.warn("Multiple forms found. Please specify which form to use."),null)}static warn(e,t){(null==t?void 0:t.silent)||console.warn("[FormdownFieldHelper] ".concat(e))}static dispatchChangeEvent(e,t){t.dispatchEvents&&e.dispatchEvent(new Event("change",{bubbles:!0}))}static dispatchInputEvent(e,t){t.dispatchEvents&&e.dispatchEvent(new Event("input",{bubbles:!0}))}static setRadioValue(e,t,r,i){if(r.querySelectorAll('input[type="radio"][name="'.concat(e,'"]')).forEach(e=>{e.checked=!1}),!t)return!0;let n=r.querySelector('input[type="radio"][name="'.concat(e,'"][value="').concat(t,'"]'));if(n){n.checked=!0,this.dispatchChangeEvent(n,i);let e=r.querySelector(".formdown-other-input");return e&&(e.style.display="none"),!0}{let n=r.querySelector("#".concat(e,"_other_radio")),a=r.querySelector(".formdown-other-input");return n&&a?(n.checked=!0,n.value=t,a.value=t,a.style.display="inline-block",this.dispatchChangeEvent(n,i),this.dispatchInputEvent(a,i),!0):(this.warn("Other option not available for radio field: ".concat(e),i),!1)}}static getSingleValue(e,t){let r=t.querySelector('input[name="'.concat(e,'"]:checked, select[name="').concat(e,'"]'));return r&&r.value||null}static clearRadioValues(e,t,r){t.querySelectorAll('input[type="radio"][name="'.concat(e,'"]')).forEach(e=>{e.checked=!1,e.id&&e.id.includes("_other_")&&(e.value="")});let i=t.querySelector(".formdown-other-input");return i&&(i.value="",i.style.display="none"),!0}static setCheckboxValues(e,t,r,i){this.clearCheckboxValues(e,r,{...i,dispatchEvents:!1});let n=!0;for(let a of t)this.addCheckboxValue(e,a,r,{...i,dispatchEvents:!1})||(n=!1);if(i.dispatchEvents&&t.length>0){let t=r.querySelector('input[type="checkbox"][name="'.concat(e,'"]:checked'));t&&this.dispatchChangeEvent(t,i)}return n}static addCheckboxValue(e,t,r,i){if(!t)return!1;if(r.querySelector('input[type="checkbox"][name="'.concat(e,'"][value="').concat(t,'"]:checked')))return!0;let n=r.querySelector('input[type="checkbox"][name="'.concat(e,'"][value="').concat(t,'"]'));if(n)return n.checked=!0,this.dispatchChangeEvent(n,i),!0;{let n=r.querySelector("#".concat(e,"_other_checkbox")),a=r.querySelector(".formdown-other-input");return n&&a?(n.checked=!0,n.value=t,a.value=t,a.style.display="inline-block",this.dispatchChangeEvent(n,i),this.dispatchInputEvent(a,i),!0):(this.warn("Other option not available for checkbox field: ".concat(e),i),!1)}}static removeCheckboxValue(e,t,r,i){let n=r.querySelector('input[type="checkbox"][name="'.concat(e,'"][value="').concat(t,'"]:checked'));if(n){if(n.checked=!1,n.id&&n.id.includes("_other_")){let e=r.querySelector(".formdown-other-input");e&&(e.value="",e.style.display="none",n.value="")}return this.dispatchChangeEvent(n,i),!0}return!1}static getCheckboxValues(e,t){return Array.from(t.querySelectorAll('input[type="checkbox"][name="'.concat(e,'"]:checked'))).map(e=>e.value).filter(e=>e)}static clearCheckboxValues(e,t,r){t.querySelectorAll('input[type="checkbox"][name="'.concat(e,'"]')).forEach(e=>{e.checked=!1,e.id&&e.id.includes("_other_")&&(e.value="")});let i=t.querySelector(".formdown-other-input");return i&&(i.value="",i.style.display="none"),!0}static setSelectValue(e,t,r,i){let n=r.querySelector('select[name="'.concat(e,'"]'));if(!n)return this.warn("Select element not found: ".concat(e),i),!1;if(!t){n.value="";let t=r.querySelector("#".concat(e,"_other"));return t&&(t.style.display="none",t.value=""),this.dispatchChangeEvent(n,i),!0}if(n.querySelector('option[value="'.concat(t,'"]'))){n.value=t;let a=r.querySelector("#".concat(e,"_other"));return a&&(a.style.display="none"),this.dispatchChangeEvent(n,i),!0}{let a=r.querySelector("#".concat(e,"_other"));return a?(n.value="",a.value=t,a.style.display="block",n.value=t,this.dispatchChangeEvent(n,i),this.dispatchInputEvent(a,i),!0):(this.warn("Other option not available for select field: ".concat(e),i),!1)}}static clearSelectValue(e,t,r){let i=t.querySelector('select[name="'.concat(e,'"]'));if(!i)return!1;i.value="";let n=t.querySelector("#".concat(e,"_other"));return n&&(n.value="",n.style.display="none"),this.dispatchChangeEvent(i,r),!0}static setTextValue(e,t,r,i){let n=r.querySelector('input[name="'.concat(e,'"], textarea[name="').concat(e,'"]'));return n?(n.value=t||"",this.dispatchInputEvent(n,i),this.dispatchChangeEvent(n,i),!0):(this.warn("Text input not found: ".concat(e),i),!1)}static getTextValue(e,t){let r=t.querySelector('input[name="'.concat(e,'"], textarea[name="').concat(e,'"]'));return r?r.value:null}static clearTextValue(e,t,r){return this.setTextValue(e,"",t,r)}}function T(e){return v(e)}function A(e,t){let r=[];return t.required&&(!e||""===e.toString().trim())&&r.push({field:t.name||"field",message:t.errorMessage||"".concat(t.label||"Field"," is required")}),r}function I(e,t){let r=[];return Object.entries(t).forEach(t=>{let[i,n]=t,a=A(e[i],{...n,name:i});r.push(...a)}),{isValid:0===r.length,errors:r}}S.defaultOptions={silent:!1,dispatchEvents:!0}}}]);