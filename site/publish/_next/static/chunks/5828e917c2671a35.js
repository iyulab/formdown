(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,11707,e=>{"use strict";let t;e.i(12207);var r=e.i(92057),i=e.i(4148),s=e.i(54479);let n=globalThis,a=n.ShadowRoot&&(void 0===n.ShadyCSS||n.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,l=Symbol(),o=new WeakMap,d=class{constructor(e,t,r){if(this._$cssResult$=!0,r!==l)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o,t=this.t;if(a&&void 0===e){let r=void 0!==t&&1===t.length;r&&(e=o.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&o.set(t,e))}return e}toString(){return this.cssText}},h=a?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t,r="";for(let t of e.cssRules)r+=t.cssText;return new d("string"==typeof(t=r)?t:t+"",void 0,l)})(e):e,{is:c,defineProperty:u,getOwnPropertyDescriptor:p,getOwnPropertyNames:m,getOwnPropertySymbols:g,getPrototypeOf:f}=Object,b=globalThis,v=b.trustedTypes,y=v?v.emptyScript:"",w=b.reactiveElementPolyfillSupport,k={toAttribute(e,t){switch(t){case Boolean:e=e?y:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let r=e;switch(t){case Boolean:r=null!==e;break;case Number:r=null===e?null:Number(e);break;case Object:case Array:try{r=JSON.parse(e)}catch{r=null}}return r}},$=(e,t)=>!c(e,t),x={attribute:!0,type:String,converter:k,reflect:!1,useDefault:!1,hasChanged:$};Symbol.metadata??=Symbol("metadata"),b.litPropertyMetadata??=new WeakMap;class E extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=x){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){let r=Symbol(),i=this.getPropertyDescriptor(e,r,t);void 0!==i&&u(this.prototype,e,i)}}static getPropertyDescriptor(e,t,r){let{get:i,set:s}=p(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:i,set(t){let n=i?.call(this);s?.call(this,t),this.requestUpdate(e,n,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??x}static _$Ei(){if(this.hasOwnProperty("elementProperties"))return;let e=f(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty("finalized"))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty("properties")){let e=this.properties;for(let t of[...m(e),...g(e)])this.createProperty(t,e[t])}let e=this[Symbol.metadata];if(null!==e){let t=litPropertyMetadata.get(e);if(void 0!==t)for(let[e,r]of t)this.elementProperties.set(e,r)}for(let[e,t]of(this._$Eh=new Map,this.elementProperties)){let r=this._$Eu(e,t);void 0!==r&&this._$Eh.set(r,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e))for(let r of new Set(e.flat(1/0).reverse()))t.unshift(h(r));else void 0!==e&&t.push(h(e));return t}static _$Eu(e,t){let r=t.attribute;return!1===r?void 0:"string"==typeof r?r:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){let e=new Map;for(let t of this.constructor.elementProperties.keys())this.hasOwnProperty(t)&&(e.set(t,this[t]),delete this[t]);e.size>0&&(this._$Ep=e)}createRenderRoot(){let e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(a)e.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(let r of t){let t=document.createElement("style"),i=n.litNonce;void 0!==i&&t.setAttribute("nonce",i),t.textContent=r.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,r){this._$AK(e,r)}_$ET(e,t){let r=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,r);if(void 0!==i&&!0===r.reflect){let s=(r.converter?.toAttribute!==void 0?r.converter:k).toAttribute(t,r.type);this._$Em=e,null==s?this.removeAttribute(i):this.setAttribute(i,s),this._$Em=null}}_$AK(e,t){let r=this.constructor,i=r._$Eh.get(e);if(void 0!==i&&this._$Em!==i){let e=r.getPropertyOptions(i),s="function"==typeof e.converter?{fromAttribute:e.converter}:e.converter?.fromAttribute!==void 0?e.converter:k;this._$Em=i,this[i]=s.fromAttribute(t,e.type)??this._$Ej?.get(i)??null,this._$Em=null}}requestUpdate(e,t,r){if(void 0!==e){let i=this.constructor,s=this[e];if(!(((r??=i.getPropertyOptions(e)).hasChanged??$)(s,t)||r.useDefault&&r.reflect&&s===this._$Ej?.get(e)&&!this.hasAttribute(i._$Eu(e,r))))return;this.C(e,t,r)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:r,reflect:i,wrapped:s},n){r&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,n??t??this[e]),!0!==s||void 0!==n)||(this._$AL.has(e)||(this.hasUpdated||r||(t=void 0),this._$AL.set(e,t)),!0===i&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}let e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(let[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}let e=this.constructor.elementProperties;if(e.size>0)for(let[t,r]of e){let{wrapped:e}=r,i=this[t];!0!==e||this._$AL.has(t)||void 0===i||this.C(t,void 0,r,i)}}let e=!1,t=this._$AL;try{(e=this.shouldUpdate(t))?(this.willUpdate(t),this._$EO?.forEach(e=>e.hostUpdate?.()),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach(e=>e.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(e=>this._$ET(e,this[e])),this._$EM()}updated(e){}firstUpdated(e){}}E.elementStyles=[],E.shadowRootOptions={mode:"open"},E.elementProperties=new Map,E.finalized=new Map,w?.({ReactiveElement:E}),(b.reactiveElementVersions??=[]).push("2.1.0");let S={attribute:!0,type:String,converter:k,reflect:!1,hasChanged:$};function F(e){return(t,r)=>{let i;return"object"==typeof r?((e=S,t,r)=>{let{kind:i,metadata:s}=r,n=globalThis.litPropertyMetadata.get(s);if(void 0===n&&globalThis.litPropertyMetadata.set(s,n=new Map),"setter"===i&&((e=Object.create(e)).wrapped=!0),n.set(r.name,e),"accessor"===i){let{name:i}=r;return{set(r){let s=t.get.call(this);t.set.call(this,r),this.requestUpdate(i,s,e)},init(t){return void 0!==t&&this.C(i,void 0,e,t),t}}}if("setter"===i){let{name:i}=r;return function(r){let s=this[i];t.call(this,r),this.requestUpdate(i,s,e)}}throw Error("Unsupported decorator location: "+i)})(e,t,r):(i=t.hasOwnProperty(r),t.constructor.createProperty(r,e),i?Object.getOwnPropertyDescriptor(t,r):void 0)}}function T(e){return F({...e,state:!0,attribute:!1})}class R{constructor(e={},t){this.options=e,this.hooks=new Map,this.eventEmitter=t}register(e){let t=this.hooks.get(e.name)||[];t.push(e),t.sort((e,t)=>t.priority-e.priority),this.hooks.set(e.name,t),this.emit("hook-registered",{hook:e.name,priority:e.priority}),this.options.debug&&console.debug(`[Formdown] Hook registered: ${e.name} (priority: ${e.priority})`)}unregister(e,t){let r=this.hooks.get(e)||[],i=r.filter(e=>e.handler!==t);i.length!==r.length&&(this.hooks.set(e,i),this.emit("hook-unregistered",{hook:e}),this.options.debug&&console.debug(`[Formdown] Hook unregistered: ${e}`))}async execute(e,t,...r){let i=this.hooks.get(e)||[],s=[];for(let n of(this.emit("hooks-executing",{hook:e,count:i.length}),i)){let i=null;try{i=this.options.timeout?this.createTimeoutPromise(this.options.timeout):null;let a=Promise.resolve(n.handler(t,...r)),l=i?await Promise.race([a,i.promise]):await a;i?.cleanup(),void 0!==l&&s.push(l),this.emit("hook-executed",{hook:e,success:!0})}catch(t){i?.cleanup(),this.handleHookError(e,t)}}return this.emit("hooks-completed",{hook:e,results:s.length}),s}executeSync(e,t,...r){let i=this.hooks.get(e)||[],s=[];for(let n of(this.emit("hooks-executing",{hook:e,count:i.length}),i))try{let i=n.handler(t,...r);void 0!==i&&s.push(i),this.emit("hook-executed",{hook:e,success:!0})}catch(t){this.handleHookError(e,t)}return this.emit("hooks-completed",{hook:e,results:s.length}),s}clear(e){e?(this.hooks.delete(e),this.emit("hooks-cleared",{hook:e})):(this.hooks.clear(),this.emit("hooks-cleared",{all:!0})),this.options.debug&&console.debug(`[Formdown] Hooks cleared: ${e||"all"}`)}getHooks(e){return[...this.hooks.get(e)||[]]}getHookNames(){return Array.from(this.hooks.keys())}getHookCount(){return Array.from(this.hooks.values()).reduce((e,t)=>e+t.length,0)}createTimeoutPromise(e){let t;return{promise:new Promise((r,i)=>{t=setTimeout(()=>{i(Error(`Hook execution timeout after ${e}ms`))},e)}),cleanup:()=>{clearTimeout(t)}}}handleHookError(e,t){let r=`Hook execution failed: ${e} - ${t.message||t}`;switch(this.emit("hook-error",{hook:e,error:r}),this.options.errorStrategy){case"ignore":break;case"warn":console.warn(`[Formdown] ${r}`);break;default:throw Error(r)}}emit(e,t){if(this.eventEmitter){let r={type:e,data:t,timestamp:Date.now()};this.eventEmitter.emit(e,r)}}}class C{constructor(e,t={},r,i){this.hookManager=e,this.options=t,this.eventEmitter=r,this.fieldTypeRegistry=i,this.plugins=new Map,this.fieldTypes=new Map,this.validators=new Map,this.renderers=new Map,this.themes=new Map,this.initialized=!1}async register(e){if(this.plugins.has(e.metadata.name))throw Error(`Plugin '${e.metadata.name}' is already registered`);if(await this.validateDependencies(e),this.plugins.set(e.metadata.name,e),e.hooks)for(let t of e.hooks)this.hookManager.register(t);if(e.fieldTypes)for(let t of e.fieldTypes)this.fieldTypes.set(t.type,t),this.fieldTypeRegistry?.register(t);if(e.validators)for(let t of e.validators)this.validators.set(t.name,t);if(e.renderers)for(let t of e.renderers)this.renderers.set(t.template,t);if(e.themes)for(let t of e.themes)this.themes.set(t.name,t);if(this.emit("plugin-registered",{plugin:e.metadata.name,version:e.metadata.version}),this.options.debug&&console.debug(`[Formdown] Plugin registered: ${e.metadata.name} v${e.metadata.version}`),this.initialized&&e.initialize)try{await e.initialize(),this.emit("plugin-initialized",{plugin:e.metadata.name})}catch(t){this.handlePluginError(e.metadata.name,"initialization",t)}}async unregister(e){let t=this.plugins.get(e);if(t){if(t.destroy)try{await t.destroy(),this.emit("plugin-destroyed",{plugin:e})}catch(t){this.handlePluginError(e,"cleanup",t)}if(t.hooks)for(let e of t.hooks)this.hookManager.unregister(e.name,e.handler);if(t.fieldTypes)for(let e of t.fieldTypes)this.fieldTypes.delete(e.type),this.fieldTypeRegistry?.unregister(e.type);if(t.validators)for(let e of t.validators)this.validators.delete(e.name);if(t.renderers)for(let e of t.renderers)this.renderers.delete(e.template);if(t.themes)for(let e of t.themes)this.themes.delete(e.name);this.plugins.delete(e),this.emit("plugin-unregistered",{plugin:e}),this.options.debug&&console.debug(`[Formdown] Plugin unregistered: ${e}`)}}get(e){return this.plugins.get(e)}getAll(){return Array.from(this.plugins.values())}isRegistered(e){return this.plugins.has(e)}async initialize(){if(this.initialized)return;this.emit("plugins-initializing",{count:this.plugins.size});let e=[];for(let t of this.plugins.values())t.initialize&&e.push(Promise.resolve(t.initialize()).catch(e=>this.handlePluginError(t.metadata.name,"initialization",e)));await Promise.all(e),this.initialized=!0,this.emit("plugins-initialized",{count:this.plugins.size}),this.options.debug&&console.debug(`[Formdown] ${this.plugins.size} plugins initialized`)}async destroy(){if(!this.initialized)return;this.emit("plugins-destroying",{count:this.plugins.size});let e=[];for(let t of this.plugins.values())t.destroy&&e.push(Promise.resolve(t.destroy()).catch(e=>this.handlePluginError(t.metadata.name,"cleanup",e)));await Promise.all(e),this.plugins.clear(),this.fieldTypes.clear(),this.validators.clear(),this.renderers.clear(),this.themes.clear(),this.initialized=!1,this.emit("plugins-destroyed",{count:0}),this.options.debug&&console.debug("[Formdown] All plugins destroyed and cleared")}getFieldTypes(){return new Map(this.fieldTypes)}getFieldType(e){return this.fieldTypes.get(e)}hasFieldType(e){return this.fieldTypes.has(e)}getValidators(){return new Map(this.validators)}getRenderers(){return new Map(this.renderers)}getThemes(){return new Map(this.themes)}async validateDependencies(e){if(e.metadata.dependencies){for(let t of e.metadata.dependencies)if(!this.isRegistered(t))throw Error(`Plugin '${e.metadata.name}' requires dependency '${t}' which is not registered`)}}handlePluginError(e,t,r){let i=`Plugin ${t} failed: ${e} - ${r.message||r}`;switch(this.emit("plugin-error",{plugin:e,operation:t,error:i}),this.options.errorStrategy){case"ignore":break;case"warn":console.warn(`[Formdown] ${i}`);break;default:throw Error(i)}}emit(e,t){this.eventEmitter&&this.eventEmitter.emit(e,t)}}class _{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){let r=this.listeners.get(e);r&&(r.delete(t),0===r.size&&this.listeners.delete(e))}emit(e,t){let r=this.listeners.get(e);if(!r)return;let i={type:e,data:t,timestamp:Date.now()};for(let t of r)try{t(i)}catch(t){console.error(`[Formdown] Event listener error in '${e}':`,t)}}once(e,t){let r=e=>{t(e),this.off(e.type,r)};this.on(e,r)}removeAllListeners(e){e?this.listeners.delete(e):this.listeners.clear()}listenerCount(e){return this.listeners.get(e)?.size||0}eventNames(){return Array.from(this.listeners.keys())}}class A{constructor(){this.fieldTypes=new Map,this.styleCache=new Map,this.scriptCache=new Map}register(e){if(this.fieldTypes.has(e.type))throw Error(`Field type '${e.type}' is already registered`);this.fieldTypes.set(e.type,e),e.styles&&this.styleCache.set(e.type,e.styles),e.clientScript&&this.scriptCache.set(e.type,e.clientScript)}unregister(e){this.fieldTypes.delete(e),this.styleCache.delete(e),this.scriptCache.delete(e)}get(e){return this.fieldTypes.get(e)}has(e){return this.fieldTypes.has(e)}getAll(){return new Map(this.fieldTypes)}parseField(e,t){for(let r of this.fieldTypes.values())if(r.parser){let i=r.parser(e,t);if(i)return r.defaultAttributes&&(i.attributes={...r.defaultAttributes,...i.attributes}),i}return null}generateFieldHTML(e,t){let r=this.fieldTypes.get(e.type);return r?.generator?r.generator(e,t):null}validateField(e,t){let r=this.fieldTypes.get(e.type);return r?.validator?r.validator(e,t):[]}processFieldData(e,t,r){let i=this.fieldTypes.get(e.type)?.dataProcessor;if(!i)return t;switch(r){case"input":return i.processInput?.(t,e)??t;case"output":return i.processOutput?.(t,e)??t;case"serialize":return i.serialize?.(t,e)??t;case"deserialize":return i.deserialize?.(t,e)??t;default:return t}}validateFieldData(e,t){let r=this.fieldTypes.get(e.type)?.dataProcessor;return r?.validate?r.validate(t,e):{valid:!0}}generateFieldSchema(e){let t=this.fieldTypes.get(e.type);return t?.schemaGenerator?t.schemaGenerator(e):null}getAllStyles(){return Array.from(this.styleCache.values()).join(`
`)}getStylesForTypes(e){return e.map(e=>this.styleCache.get(e)).filter(Boolean).join(`
`)}getAllScripts(){return Array.from(this.scriptCache.values()).join(`
`)}getScriptsForTypes(e){return e.map(e=>this.scriptCache.get(e)).filter(Boolean).join(`
`)}getStats(){return{registeredTypes:Array.from(this.fieldTypes.keys()),totalTypes:this.fieldTypes.size,typesWithStyles:Array.from(this.styleCache.keys()),typesWithScripts:Array.from(this.scriptCache.keys())}}clear(){this.fieldTypes.clear(),this.styleCache.clear(),this.scriptCache.clear()}}let M={metadata:{name:"formdown-core",version:"1.0.0",description:"Built-in field types and validators for Formdown",author:"Formdown Team"},fieldTypes:[{type:"text",parser:e=>{let t=e.match(/@(\w+):\s*\[text\](.*)/);if(!t)return null;let[,r,i]=t,s=P(i);return{name:r,type:"text",label:s.label||r,required:s.required||!1,placeholder:s.placeholder,pattern:s.pattern,attributes:s}},validator:(e,t)=>{let r=[];return e.required&&(!t||""===t.trim())&&r.push({type:"required",message:`${e.label} is required`}),e.pattern&&t&&!new RegExp(e.pattern).test(t)&&r.push({type:"pattern",value:e.pattern,message:`${e.label} does not match the required pattern`}),r},generator:e=>`<input ${['type="text"',`name="${e.name}"`,`id="${e.name}"`,e.placeholder?`placeholder="${e.placeholder}"`:"",e.required?"required":"",e.pattern?`pattern="${e.pattern}"`:""].filter(Boolean).join(" ")} />`},{type:"email",parser:e=>{let t=e.match(/@(\w+):\s*\[email\](.*)/);if(!t)return null;let[,r,i]=t,s=P(i);return{name:r,type:"email",label:s.label||r,required:s.required||!1,placeholder:s.placeholder,attributes:s}},validator:(e,t)=>{let r=[];return e.required&&(!t||""===t.trim())&&r.push({type:"required",message:`${e.label} is required`}),t&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)&&r.push({type:"pattern",message:`${e.label} must be a valid email address`}),r},generator:e=>`<input ${['type="email"',`name="${e.name}"`,`id="${e.name}"`,e.placeholder?`placeholder="${e.placeholder}"`:"",e.required?"required":""].filter(Boolean).join(" ")} />`},{type:"select",parser:e=>{let t,r=e.match(/@(\w+):\s*\[select\](.*)/);if(!r)return null;let[,i,s]=r,n=P(s),a=(t=s.match(/options=\[([^\]]*)\]/))?t[1].split(",").map(e=>e.trim().replace(/"/g,"")).filter(Boolean):[];return{name:i,type:"select",label:n.label||i,required:n.required||!1,options:a,allowOther:n.allowOther||!1,attributes:n}},generator:e=>{let t=[`name="${e.name}"`,`id="${e.name}"`,e.required?"required":""].filter(Boolean).join(" "),r=(e.options||[]).map(e=>`<option value="${e}">${e}</option>`).join(`
`);return`<select ${t}>
${r}
</select>`}},{type:"range",parser:(e,t)=>{for(let t of[/@(\w+)(?:\(([^)]+)\))?\s*:\s*\[range\](.*)/,/@(\w+)(?:\(([^)]+)\))?\s*:\s*\[range\s+([^\]]+)\](.*)/]){let r=e.match(t);if(r){let[,e,t,i="",s=""]=r,n=function(e){let t={},r=e.match(/min=(\d+)/);r&&(t.min=parseInt(r[1]));let i=e.match(/max=(\d+)/);i&&(t.max=parseInt(i[1]));let s=e.match(/step=(\d+\.?\d*)/);s&&(t.step=parseFloat(s[1]));let n=e.match(/value=(\d+\.?\d*)/);n&&(t.value=parseFloat(n[1]));let a=e.match(/unit="([^"]*)"/);a&&(t.unit=a[1]),e.includes("hideValue")&&(t.showValue=!1),e.includes("required")&&(t.required=!0);let l=e.match(/label="([^"]*)"/);return l&&(t.label=l[1]),t}((i||"")+(s||""));return{name:e,type:"range",label:t||n.label||e.split(/[_-]/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),required:n.required||!1,attributes:{min:n.min||0,max:n.max||100,step:n.step||1,value:n.value||Math.floor(((n.min||0)+(n.max||100))/2),showValue:!1!==n.showValue,unit:n.unit||"",...n}}}}return null},validator:(e,t)=>{let r=[],i=Number(t);if(e.required&&(null==t||""===t)&&r.push({type:"required",message:`${e.label} is required`}),null!=t&&""!==t)if(isNaN(i))r.push({type:"type",message:`${e.label} must be a number`});else{let t=Number(e.attributes?.min)||0,s=Number(e.attributes?.max)||100;i<t&&r.push({type:"min",value:t,message:`${e.label} must be at least ${t}`}),i>s&&r.push({type:"max",value:s,message:`${e.label} must be at most ${s}`});let n=Number(e.attributes?.step)||1;n>0&&(i-t)%n!=0&&r.push({type:"step",value:n,message:`${e.label} must be a multiple of ${n}`})}return r},generator:(e,t)=>{let{name:r,label:i,required:s,attributes:n={}}=e,a=Number(n.min)||0,l=Number(n.max)||100,o=Number(n.step)||1,d=void 0!==n.value?Number(n.value):Math.floor((a+l)/2),h=!1!==n.showValue,c=String(n.unit??""),u=`${r}-output`,p=t.metadata?.formId,m=Object.entries({type:"range",id:r,name:r,min:a,max:l,step:o,value:d,...s&&{required:!0},...p&&{form:p},...Object.fromEntries(Object.entries(n).filter(([e])=>!["min","max","step","value","showValue","unit","label"].includes(e)))}).map(([e,t])=>"boolean"==typeof t?t?e:"":`${e}="${t}"`).filter(Boolean).join(" "),g=h?`<output id="${u}" for="${r}" class="formdown-range-output">${d}${c}</output>`:"";return`
<div class="formdown-field formdown-range-field">
    <label for="${r}">${i}${s?" *":""}</label>
    <div class="formdown-range-container">
        <input ${m} data-formdown-range-output="${u}" data-formdown-range-unit="${c}">
        ${g}
    </div>
</div>`},dataProcessor:{processInput:(e,t)=>{let r=Number(e);return isNaN(r)?null:r},processOutput:(e,t)=>{if(null==e)return"";let r=t.attributes?.unit||"";return`${e}${r}`},validate:(e,t)=>{let r=Number(e);return null!=e&&""!==e&&isNaN(r)?{valid:!1,error:"Value must be a number"}:{valid:!0}},serialize:(e,t)=>String(e),deserialize:(e,t)=>{let r=Number(e);return isNaN(r)?null:r}},schemaGenerator:e=>{let t={type:"number",minimum:e.attributes?.min||0,maximum:e.attributes?.max||100};return e.attributes?.step&&(t.multipleOf=e.attributes.step),e.required&&(t.required=!0),e.label&&(t.title=e.label),t},styles:`
        .formdown-range-field .formdown-range-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .formdown-range-field input[type="range"] {
            flex: 1;
            min-width: 100px;
        }
        
        .formdown-range-output {
            min-width: 60px;
            text-align: center;
            font-weight: 600;
            padding: 4px 8px;
            background: #f5f5f5;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .formdown-range-field label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
    `,clientScript:`
        // Enhanced range field interactions
        document.addEventListener('DOMContentLoaded', function() {
            const rangeFields = document.querySelectorAll('.formdown-range-field input[type="range"]');
            
            rangeFields.forEach(function(input) {
                // Add keyboard navigation enhancement
                input.addEventListener('keydown', function(e) {
                    const step = parseFloat(this.step) || 1;
                    const currentValue = parseFloat(this.value);
                    
                    if (e.key === 'ArrowLeft' || e.key === 'ArrowDown') {
                        e.preventDefault();
                        this.value = Math.max(parseFloat(this.min), currentValue - step);
                        this.dispatchEvent(new Event('input', { bubbles: true }));
                    } else if (e.key === 'ArrowRight' || e.key === 'ArrowUp') {
                        e.preventDefault();
                        this.value = Math.min(parseFloat(this.max), currentValue + step);
                        this.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                });
                
                // Add visual feedback on interaction
                input.addEventListener('input', function() {
                    this.classList.add('active');
                    setTimeout(() => this.classList.remove('active'), 150);
                });
            });
        });
    `,defaultAttributes:{min:0,max:100,step:1,showValue:!0}}],validators:[{name:"required",validate:e=>null!=e&&""!==e,getMessage:(e,t)=>e.message||`${t.label} is required`},{name:"pattern",validate:(e,t)=>!e||!t.value||new RegExp(t.value).test(e),getMessage:(e,t)=>e.message||`${t.label} does not match the required pattern`},{name:"minlength",validate:(e,t)=>!e||e.length>=(t.value||0),getMessage:(e,t)=>e.message||`${t.label} must be at least ${e.value} characters long`}]};function P(e){let t={};e.includes("required")&&(t.required=!0);let r=e.match(/placeholder="([^"]*)"/);r&&(t.placeholder=r[1]);let i=e.match(/label="([^"]*)"/);i&&(t.label=i[1]);let s=e.match(/pattern="([^"]*)"/);return s&&(t.pattern=s[1]),e.includes("allowOther")&&(t.allowOther=!0),t}let z=new class{constructor(e={}){this.initialized=!1;const t={async:!0,timeout:1e3,errorStrategy:"warn",debug:!1,...e};this.eventEmitter=new _,this.hookManager=new R(t,this.eventEmitter),this.fieldTypeRegistry=new A,this.pluginManager=new C(this.hookManager,t,this.eventEmitter,this.fieldTypeRegistry),this.context={hooks:this.hookManager,plugins:this.pluginManager,fieldTypes:this.fieldTypeRegistry,options:t},this.setupErrorHandling()}async initialize(){if(!this.initialized){this.eventEmitter.emit("extension-system-initializing");try{await this.pluginManager.register(M),await this.pluginManager.initialize(),this.initialized=!0,this.eventEmitter.emit("extension-system-initialized"),this.context.options.debug&&console.debug("[Formdown] Extension system initialized")}catch(e){throw this.eventEmitter.emit("extension-system-error",{phase:"initialization",error:e instanceof Error?e.message:String(e)}),e}}}async destroy(){if(this.initialized){this.eventEmitter.emit("extension-system-destroying");try{await this.pluginManager.destroy(),this.hookManager.clear(),this.eventEmitter.removeAllListeners(),this.initialized=!1,this.eventEmitter.emit("extension-system-destroyed"),this.context.options.debug&&console.debug("[Formdown] Extension system destroyed")}catch(e){throw this.eventEmitter.emit("extension-system-error",{phase:"destruction",error:e instanceof Error?e.message:String(e)}),e}}}async registerPlugin(e){return this.ensureInitialized(),this.pluginManager.register(e)}async unregisterPlugin(e){return this.ensureInitialized(),this.pluginManager.unregister(e)}registerHook(e){this.ensureInitialized(),this.hookManager.register(e)}async executeHooks(e,t,...r){return this.ensureInitialized(),this.hookManager.execute(e,t,...r)}executeHooksSync(e,t,...r){return this.ensureInitialized(),this.hookManager.executeSync(e,t,...r)}getContext(){return{...this.context}}getFieldTypeRegistry(){return this.fieldTypeRegistry}getEventEmitter(){return this.eventEmitter}getStats(){return{initialized:this.initialized,plugins:this.pluginManager.getAll().map(e=>({name:e.metadata.name,version:e.metadata.version})),hookCount:this.hookManager.getHookCount(),registeredHooks:this.hookManager.getHookNames(),fieldTypes:Array.from(this.pluginManager.getFieldTypes().keys()),validators:Array.from(this.pluginManager.getValidators().keys()),renderers:Array.from(this.pluginManager.getRenderers().keys()),themes:Array.from(this.pluginManager.getThemes().keys())}}enableDebug(){this.context.options.debug=!0,console.debug("[Formdown] Debug mode enabled"),console.debug("[Formdown] Extension system stats:",this.getStats())}disableDebug(){this.context.options.debug=!1}setupErrorHandling(){this.eventEmitter.on("hook-error",e=>{this.context.options.debug&&console.error("[Formdown] Hook error:",e.data)}),this.eventEmitter.on("plugin-error",e=>{this.context.options.debug&&console.error("[Formdown] Plugin error:",e.data)}),this.eventEmitter.on("extension-system-error",e=>{console.error("[Formdown] Extension system error:",e.data)})}ensureInitialized(){if(!this.initialized)throw Error("Extension system must be initialized before use")}};async function D(e){return z.registerPlugin(e)}function L(e){return z.registerHook(e)}class I{constructor(e={}){this.formDeclarations=[],this.datalistDeclarations=[],this.groupDeclarations=[],this.currentFormId=null,this.currentGroupId=null,this.formCounter=1,this.defaultFormCreated=!1,this.options={preserveMarkdown:!0,fieldPrefix:"@",inlineFieldDelimiter:"___",autoGenerateFormIds:!0,...e}}parseFormdown(e){this.formDeclarations=[],this.datalistDeclarations=[],this.groupDeclarations=[],this.currentFormId=null,this.currentGroupId=null,this.formCounter=1,this.defaultFormCreated=!1;let{fields:t,cleanedMarkdown:r}=this.extractFields(e);return{markdown:this.options.preserveMarkdown?r:"",forms:t,formDeclarations:this.formDeclarations,datalistDeclarations:this.datalistDeclarations,groupDeclarations:this.groupDeclarations}}parse(e){let{fields:t}=this.extractFields(e);return{fields:t,errors:[]}}extractFields(e){let t=[],r=e.split(`
`),i=[];for(let e=0;e<r.length;e++){let s=r[e],n=this.parseFormDeclaration(s);if(n){this.formDeclarations.push(n),this.currentFormId=n.id,i.push("");continue}let a=this.parseDatalistDeclaration(s);if(a){this.datalistDeclarations.push(a),i.push("");continue}let l=this.parseShorthandDatalist(s);if(l){this.datalistDeclarations.push(l),i.push("");continue}let o=this.parseGroupDeclaration(s,e);if(o){this.currentGroupId&&i.push(`<!--FORMDOWN_GROUP_END_${this.currentGroupId}-->`),this.groupDeclarations.push(o),this.currentGroupId=o.id,i.push(`<!--FORMDOWN_GROUP_START_${o.id}-->`);continue}if(this.currentGroupId&&/^##\s+[^\[]/.test(s)&&(i.push(`<!--FORMDOWN_GROUP_END_${this.currentGroupId}-->`),this.currentGroupId=null),s.trim().startsWith("|")){let s=this.parseTableBlock(r,e);if(s){s.fields.forEach(e=>this.associateFieldWithForm(e)),t.push(...s.fields),i.push(s.tableHtml),e=s.endIndex;continue}}let d=this.parseBlockField(s);if(d){this.associateFieldWithForm(d),t.push(d),i.push(`<!--FORMDOWN_FIELD_${t.length-1}-->`);continue}let{cleanedLine:h,inlineFields:c}=this.parseInlineFields(s);c.forEach(e=>this.associateFieldWithForm(e)),t.push(...c),i.push(h)}return this.currentGroupId&&i.push(`<!--FORMDOWN_GROUP_END_${this.currentGroupId}-->`),{fields:t,cleanedMarkdown:i.join(`
`)}}parseBlockField(e){let t=e.trim(),r=z.getFieldTypeRegistry().parseField(t,{input:t});if(r)return r;let i=this.parseActionElement(t);if(i)return i;if(/^@\w+\*/.test(t)||/^@\w+\{[^}]*\}/.test(t)||/^@\w+\s*:\s*(dt|d|[#@%&t?TrscRFCMW$])\d*\[/.test(t)||/^@\w+\([^)]+\)\*/.test(t)||/^@\w+\([^)]+\)\{[^}]*\}/.test(t)||/^@\w+\([^)]+\)\s*:\s*(dt|d|[#@%&t?TrscRFCMW$])\d*\[/.test(t)){let e=this.parseShorthandBlockField(t);if(e)return e}let s=t.match(/^@(\w+)(?:\(([^)]+)\))?\s*:\s*\[((?:[^\]"']|"[^"]*"|'[^']*')*)\].*$/);if(!s)return null;let[,n,a,l]=s;return this.createField(n,a,l)}parseShorthandBlockField(e){let t=e.match(/^@(\w+)(\*)?(?:\{(.*?)\})?(?:\(([^)]+)\))?\s*:\s*(?:(dt|d|[#@%&t?TrscRFCMW$])(\d*)?)?\[([^\]]*)\].*$/);if(!t&&(t=e.match(/^@(\w+)(?:\(([^)]+)\))?(\*)?(?:\{(.*?)\})?\s*:\s*(?:(dt|d|[#@%&t?TrscRFCMW$])(\d*)?)?\[([^\]]*)\].*$/))){let[,e,r,i,s,n,a,l]=t;t=[t[0],e,i,s,r,n,a,l]}if(!t)return null;let[,r,i,s,n,a,l,o]=t;return i||void 0!==s||n||a||l?this.convertShorthandToField(r,i,s,n,a||"",l,o):null}parseInlineFields(e){let t=[],r=this.options.inlineFieldDelimiter,i=RegExp(`(dt|d|[#@%&t?TrscRFCMW$]?)${r}@(\\w+)(\\*)?(?:\\{([^}]*)\\})?(?:\\(([^)]+)\\))?(?:\\[([^\\]]*)\\]|\\:\\s*([^\\s]*?)\\[([^\\]]*)\\])?`,"g"),s=e.replace(i,(e,r,i,s,n,a,l,o,d)=>{if(!r&&!s&&!n&&!l&&!o&&!d||!r&&l&&["text","email","password","number","tel","url","search","date","time","datetime-local","month","week","color","file","range","radio","checkbox","select","textarea","submit","reset","button","hidden"].includes(l.split(/\s/)[0]))return e;let h=l||d||"",c=this.convertShorthandToField(i,s,n,a,r||o||"","",h);if(c){c.inline=!0,t.push(c);let e=c.required?' data-required="true"':"";return`<span contenteditable="true" data-field-name="${i}" data-field-type="${c.type}" data-placeholder="${c.label||i}" class="formdown-inline-field" role="textbox"${e}>${c.label||i}</span>`}return e}),n=RegExp(`${r}@(\\w+)(?:\\{([^}]*)\\})?(?:\\(([^)]+)\\))?(?:\\:\\s*([^\\s]*?)\\[([^\\]]*)\\]|\\[([^\\]]*)\\])?`,"g");return{cleanedLine:s=s.replace(n,(e,r,i,s,n,a,l)=>{if(t.some(e=>e.name===r))return e;let o="text";n&&void 0!==a?o=a.trim()?`${n} ${a}`:n:void 0!==l&&(o=l);let d=this.createField(r,s,o);if(d&&i){let e=i.split(",").map(e=>e.trim()).filter(e=>e.length>0);if(e.length>0)if(["select","radio","checkbox"].includes(d.type))d.options=e;else{let e=`datalist-${Math.floor(1e9*Math.random())}`;d.attributes=d.attributes||{},d.attributes.list=e}}if(d){d.inline=!0,t.push(d);let e=d.required?' data-required="true"':"";return`<span contenteditable="true" data-field-name="${r}" data-field-type="${d.type}" data-placeholder="${d.label||r}" class="formdown-inline-field" role="textbox"${e}>${d.label||r}</span>`}return e}),inlineFields:t}}convertShorthandToField(e,t,r,i,s,n,a){let l={"@":"email","#":"number","%":"tel","&":"url",d:"date",t:"time",dt:"datetime-local","?":"password",T:"textarea",r:"radio",s:"select",c:"checkbox",R:"range",F:"file",C:"color",M:"month",W:"week",$:"number"}[s]||"text",o=a?this.parseAttributes(a):{};if("*"===t&&(o.required=!0),"textarea"===l&&n&&(o.rows=parseInt(n,10)),"$"===s&&(o.inputmode="decimal",o.step="0.01",o.placeholder||(o.placeholder="0.00")),r){let e=this.interpretContent(r,s);o={...o,...e}}let d=this.buildTypeAndAttributesString(l,o);return this.createField(e,i,d)}interpretContent(e,t){if(["r","s","c"].includes(t)){let t=e.split(",").map(e=>e.trim()).filter(e=>e.length>0),r=!1,i="Other",s={options:t.filter(e=>"*"===e?(r=!0,!1):!(e.startsWith("*(")&&e.endsWith(")"))||(r||(r=!0,i=e.slice(2,-1)),!1)).join(",")||""};return r&&(s["allow-other"]=!0,"Other"!==i&&(s["other-label"]=i)),s}if(["d","t","dt"].includes(t))return{format:e};let r=e.includes(","),i=e.match(/^\^.*\$$/)||e.includes("[")&&e.includes("]")&&!r||e.includes("\\"),s=e.includes("#")||!r&&e.includes("*");if(i||s){let t=e;return(e.includes("#")||e.includes("*")&&!e.match(/^\^.*\$$/))&&(t="^"+e.replace(/[().\/]/g,"\\$&").replace(/-/g,"\\-").replace(/#{1,}/g,e=>`\\d{${e.length}}`).replace(/\*/g,".*").replace(/\?/g,".")+"$"),{pattern:t}}if(e&&!["r","s","c","d","t","dt"].includes(t)&&(r||!i&&e.length>0)){let t=e.split(",").map(e=>e.trim()).filter(e=>e.length>0);if(t.length>0){let r=this.generateDatalistId(e);return this.datalistDeclarations.find(e=>e.id===r)||this.datalistDeclarations.push({id:r,options:t}),{list:r}}}return{pattern:e}}parseAttributes(e){let t={};for(let r of Array.from(e.matchAll(/([\w-]+)(?:=(?:"((?:[^"\\]|\\.)*)"|'((?:[^'\\]|\\.)*)'|([^\s]+)))?/g))){let[,e,i,s,n]=r;if("required"===e)t.required=!0;else if(void 0!==i||void 0!==s||void 0!==n){let r=void 0!==i?i:void 0!==s?s:n;t[e]=this.parseAttributeValue(r)}else t[e]=!0}return t}buildTypeAndAttributesString(e,t){let r=[e];for(let[e,i]of Object.entries(t))!0===i?r.push(e):"string"==typeof i?r.push(`${e}="${i}"`):r.push(`${e}=${i}`);return r.join(" ")}createField(e,t,r){if(/^\d/.test(e)||!e.trim())return null;if(!r.trim())return{name:e,type:"text",label:t||this.formatLabel(e),attributes:{}};let i=Array.from(r.matchAll(/([\w-]+)(?:=(?:"([^"]*)"|'([^']*)'|([^\s]+)))?/g));if(0===i.length)return null;let s="text",n=-1;for(let e=0;e<i.length;e++){let[,t,r,a,l]=i[e];if(!r&&!a&&!l){let r={s:"select",r:"radio",c:"checkbox",T:"textarea","@":"email","#":"number","%":"tel",$:"number","?":"password",t:"time",d:"date",dt:"datetime-local"}[t]||t;if(["text","email","password","number","tel","url","search","date","time","datetime-local","month","week","color","file","range","radio","checkbox","select","textarea","submit","reset","button","hidden"].includes(r)){s=r,n=e;break}}}let a={name:e,type:s,label:t||this.formatLabel(e),attributes:{}};for(let e=0;e<i.length;e++){if(e===n)continue;let[,t,r,l,o]=i[e];if("required"===t)a.required=!0;else if("label"===t&&(void 0!==r||void 0!==l||void 0!==o))a.label=r||l||o;else if("placeholder"===t&&(void 0!==r||void 0!==l||void 0!==o))a.placeholder=r||l||o;else if("options"===t&&(void 0!==r||void 0!==l||void 0!==o)){let e=r||l||o;if(["radio","checkbox","select"].includes(s))if(e){let t=e.split(",").map(e=>e.trim()).filter(e=>e.length>0),r=!1,i="Other";a.options=t.filter(e=>"*"===e?(r=!0,!1):!(e.startsWith("*(")&&e.endsWith(")"))||(r||(r=!0,i=e.slice(2,-1)),!1)),r&&(a.allowOther=!0,"Other"!==i&&(a.otherLabel=i))}else a.options=[]}else if("allow-other"===t)a.allowOther=!0;else if("other-label"===t&&(void 0!==r||void 0!==l||void 0!==o))a.otherLabel=r||l||o;else if("format"===t&&(void 0!==r||void 0!==l||void 0!==o))a.format=r||l||o;else if("pattern"===t&&(void 0!==r||void 0!==l||void 0!==o))a.pattern=r||l||o;else if("content"===t&&(void 0!==r||void 0!==l||void 0!==o))a.content=r||l||o;else if("value"===t)void 0!==r||void 0!==l?a.value=void 0!==r?r:l:void 0!==o?a.value=this.parseAttributeValue(o):a.value="";else if("datalist"===t&&(void 0!==r||void 0!==l||void 0!==o)){let e=r||l||o;if(e.startsWith("#"))a.attributes.list=e.slice(1);else{let t=e.split(",").map(e=>e.trim()).filter(e=>e.length>0);if(t.length>0){let r=this.generateDatalistId(e);a.attributes.list=r,this.datalistDeclarations.find(e=>e.id===r)||this.datalistDeclarations.push({id:r,options:t})}}}else if("visible-if"===t&&(void 0!==r||void 0!==l||void 0!==o)){let e=r||l||o,t=this.parseCondition(e);t&&(a.conditions||(a.conditions={}),a.conditions.visibleIf=t)}else if("hidden-if"===t&&(void 0!==r||void 0!==l||void 0!==o)){let e=r||l||o,t=this.parseCondition(e);t&&(a.conditions||(a.conditions={}),a.conditions.hiddenIf=t)}else if("enabled-if"===t&&(void 0!==r||void 0!==l||void 0!==o)){let e=r||l||o,t=this.parseCondition(e);t&&(a.conditions||(a.conditions={}),a.conditions.enabledIf=t)}else if("disabled-if"===t&&(void 0!==r||void 0!==l||void 0!==o)){let e=r||l||o,t=this.parseCondition(e);t&&(a.conditions||(a.conditions={}),a.conditions.disabledIf=t)}else if("required-if"===t&&(void 0!==r||void 0!==l||void 0!==o)){let e=r||l||o,t=this.parseCondition(e);t&&(a.conditions||(a.conditions={}),a.conditions.requiredIf=t)}else if(void 0!==r||void 0!==l||void 0!==o){let e=r||l||o;a.attributes[t]=this.parseAttributeValue(e)}else a.attributes[t]=!0}return a}formatLabel(e){return e.includes("_")?e.split("_").map(e=>this.capitalizeWord(e)).join(" "):/[a-z][A-Z]/.test(e)?e.replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(e=>this.capitalizeWord(e)).join(" "):this.capitalizeWord(e)}capitalizeWord(e){return e&&e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}parseCondition(e){if(!e||!e.trim())return null;let t=e.trim(),r=t.match(/^([\w_]+)=(.+)$/);if(r)return{field:r[1],operator:"=",value:r[2]};let i=t.match(/^([\w_]+)!=(.+)$/);if(i)return{field:i[1],operator:"!=",value:i[2]};if(t.startsWith("!")){let e=t.slice(1).trim();if(e&&/^[\w_]+$/.test(e))return{field:e,operator:"falsy"}}return/^[\w_]+$/.test(t)?{field:t,operator:"truthy"}:null}parseActionElement(e){let t=e.match(/^@\[(\w+)\s+"([^"]+)"([^\]]*)\]$/);if(!t)return null;let[,r,i,s]=t;if(!["submit","reset","button","image"].includes(r))return null;let n=`${r}_${Math.random().toString(36).substr(2,9)}`,a={};s.trim()&&Object.assign(a,this.parseAttributes(s.trim()));let l={name:n,type:"image"===r?"image":"button",label:i,attributes:{type:r,...a}};return"image"!==r||a.src||console.warn(`Image action element missing src attribute: ${e}`),l}parseAttributeValue(e){if(""===e)return"";let t=e.replace(/\\(.)/g,"$1");return/^-?\d+$/.test(t)?parseInt(t,10):/^-?\d*\.\d+$/.test(t)?parseFloat(t):"true"===t||"false"!==t&&t}parseFormDeclaration(e){let t=e.trim().match(/^@form\[([^\]]*)\]\s*$/);if(!t)return null;let r=t[1],i=this.parseAttributes(r),s=i.id||this.generateFormId();return i.id&&delete i.id,{id:s,attributes:i}}generateFormId(){return`formdown-form-${this.formCounter++}`}generateDatalistId(e){let t=e.toLowerCase().replace(/\s+/g,"").replace(/,/g,"-").split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0);return`datalist-${Math.abs(t)}`}parseShorthandDatalist(e){let t=e.trim().match(/^@#([a-zA-Z_][a-zA-Z0-9_-]*)\s*:\s*(.+)$/);if(!t)return null;let r=t[1],i=t[2].split(",").map(e=>e.trim()).filter(e=>e.length>0);return 0===i.length?(console.warn("Shorthand datalist declaration has empty options:",e),null):{id:r,options:i}}parseDatalistDeclaration(e){let t=e.trim().match(/^@datalist\[([^\]]*)\]\s*$/);if(!t)return null;let r=t[1],i=this.parseAttributes(r);if(!i.id)return console.warn("Datalist declaration missing required id attribute:",e),null;if(void 0===i.options)return console.warn("Datalist declaration missing required options attribute:",e),null;let s="string"==typeof i.options?i.options.split(",").map(e=>e.trim()).filter(e=>e.length>0):[];return 0===s.length?(console.warn("Datalist declaration has empty options:",e),null):{id:i.id,options:s}}parseGroupDeclaration(e,t){let r=e.trim().match(/^##\s*\[([^\]]+)\]\s*$/);if(!r)return null;let i=r[1].trim(),s=i,n=!1,a=!1;return i.endsWith(" collapsed")?(s=i.slice(0,-10).trim(),n=!0,a=!0):i.endsWith(" collapsible")&&(s=i.slice(0,-12).trim(),n=!0),{id:"formdown-group-"+s.toLowerCase().replace(/[^a-z0-9가-힣]+/gi,"-").replace(/^-+|-+$/g,""),label:s,position:t,collapsible:n||void 0,collapsed:a||void 0}}getDefaultFormId(){return this.defaultFormCreated||(this.defaultFormCreated=!0,this.formDeclarations.push({id:"formdown-form-default",attributes:{action:".",method:"GET"}})),"formdown-form-default"}associateFieldWithForm(e){e.attributes?.form?this.formDeclarations.some(t=>t.id===e.attributes.form)||(console.warn(`FormDown: Referenced form "${e.attributes.form}" does not exist. Using current or default form.`),e.attributes.form=this.currentFormId||this.getDefaultFormId()):this.currentFormId?(e.attributes||(e.attributes={}),e.attributes.form=this.currentFormId):(e.attributes||(e.attributes={}),e.attributes.form=this.getDefaultFormId()),this.currentGroupId&&(e.group=this.currentGroupId)}parseTableBlock(e,t){let r=[],i=t;for(;i<e.length&&e[i].trim().startsWith("|");)r.push(e[i]),i++;if(r.length<3)return null;let s=r[0],n=r[1];if(!/^\|[\s\-|:]+\|$/.test(n.trim()))return null;let a=[],l=this.parseTableRow(s),o=[];for(let e=2;e<r.length;e++){let t=this.parseTableRow(r[e]),i=[];for(let e of t){let{cleanedLine:t,inlineFields:r}=this.parseInlineFields(e);a.push(...r),i.push(t)}o.push(i)}return{fields:a,tableHtml:this.generateTableHtml(l,o),endIndex:i-1}}parseTableRow(e){return e.trim().replace(/^\||\|$/g,"").split("|").map(e=>e.trim())}generateTableHtml(e,t){let r=e.map(e=>`<th>${this.escapeHtml(e)}</th>`).join(""),i=t.map(e=>`<tr>${e.map(e=>`<td>${e}</td>`).join("")}</tr>`).join(`
`);return`<table class="formdown-table">
<thead>
<tr>${r}</tr>
</thead>
<tbody>
${i}
</tbody>
</table>`}escapeHtml(e){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,e=>t[e]||e)}}function O(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var q=O(),B={exec:()=>null};function H(e,t=""){let r="string"==typeof e?e:e.source,i={replace:(e,t)=>{let s="string"==typeof t?t:t.source;return s=s.replace(V.caret,"$1"),r=r.replace(e,s),i},getRegex:()=>new RegExp(r,t)};return i}var V={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>RegExp(`^( {0,3}${e})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:e=>RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},j=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,N=/(?:[*+-]|\d{1,9}[.)])/,U=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,W=H(U).replace(/bull/g,N).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),G=H(U).replace(/bull/g,N).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Z=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Q=/(?!\s*\])(?:\\.|[^\[\]\\])+/,K=H(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Q).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),J=H(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,N).getRegex(),X="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Y=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,ee=H("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Y).replace("tag",X).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),et=H(Z).replace("hr",j).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",X).getRegex(),er={blockquote:H(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",et).getRegex(),code:/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,def:K,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:j,html:ee,lheading:W,list:J,newline:/^(?:[ \t]*(?:\n|$))+/,paragraph:et,table:B,text:/^[^\n]+/},ei=H("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",j).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",X).getRegex(),es={...er,lheading:G,table:ei,paragraph:H(Z).replace("hr",j).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",ei).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",X).getRegex()},en={...er,html:H(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Y).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:B,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:H(Z).replace("hr",j).replace("heading",` *#{1,6} *[^
]`).replace("lheading",W).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},ea=/^( {2,}|\\)\n(?!\s*$)/,el=/[\p{P}\p{S}]/u,eo=/[\s\p{P}\p{S}]/u,ed=/[^\s\p{P}\p{S}]/u,eh=H(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,eo).getRegex(),ec=/(?!~)[\p{P}\p{S}]/u,eu=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,ep=H(eu,"u").replace(/punct/g,el).getRegex(),em=H(eu,"u").replace(/punct/g,ec).getRegex(),eg="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",ef=H(eg,"gu").replace(/notPunctSpace/g,ed).replace(/punctSpace/g,eo).replace(/punct/g,el).getRegex(),eb=H(eg,"gu").replace(/notPunctSpace/g,/(?:[^\s\p{P}\p{S}]|~)/u).replace(/punctSpace/g,/(?!~)[\s\p{P}\p{S}]/u).replace(/punct/g,ec).getRegex(),ev=H("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,ed).replace(/punctSpace/g,eo).replace(/punct/g,el).getRegex(),ey=H(/\\(punct)/,"gu").replace(/punct/g,el).getRegex(),ew=H(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),ek=H(Y).replace("(?:-->|$)","-->").getRegex(),e$=H("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",ek).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),ex=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,eE=H(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",ex).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),eS=H(/^!?\[(label)\]\[(ref)\]/).replace("label",ex).replace("ref",Q).getRegex(),eF=H(/^!?\[(ref)\](?:\[\])?/).replace("ref",Q).getRegex(),eT=H("reflink|nolink(?!\\()","g").replace("reflink",eS).replace("nolink",eF).getRegex(),eR={_backpedal:B,anyPunctuation:ey,autolink:ew,blockSkip:/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,br:ea,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:B,emStrongLDelim:ep,emStrongRDelimAst:ef,emStrongRDelimUnd:ev,escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,link:eE,nolink:eF,punctuation:eh,reflink:eS,reflinkSearch:eT,tag:e$,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:B},eC={...eR,link:H(/^!?\[(label)\]\((.*?)\)/).replace("label",ex).getRegex(),reflink:H(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",ex).getRegex()},e_={...eR,emStrongRDelimAst:eb,emStrongLDelim:em,url:H(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},eA={...e_,br:H(ea).replace("{2,}","*").getRegex(),text:H(e_.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},eM={normal:er,gfm:es,pedantic:en},eP={normal:eR,gfm:e_,breaks:eA,pedantic:eC},ez={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},eD=e=>ez[e];function eL(e,t){if(t){if(V.escapeTest.test(e))return e.replace(V.escapeReplace,eD)}else if(V.escapeTestNoEncode.test(e))return e.replace(V.escapeReplaceNoEncode,eD);return e}function eI(e){try{e=encodeURI(e).replace(V.percentDecode,"%")}catch{return null}return e}function eO(e,t){let r=e.replace(V.findPipe,(e,t,r)=>{let i=!1,s=t;for(;--s>=0&&"\\"===r[s];)i=!i;return i?"|":" |"}).split(V.splitPipe),i=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),t)if(r.length>t)r.splice(t);else for(;r.length<t;)r.push("");for(;i<r.length;i++)r[i]=r[i].trim().replace(V.slashPipe,"|");return r}function eq(e,t,r){let i=e.length;if(0===i)return"";let s=0;for(;s<i&&e.charAt(i-s-1)===t;)s++;return e.slice(0,i-s)}function eB(e,t,r,i,s){let n=t.href,a=t.title||null,l=e[1].replace(s.other.outputLinkReplace,"$1");i.state.inLink=!0;let o={type:"!"===e[0].charAt(0)?"image":"link",raw:r,href:n,title:a,text:l,tokens:i.inlineTokens(l)};return i.state.inLink=!1,o}var eH=class{options;rules;lexer;constructor(e){this.options=e||q}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let e=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:eq(e,`
`)}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let e=t[0],r=function(e,t,r){let i=e.match(r.other.indentCodeCompensation);if(null===i)return t;let s=i[1];return t.split(`
`).map(e=>{let t=e.match(r.other.beginningSpace);if(null===t)return e;let[i]=t;return i.length>=s.length?e.slice(s.length):e}).join(`
`)}(e,t[3]||"",this.rules);return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:r}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(this.rules.other.endingHash.test(e)){let t=eq(e,"#");(this.options.pedantic||!t||this.rules.other.endingSpaceChar.test(t))&&(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:eq(t[0],`
`)}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let e=eq(t[0],`
`).split(`
`),r="",i="",s=[];for(;e.length>0;){let t,n=!1,a=[];for(t=0;t<e.length;t++)if(this.rules.other.blockquoteStart.test(e[t]))a.push(e[t]),n=!0;else if(n)break;else a.push(e[t]);e=e.slice(t);let l=a.join(`
`),o=l.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${l}`:l,i=i?`${i}
${o}`:o;let d=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(o,s,!0),this.lexer.state.top=d,0===e.length)break;let h=s.at(-1);if(h?.type==="code")break;if(h?.type==="blockquote"){let t=h.raw+`
`+e.join(`
`),n=this.blockquote(t);s[s.length-1]=n,r=r.substring(0,r.length-h.raw.length)+n.raw,i=i.substring(0,i.length-h.text.length)+n.text;break}if(h?.type==="list"){let t=h.raw+`
`+e.join(`
`),n=this.list(t);s[s.length-1]=n,r=r.substring(0,r.length-h.raw.length)+n.raw,i=i.substring(0,i.length-h.raw.length)+n.raw,e=t.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:s,text:i}}}list(e){let t=this.rules.block.list.exec(e);if(t){let r=t[1].trim(),i=r.length>1,s={type:"list",raw:"",ordered:i,start:i?+r.slice(0,-1):"",loose:!1,items:[]};r=i?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=i?r:"[*+-]");let n=this.rules.other.listItemRegex(r),a=!1;for(;e;){let r=!1,i="",l="";if(!(t=n.exec(e))||this.rules.block.hr.test(e))break;i=t[0],e=e.substring(i.length);let o=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,e=>" ".repeat(3*e.length)),d=e.split(`
`,1)[0],h=!o.trim(),c=0;if(this.options.pedantic?(c=2,l=o.trimStart()):h?c=t[1].length+1:(c=(c=t[2].search(this.rules.other.nonSpaceChar))>4?1:c,l=o.slice(c),c+=t[1].length),h&&this.rules.other.blankLine.test(d)&&(i+=d+`
`,e=e.substring(d.length+1),r=!0),!r){let t=this.rules.other.nextBulletRegex(c),r=this.rules.other.hrRegex(c),s=this.rules.other.fencesBeginRegex(c),n=this.rules.other.headingBeginRegex(c),a=this.rules.other.htmlBeginRegex(c);for(;e;){let u,p=e.split(`
`,1)[0];if(d=p,u=this.options.pedantic?d=d.replace(this.rules.other.listReplaceNesting,"  "):d.replace(this.rules.other.tabCharGlobal,"    "),s.test(d)||n.test(d)||a.test(d)||t.test(d)||r.test(d))break;if(u.search(this.rules.other.nonSpaceChar)>=c||!d.trim())l+=`
`+u.slice(c);else{if(h||o.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||s.test(o)||n.test(o)||r.test(o))break;l+=`
`+d}h||d.trim()||(h=!0),i+=p+`
`,e=e.substring(p.length+1),o=u.slice(c)}}s.loose||(a?s.loose=!0:this.rules.other.doubleBlankLine.test(i)&&(a=!0));let u=null,p;this.options.gfm&&(u=this.rules.other.listIsTask.exec(l))&&(p="[ ] "!==u[0],l=l.replace(this.rules.other.listReplaceTask,"")),s.items.push({type:"list_item",raw:i,task:!!u,checked:p,loose:!1,text:l,tokens:[]}),s.raw+=i}let l=s.items.at(-1);if(!l)return;l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd(),s.raw=s.raw.trimEnd();for(let e=0;e<s.items.length;e++)if(this.lexer.state.top=!1,s.items[e].tokens=this.lexer.blockTokens(s.items[e].text,[]),!s.loose){let t=s.items[e].tokens.filter(e=>"space"===e.type);s.loose=t.length>0&&t.some(e=>this.rules.other.anyLine.test(e.raw))}if(s.loose)for(let e=0;e<s.items.length;e++)s.items[e].loose=!0;return s}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:"pre"===t[1]||"script"===t[1]||"style"===t[1],text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let e=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:r,title:i}}}table(e){let t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let r=eO(t[1]),i=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],n={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===i.length){for(let e of i)this.rules.other.tableAlignRight.test(e)?n.align.push("right"):this.rules.other.tableAlignCenter.test(e)?n.align.push("center"):this.rules.other.tableAlignLeft.test(e)?n.align.push("left"):n.align.push(null);for(let e=0;e<r.length;e++)n.header.push({text:r[e],tokens:this.lexer.inline(r[e]),header:!0,align:n.align[e]});for(let e of s)n.rows.push(eO(e,n.header.length).map((e,t)=>({text:e,tokens:this.lexer.inline(e),header:!1,align:n.align[t]})));return n}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let e=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let e=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(e)){if(!this.rules.other.endAngleBracket.test(e))return;let t=eq(e.slice(0,-1),"\\");if((e.length-t.length)%2==0)return}else{let e=function(e,t){if(-1===e.indexOf(")"))return -1;let r=0;for(let t=0;t<e.length;t++)if("\\"===e[t])t++;else if("("===e[t])r++;else if(")"===e[t]&&--r<0)return t;return r>0?-2:-1}(t[2],0);if(-2===e)return;if(e>-1){let r=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,r).trim(),t[3]=""}}let r=t[2],i="";if(this.options.pedantic){let e=this.rules.other.pedanticHrefTitle.exec(r);e&&(r=e[1],i=e[3])}else i=t[3]?t[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(r=this.options.pedantic&&!this.rules.other.endAngleBracket.test(e)?r.slice(1):r.slice(1,-1)),eB(t,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let e=t[(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!e){let e=r[0].charAt(0);return{type:"text",raw:e,text:e}}return eB(r,e,r[0],this.lexer,this.rules)}}emStrong(e,t,r=""){let i=this.rules.inline.emStrongLDelim.exec(e);if(!(!i||i[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(i[1]||i[2])||!r||this.rules.inline.punctuation.exec(r))){let r=[...i[0]].length-1,s,n,a=r,l=0,o="*"===i[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(o.lastIndex=0,t=t.slice(-1*e.length+r);null!=(i=o.exec(t));){if(!(s=i[1]||i[2]||i[3]||i[4]||i[5]||i[6]))continue;if(n=[...s].length,i[3]||i[4]){a+=n;continue}if((i[5]||i[6])&&r%3&&!((r+n)%3)){l+=n;continue}if((a-=n)>0)continue;n=Math.min(n,n+a+l);let t=[...i[0]][0].length,o=e.slice(0,r+i.index+t+n);if(Math.min(r,n)%2){let e=o.slice(1,-1);return{type:"em",raw:o,text:e,tokens:this.lexer.inlineTokens(e)}}let d=o.slice(2,-2);return{type:"strong",raw:o,text:d,tokens:this.lexer.inlineTokens(d)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(e),i=this.rules.other.startingSpaceChar.test(e)&&this.rules.other.endingSpaceChar.test(e);return r&&i&&(e=e.substring(1,e.length-1)),{type:"codespan",raw:t[0],text:e}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let e,r;return r="@"===t[2]?"mailto:"+(e=t[1]):e=t[1],{type:"link",raw:t[0],text:e,href:r,tokens:[{type:"text",raw:e,text:e}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let e,r;if("@"===t[2])r="mailto:"+(e=t[0]);else{let i;do i=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(i!==t[0])e=t[0],r="www."===t[1]?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:e,href:r,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let e=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:e}}}},eV=class e{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||q,this.options.tokenizer=this.options.tokenizer||new eH,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:V,block:eM.normal,inline:eP.normal};this.options.pedantic?(t.block=eM.pedantic,t.inline=eP.pedantic):this.options.gfm&&(t.block=eM.gfm,this.options.breaks?t.inline=eP.breaks:t.inline=eP.gfm),this.tokenizer.rules=t}static get rules(){return{block:eM,inline:eP}}static lex(t,r){return new e(r).lex(t)}static lexInline(t,r){return new e(r).inlineTokens(t)}lex(e){e=e.replace(V.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){let t=this.inlineQueue[e];this.inlineTokens(t.src,t.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],r=!1){for(this.options.pedantic&&(e=e.replace(V.tabCharGlobal,"    ").replace(V.spaceLine,""));e;){let i;if(this.options.extensions?.block?.some(r=>!!(i=r.call({lexer:this},e,t))&&(e=e.substring(i.raw.length),t.push(i),!0)))continue;if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length);let r=t.at(-1);1===i.raw.length&&void 0!==r?r.raw+=`
`:t.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length);let r=t.at(-1);r?.type==="paragraph"||r?.type==="text"?(r.raw+=`
`+i.raw,r.text+=`
`+i.text,this.inlineQueue.at(-1).src=r.text):t.push(i);continue}if((i=this.tokenizer.fences(e))||(i=this.tokenizer.heading(e))||(i=this.tokenizer.hr(e))||(i=this.tokenizer.blockquote(e))||(i=this.tokenizer.list(e))||(i=this.tokenizer.html(e))){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length);let r=t.at(-1);r?.type==="paragraph"||r?.type==="text"?(r.raw+=`
`+i.raw,r.text+=`
`+i.raw,this.inlineQueue.at(-1).src=r.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title});continue}if((i=this.tokenizer.table(e))||(i=this.tokenizer.lheading(e))){e=e.substring(i.raw.length),t.push(i);continue}let s=e;if(this.options.extensions?.startBlock){let t,r=1/0,i=e.slice(1);this.options.extensions.startBlock.forEach(e=>{"number"==typeof(t=e.call({lexer:this},i))&&t>=0&&(r=Math.min(r,t))}),r<1/0&&r>=0&&(s=e.substring(0,r+1))}if(this.state.top&&(i=this.tokenizer.paragraph(s))){let n=t.at(-1);r&&n?.type==="paragraph"?(n.raw+=`
`+i.raw,n.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=n.text):t.push(i),r=s.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length);let r=t.at(-1);r?.type==="text"?(r.raw+=`
`+i.raw,r.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=r.text):t.push(i);continue}if(e){let t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw Error(t)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let r=e,i=null;if(this.tokens.links){let e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(i=this.tokenizer.rules.inline.reflinkSearch.exec(r));)e.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(i=this.tokenizer.rules.inline.anyPunctuation.exec(r));)r=r.slice(0,i.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;null!=(i=this.tokenizer.rules.inline.blockSkip.exec(r));)r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let s=!1,n="";for(;e;){let i;if(s||(n=""),s=!1,this.options.extensions?.inline?.some(r=>!!(i=r.call({lexer:this},e,t))&&(e=e.substring(i.raw.length),t.push(i),!0)))continue;if((i=this.tokenizer.escape(e))||(i=this.tokenizer.tag(e))||(i=this.tokenizer.link(e))){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(i.raw.length);let r=t.at(-1);"text"===i.type&&r?.type==="text"?(r.raw+=i.raw,r.text+=i.text):t.push(i);continue}if((i=this.tokenizer.emStrong(e,r,n))||(i=this.tokenizer.codespan(e))||(i=this.tokenizer.br(e))||(i=this.tokenizer.del(e))||(i=this.tokenizer.autolink(e))||!this.state.inLink&&(i=this.tokenizer.url(e))){e=e.substring(i.raw.length),t.push(i);continue}let a=e;if(this.options.extensions?.startInline){let t,r=1/0,i=e.slice(1);this.options.extensions.startInline.forEach(e=>{"number"==typeof(t=e.call({lexer:this},i))&&t>=0&&(r=Math.min(r,t))}),r<1/0&&r>=0&&(a=e.substring(0,r+1))}if(i=this.tokenizer.inlineText(a)){e=e.substring(i.raw.length),"_"!==i.raw.slice(-1)&&(n=i.raw.slice(-1)),s=!0;let r=t.at(-1);r?.type==="text"?(r.raw+=i.raw,r.text+=i.text):t.push(i);continue}if(e){let t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw Error(t)}}return t}},ej=class{options;parser;constructor(e){this.options=e||q}space(e){return""}code({text:e,lang:t,escaped:r}){let i=(t||"").match(V.notSpaceStart)?.[0],s=e.replace(V.endingNewline,"")+`
`;return i?'<pre><code class="language-'+eL(i)+'">'+(r?s:eL(s,!0))+`</code></pre>
`:"<pre><code>"+(r?s:eL(s,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){let t=e.ordered,r=e.start,i="";for(let t=0;t<e.items.length;t++){let r=e.items[t];i+=this.listitem(r)}let s=t?"ol":"ul";return"<"+s+(t&&1!==r?' start="'+r+'"':"")+`>
`+i+"</"+s+`>
`}listitem(e){let t="";if(e.task){let r=this.checkbox({checked:!!e.checked});e.loose?e.tokens[0]?.type==="paragraph"?(e.tokens[0].text=r+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&"text"===e.tokens[0].tokens[0].type&&(e.tokens[0].tokens[0].text=r+" "+eL(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",r="";for(let t=0;t<e.header.length;t++)r+=this.tablecell(e.header[t]);t+=this.tablerow({text:r});let i="";for(let t=0;t<e.rows.length;t++){let s=e.rows[t];r="";for(let e=0;e<s.length;e++)r+=this.tablecell(s[e]);i+=this.tablerow({text:r})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+i+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let t=this.parser.parseInline(e.tokens),r=e.header?"th":"td";return(e.align?`<${r} align="${e.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${eL(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:r}){let i=this.parser.parseInline(r),s=eI(e);if(null===s)return i;let n='<a href="'+(e=s)+'"';return t&&(n+=' title="'+eL(t)+'"'),n+=">"+i+"</a>"}image({href:e,title:t,text:r,tokens:i}){i&&(r=this.parser.parseInline(i,this.parser.textRenderer));let s=eI(e);if(null===s)return eL(r);e=s;let n=`<img src="${e}" alt="${r}"`;return t&&(n+=` title="${eL(t)}"`),n+=">"}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:eL(e.text)}},eN=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},eU=class e{options;renderer;textRenderer;constructor(e){this.options=e||q,this.options.renderer=this.options.renderer||new ej,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new eN}static parse(t,r){return new e(r).parse(t)}static parseInline(t,r){return new e(r).parseInline(t)}parse(e,t=!0){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let e=this.options.extensions.renderers[s.type].call({parser:this},s);if(!1!==e||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(s.type)){r+=e||"";continue}}switch(s.type){case"space":r+=this.renderer.space(s);continue;case"hr":r+=this.renderer.hr(s);continue;case"heading":r+=this.renderer.heading(s);continue;case"code":r+=this.renderer.code(s);continue;case"table":r+=this.renderer.table(s);continue;case"blockquote":r+=this.renderer.blockquote(s);continue;case"list":r+=this.renderer.list(s);continue;case"html":r+=this.renderer.html(s);continue;case"paragraph":r+=this.renderer.paragraph(s);continue;case"text":{let n=s,a=this.renderer.text(n);for(;i+1<e.length&&"text"===e[i+1].type;)n=e[++i],a+=`
`+this.renderer.text(n);t?r+=this.renderer.paragraph({type:"paragraph",raw:a,text:a,tokens:[{type:"text",raw:a,text:a,escaped:!0}]}):r+=a;continue}default:{let e='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw Error(e)}}}return r}parseInline(e,t=this.renderer){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let e=this.options.extensions.renderers[s.type].call({parser:this},s);if(!1!==e||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){r+=e||"";continue}}switch(s.type){case"escape":case"text":r+=t.text(s);break;case"html":r+=t.html(s);break;case"link":r+=t.link(s);break;case"image":r+=t.image(s);break;case"strong":r+=t.strong(s);break;case"em":r+=t.em(s);break;case"codespan":r+=t.codespan(s);break;case"br":r+=t.br(s);break;case"del":r+=t.del(s);break;default:{let e='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw Error(e)}}}return r}},eW=class{options;block;constructor(e){this.options=e||q}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?eV.lex:eV.lexInline}provideParser(){return this.block?eU.parse:eU.parseInline}},eG=new class{defaults=O();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=eU;Renderer=ej;TextRenderer=eN;Lexer=eV;Tokenizer=eH;Hooks=eW;constructor(...e){this.use(...e)}walkTokens(e,t){let r=[];for(let i of e)switch(r=r.concat(t.call(this,i)),i.type){case"table":for(let e of i.header)r=r.concat(this.walkTokens(e.tokens,t));for(let e of i.rows)for(let i of e)r=r.concat(this.walkTokens(i.tokens,t));break;case"list":r=r.concat(this.walkTokens(i.items,t));break;default:{let e=i;this.defaults.extensions?.childTokens?.[e.type]?this.defaults.extensions.childTokens[e.type].forEach(i=>{let s=e[i].flat(1/0);r=r.concat(this.walkTokens(s,t))}):e.tokens&&(r=r.concat(this.walkTokens(e.tokens,t)))}}return r}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(e=>{let r={...e};if(r.async=this.defaults.async||r.async||!1,e.extensions&&(e.extensions.forEach(e=>{if(!e.name)throw Error("extension name required");if("renderer"in e){let r=t.renderers[e.name];r?t.renderers[e.name]=function(...t){let i=e.renderer.apply(this,t);return!1===i&&(i=r.apply(this,t)),i}:t.renderers[e.name]=e.renderer}if("tokenizer"in e){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw Error("extension level must be 'block' or 'inline'");let r=t[e.level];r?r.unshift(e.tokenizer):t[e.level]=[e.tokenizer],e.start&&("block"===e.level?t.startBlock?t.startBlock.push(e.start):t.startBlock=[e.start]:"inline"===e.level&&(t.startInline?t.startInline.push(e.start):t.startInline=[e.start]))}"childTokens"in e&&e.childTokens&&(t.childTokens[e.name]=e.childTokens)}),r.extensions=t),e.renderer){let t=this.defaults.renderer||new ej(this.defaults);for(let r in e.renderer){if(!(r in t))throw Error(`renderer '${r}' does not exist`);if(["options","parser"].includes(r))continue;let i=e.renderer[r],s=t[r];t[r]=(...e)=>{let r=i.apply(t,e);return!1===r&&(r=s.apply(t,e)),r||""}}r.renderer=t}if(e.tokenizer){let t=this.defaults.tokenizer||new eH(this.defaults);for(let r in e.tokenizer){if(!(r in t))throw Error(`tokenizer '${r}' does not exist`);if(["options","rules","lexer"].includes(r))continue;let i=e.tokenizer[r],s=t[r];t[r]=(...e)=>{let r=i.apply(t,e);return!1===r&&(r=s.apply(t,e)),r}}r.tokenizer=t}if(e.hooks){let t=this.defaults.hooks||new eW;for(let r in e.hooks){if(!(r in t))throw Error(`hook '${r}' does not exist`);if(["options","block"].includes(r))continue;let i=e.hooks[r],s=t[r];eW.passThroughHooks.has(r)?t[r]=e=>{if(this.defaults.async)return Promise.resolve(i.call(t,e)).then(e=>s.call(t,e));let r=i.call(t,e);return s.call(t,r)}:t[r]=(...e)=>{let r=i.apply(t,e);return!1===r&&(r=s.apply(t,e)),r}}r.hooks=t}if(e.walkTokens){let t=this.defaults.walkTokens,i=e.walkTokens;r.walkTokens=function(e){let r=[];return r.push(i.call(this,e)),t&&(r=r.concat(t.call(this,e))),r}}this.defaults={...this.defaults,...r}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return eV.lex(e,t??this.defaults)}parser(e,t){return eU.parse(e,t??this.defaults)}parseMarkdown(e){return(t,r)=>{let i={...r},s={...this.defaults,...i},n=this.onError(!!s.silent,!!s.async);if(!0===this.defaults.async&&!1===i.async)return n(Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||null===t)return n(Error("marked(): input parameter is undefined or null"));if("string"!=typeof t)return n(Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));s.hooks&&(s.hooks.options=s,s.hooks.block=e);let a=s.hooks?s.hooks.provideLexer():e?eV.lex:eV.lexInline,l=s.hooks?s.hooks.provideParser():e?eU.parse:eU.parseInline;if(s.async)return Promise.resolve(s.hooks?s.hooks.preprocess(t):t).then(e=>a(e,s)).then(e=>s.hooks?s.hooks.processAllTokens(e):e).then(e=>s.walkTokens?Promise.all(this.walkTokens(e,s.walkTokens)).then(()=>e):e).then(e=>l(e,s)).then(e=>s.hooks?s.hooks.postprocess(e):e).catch(n);try{s.hooks&&(t=s.hooks.preprocess(t));let e=a(t,s);s.hooks&&(e=s.hooks.processAllTokens(e)),s.walkTokens&&this.walkTokens(e,s.walkTokens);let r=l(e,s);return s.hooks&&(r=s.hooks.postprocess(r)),r}catch(e){return n(e)}}}onError(e,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let e="<p>An error occurred:</p><pre>"+eL(r.message+"",!0)+"</pre>";return t?Promise.resolve(e):e}if(t)return Promise.reject(r);throw r}}};function eZ(e,t){return eG.parse(e,t)}eZ.options=eZ.setOptions=function(e){return eG.setOptions(e),eZ.defaults=eG.defaults,q=eZ.defaults,eZ},eZ.getDefaults=O,eZ.defaults=q,eZ.use=function(...e){return eG.use(...e),eZ.defaults=eG.defaults,q=eZ.defaults,eZ},eZ.walkTokens=function(e,t){return eG.walkTokens(e,t)},eZ.parseInline=eG.parseInline,eZ.Parser=eU,eZ.parser=eU.parse,eZ.Renderer=ej,eZ.TextRenderer=eN,eZ.Lexer=eV,eZ.lexer=eV.lex,eZ.Tokenizer=eH,eZ.Hooks=eW,eZ.parse=eZ,eZ.options,eZ.setOptions,eZ.use,eZ.walkTokens,eZ.parseInline,eU.parse,eV.lex;class eQ{constructor(){this.formCounter=0,this.fieldCounter=0,this.usedIds=new Set}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}generateSmartLabel(e){if(/^\d/.test(e))throw Error(`Invalid field name '${e}': Field names cannot start with a number`);return e.includes("_")?e.split("_").map(e=>this.capitalizeWord(e)).join(" "):/[a-z][A-Z]/.test(e)?e.replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(e=>this.capitalizeWord(e)).join(" "):this.capitalizeWord(e)}capitalizeWord(e){return e&&e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}determineFormId(e,t){return e.attributes?.form?e.attributes.form:t||(t?void 0:this.generateDefaultFormId())}generateDefaultFormId(){return 0===this.formCounter?"formdown-form-default":`formdown-form-${this.formCounter++}`}ensureDefaultForm(e,t){return 0===t.length?e:0===e.length?[{id:this.generateDefaultFormId(),attributes:{}}]:e}createFormContext(e,t){let r=new Map;if(0===t.length)return r;let i=[...t].sort((e,t)=>(e.position||0)-(t.position||0)),s=i[0].id;return e.forEach(e=>{if(e.attributes?.form){let i=e.attributes.form;t.some(e=>e.id===i)?r.set(e,i):(console.warn(`Form '${i}' referenced by field '${e.name}' does not exist. Using default form.`),r.set(e,s))}else{let t=this.findNearestForm(e,i);r.set(e,t?.id||s)}}),r}findNearestForm(e,t){let r;if(!e.position)return t[0];for(let i of t)if(!i.position||i.position<=e.position)r=i;else break;return r||t[0]}generateHTML(e){this.usedIds.clear(),this.fieldCounter=0;let t=e.markdown?eZ(e.markdown):"";return"string"==typeof t?this.processContentWithHiddenForms(t,e.forms,e.formDeclarations||[],e.datalistDeclarations||[],e.groupDeclarations||[]):this.generateLegacyHTML(e)}processContentWithHiddenForms(e,t,r,i,s=[]){if(0===t.length&&0===r.length&&0===i.length&&0===s.length)return e;let n=this.ensureDefaultForm(r,t),a=this.generateHiddenFormsHTML(n),l=this.generateDatalistHTML(i),o=this.createFormContext(t,n),d=new Map;s.forEach(e=>d.set(e.id,e));let h=[],c=[];t.forEach(e=>{e.inline?h.push(e):c.push(e)});let u=e;return s.forEach(e=>{let t=`<!--FORMDOWN_GROUP_START_${e.id}-->`,r=this.generateGroupStartHTML(e);u=u.replace(RegExp(this.escapeRegex(t),"g"),r)}),s.forEach(e=>{let t=`<!--FORMDOWN_GROUP_END_${e.id}-->`;u=u.replace(RegExp(this.escapeRegex(t),"g"),"</fieldset>")}),h.forEach((e,r)=>{let i=`<!--FORMDOWN_FIELD_${t.indexOf(e)}-->`,s=o.get(e),n=this.generateInlineFieldHTML(e,s);u=u.replace(RegExp(this.escapeRegex(i),"g"),n)}),c.forEach(e=>{let r=`<!--FORMDOWN_FIELD_${t.indexOf(e)}-->`,i=o.get(e),s=this.generateStandaloneFieldHTML(e,i);u=u.replace(RegExp(this.escapeRegex(r),"g"),s)}),a+l+u}generateGroupStartHTML(e){let t=this.escapeHtml(e.label),r=['class="formdown-group"',`data-group="${this.escapeHtml(e.id)}"`];return e.collapsible&&r.push('data-collapsible="true"'),e.collapsed&&r.push('data-collapsed="true"'),`<fieldset ${r.join(" ")}>
<legend>${t}</legend>`}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}processContent(e,t){if(0===t.length)return e;let r=[],i=[];t.forEach(e=>{e.inline?r.push(e):i.push(e)});let s=e;return r.forEach((e,r)=>{let i=`<!--FORMDOWN_FIELD_${t.indexOf(e)}-->`,n=this.generateInlineFieldHTML(e);s=s.replace(RegExp(i,"g"),n)}),i.forEach(e=>{let r=`<!--FORMDOWN_FIELD_${t.indexOf(e)}-->`,i=this.generateStandaloneFieldHTML(e);s=s.replace(RegExp(r,"g"),i)}),s}processFieldPlaceholders(e,t){let r=e;return t.forEach((e,t)=>{let i=`<!--FORMDOWN_FIELD_${t}-->`,s=this.generateStandaloneFieldHTML(e);r=r.replace(RegExp(i,"g"),s)}),r}generateLegacyHTML(e){let t=e.markdown?eZ(e.markdown):"";if(0===e.forms.length)return t;let r=`formdown-legacy-${Math.random().toString(36).substr(2,9)}`,i=e.forms.map(e=>this.generateFieldHTML(e,r)).join(`
`);return`<form hidden id="${r}"></form>`+t+i}generateStandaloneFieldHTML(e,t){if(e.inline)return this.generateInlineFieldHTML(e,t);let r=this.generateFieldHTML(e,t);if(r.includes('<div class="formdown-field"')||r.includes('<div class="formdown-field formdown-conditional"')||["submit","reset","button"].includes(e.type))return`
<div class="formdown-field-container">
${r}
</div>`;let i=this.generateUniqueId(e.name,t),s=e.label||this.generateSmartLabel(e.name),n=this.determineFormId(e,t),a=e.required?" *":"";return`
<div class="formdown-field-container">
<div class="formdown-field">
    <label for="${i}">${s}${a}</label>
    ${r.replace(/id="[^"]*"/,`id="${i}"`).replace(/form="[^"]*"/,n?`form="${n}"`:"")}
</div>
</div>`}generateInlineFieldHTML(e,t){let{name:r,type:i,required:s,placeholder:n,attributes:a}=e,l=e.label||this.generateSmartLabel(r),o=this.determineFormId(e,t),d={"data-field-name":r,"data-field-type":i,"data-placeholder":n||l,class:"formdown-inline-field",contenteditable:"true",role:"textbox",...s&&{"data-required":"true"},...o&&{"data-form":o},...a&&a};return`<span ${Object.entries(d).map(([e,t])=>"boolean"==typeof t?t?e:"":`${e}="${t}"`).filter(Boolean).join(" ")}>${l}</span>`}generateFieldHTML(e,t){let{name:r,type:i,label:s,required:n,placeholder:a,attributes:l,options:o,description:d,errorMessage:h,pattern:c,format:u,allowOther:p,content:m,value:g}=e,f=z.getFieldTypeRegistry().generateFieldHTML(e,{field:e,metadata:{formId:t}});if(f)return f;let b=s||this.generateSmartLabel(r),v="checkbox"===i?m||s||this.generateSmartLabel(r):b,y=this.generateUniqueId(r,t),w=d?`${y}-description`:void 0,k=h?`${y}-error`:void 0,$=this.determineFormId(e,t),x={name:"name",first_name:"given-name",last_name:"family-name",email:"email",phone:"tel",phone_number:"tel",password:"current-password",new_password:"new-password",confirm_password:"new-password",username:"username",company:"organization",address:"street-address",city:"address-level2",state:"address-level1",zip:"postal-code",country:"country",birth_date:"bday",birthday:"bday"}[r.toLowerCase()]||("email"===i?"email":"tel"===i?"tel":"password"===i?"current-password":void 0),E=new Set(["width","span"]),S=l?Object.fromEntries(Object.entries(l).filter(([e])=>!E.has(e)&&!e.startsWith("--"))):{},F={id:y,name:r,...n&&{required:!0},...a&&{placeholder:a},...c&&{pattern:c},...u&&{format:u},...null!=g&&!["textarea","select","radio","checkbox","range","file"].includes(i)&&{value:g},...d&&{"aria-describedby":w},...h&&{"aria-describedby":`${w?w+" ":""}${k}`},...$&&{form:$},...x&&!l?.autocomplete&&{autocomplete:x},...S},T=Object.entries(F).map(([e,t])=>"boolean"==typeof t?t?e:"":`${e}="${t}"`).filter(Boolean).join(" "),R=()=>{let e="";return d&&(e+=`
    <div id="${w}" class="formdown-field-description">${d}</div>`),h&&(e+=`
    <div id="${k}" class="formdown-field-error" role="alert">${h}</div>`),e},C=(()=>{let t=["formdown-field"],r=[];if(e.conditions){if(t.push("formdown-conditional"),e.conditions.visibleIf){let t=e.conditions.visibleIf;r.push(`data-visible-if-field="${this.escapeHtml(t.field)}"`),r.push(`data-visible-if-operator="${t.operator}"`),void 0!==t.value&&r.push(`data-visible-if-value="${this.escapeHtml(t.value)}"`)}if(e.conditions.hiddenIf){let t=e.conditions.hiddenIf;r.push(`data-hidden-if-field="${this.escapeHtml(t.field)}"`),r.push(`data-hidden-if-operator="${t.operator}"`),void 0!==t.value&&r.push(`data-hidden-if-value="${this.escapeHtml(t.value)}"`)}if(e.conditions.enabledIf){let t=e.conditions.enabledIf;r.push(`data-enabled-if-field="${this.escapeHtml(t.field)}"`),r.push(`data-enabled-if-operator="${t.operator}"`),void 0!==t.value&&r.push(`data-enabled-if-value="${this.escapeHtml(t.value)}"`)}if(e.conditions.disabledIf){let t=e.conditions.disabledIf;r.push(`data-disabled-if-field="${this.escapeHtml(t.field)}"`),r.push(`data-disabled-if-operator="${t.operator}"`),void 0!==t.value&&r.push(`data-disabled-if-value="${this.escapeHtml(t.value)}"`)}if(e.conditions.requiredIf){let t=e.conditions.requiredIf;r.push(`data-required-if-field="${this.escapeHtml(t.field)}"`),r.push(`data-required-if-operator="${t.operator}"`),void 0!==t.value&&r.push(`data-required-if-value="${this.escapeHtml(t.value)}"`)}}e.group&&r.push(`data-group="${this.escapeHtml(e.group)}"`);let i=[];e.attributes&&(void 0!==e.attributes.width&&i.push(`width: ${this.escapeHtml(String(e.attributes.width))}`),void 0!==e.attributes.span&&i.push(`grid-column: span ${this.escapeHtml(String(e.attributes.span))}`),Object.entries(e.attributes).forEach(([e,t])=>{e.startsWith("--")&&i.push(`${e}: ${this.escapeHtml(String(t))}`)}));let s=`class="${t.join(" ")}"`,n=i.length>0?` style="${i.join("; ")}"`:"",a=r.length>0?` ${r.join(" ")}`:"";return`${s}${n}${a}`})();switch(i){case"textarea":let _=g?this.escapeHtml(String(g)):"";return`
<div ${C} part="field">
    <label for="${y}" part="label">${b}${n?" *":""}</label>
    <textarea ${T} part="input textarea-input">${_}</textarea>${R()}
</div>`;case"select":let A=o?.map(e=>{let t=g&&String(g)===e?" selected":"",r=this.escapeHtml(e);return`<option value="${r}"${t}>${r}</option>`}).join(`
`)||"",M=p?`
        <option value="">${this.escapeHtml(e.otherLabel||"Other")} (please specify)</option>`:"",P=p?`
    <input type="text" id="${y}_other" placeholder="Please specify..." class="formdown-other-input" data-formdown-other-for="${y}">`:"";return`
<div ${C} part="field">
    <label for="${y}" part="label">${b}${n?" *":""}</label>
    <select ${T} part="input select-input"${p?` data-formdown-has-other="true" data-formdown-other-target="${y}_other"`:""}>
        ${A}${M}
    </select>${P}${R()}
</div>`;case"radio":if(!o||0===o.length)return`
<div ${C}>
    <label for="${y}">${b}${n?" *":""}</label>
    <input type="text" ${T}>${R()}
</div>`;let D=o.map((e,i)=>{let s=this.generateUniqueId(`${r}_${i}`,t),a=g&&String(g)===e,l=w?` aria-describedby="${w}"`:"",o=this.escapeHtml(e);return`
        <label for="${s}" class="formdown-option-label">
            <input type="radio" id="${s}" name="${r}" value="${o}"${n&&0===i?" required":""}${a?" checked":""}${l}${p?' data-formdown-hides-other="true"':""}>
            <span>${o}</span>
        </label>`}).join(`
`),L=this.generateUniqueId(`${r}_other_radio`,t),I=p?`
        <label for="${L}" class="formdown-option-label">
            <input type="radio" id="${L}" name="${r}" value="" ${w?`aria-describedby="${w}"`:""} data-formdown-other-radio="true">
            <span>${this.escapeHtml(e.otherLabel||"Other")}:</span>
            <input type="text" placeholder="Please specify..." class="formdown-other-input" data-formdown-other-for="${r}">
        </label>`:"",O=l?.layout==="vertical"?"radio-group vertical":"radio-group inline";return`
<div ${C} part="field">
    <fieldset ${w?`aria-describedby="${w}"`:""} part="fieldset">
        <legend part="legend">${b}${n?" *":""}</legend>
        <div class="${O}" role="radiogroup" part="radio-group">
${D}${I}
        </div>
    </fieldset>${R()}
</div>`;case"checkbox":if(o&&0!==o.length){let i=g?String(g).split(",").map(e=>e.trim()):[],s=o.map((e,s)=>{let a=this.generateUniqueId(`${r}_${s}`,t),l=i.includes(e),o=w?` aria-describedby="${w}"`:"",d=this.escapeHtml(e);return`
        <label for="${a}" class="formdown-option-label">
            <input type="checkbox" id="${a}" name="${r}" value="${d}"${n&&0===s?" required":""}${l?" checked":""}${o}>
            <span>${d}</span>
        </label>`}).join(`
`),a=this.generateUniqueId(`${r}_other_checkbox`,t),d=p?`
        <label for="${a}" class="formdown-option-label">
            <input type="checkbox" id="${a}" name="${r}" value="" ${w?`aria-describedby="${w}"`:""} data-formdown-other-checkbox="true">
            <span>${this.escapeHtml(e.otherLabel||"Other")}:</span>
            <input type="text" placeholder="Please specify..." class="formdown-other-input" data-formdown-other-for="${r}">
        </label>`:"",h=l?.layout==="vertical"?"checkbox-group vertical":"checkbox-group inline";return`
<div ${C} part="field">
    <fieldset ${w?`aria-describedby="${w}"`:""} part="fieldset">
        <legend part="legend">${b}${n?" *":""}</legend>
        <div class="${h}" role="group" part="checkbox-group">
${s}${d}
        </div>
    </fieldset>${R()}
</div>`}{let e=g&&(!0===g||"true"===g||"true"===String(g).toLowerCase()),t={...F};delete t.id,delete t.name,delete t.form;let i=Object.entries(t).map(([e,t])=>"boolean"==typeof t?t?e:"":`${e}="${t}"`).filter(Boolean).join(" "),s=$?` form="${$}"`:"";return`
<div ${C} part="field">
    <label for="${y}" class="formdown-checkbox-label" part="label checkbox-label">
        <input type="checkbox" id="${y}" name="${r}" value="true"${n?" required":""}${e?" checked":""}${s} ${i} part="input checkbox-input">
        <span>${this.escapeHtml(v)}${n?" *":""}</span>
    </label>${R()}
</div>`}case"range":let q=Number(l?.min)||0,B=Number(l?.max)||100;l?.step;let H=void 0!==g?g:l?.value!==void 0?Number(l.value):Math.floor((q+B)/2);return`
<div ${C} part="field">
    <label for="${y}" part="label">${b}${n?" *":""}</label>
    <input type="range" ${T} value="${H}" part="input range-input">
    <output for="${y}" class="formdown-range-output" part="range-output">${H}</output>${R()}
</div>`;case"file":return`
<div ${C} part="field">
    <label for="${y}" part="label">${b}${n?" *":""}</label>
    <input type="file" ${T} part="input file-input">${R()}
</div>`;case"color":return`
<div ${C} part="field">
    <label for="${y}" part="label">${b}${n?" *":""}</label>
    <input type="color" ${T} part="input color-input">${R()}
</div>`;case"week":return`
<div ${C} part="field">
    <label for="${y}" part="label">${b}${n?" *":""}</label>
    <input type="week" ${T} part="input week-input">${R()}
</div>`;case"month":return`
<div ${C} part="field">
    <label for="${y}" part="label">${b}${n?" *":""}</label>
    <input type="month" ${T} part="input month-input">${R()}
</div>`;case"submit":let V=$?` form="${$}"`:"",j=Object.entries(l||{}).filter(([e])=>!["form"].includes(e)).map(([e,t])=>"boolean"==typeof t?t?e:"":`${e}="${t}"`).filter(Boolean).join(" "),N=j?` ${j}`:"";return`<button type="submit" id="${y}"${V}${N} part="button submit-button">${e.label||"Submit"}</button>`;case"reset":let U=$?` form="${$}"`:"",W=Object.entries(l||{}).filter(([e])=>!["form"].includes(e)).map(([e,t])=>"boolean"==typeof t?t?e:"":`${e}="${t}"`).filter(Boolean).join(" "),G=W?` ${W}`:"";return`<button type="reset" id="${y}"${U}${G} part="button reset-button">${e.label||"Reset"}</button>`;case"button":let Z=l?.type||"button",Q=$?` form="${$}"`:"",K=Object.entries(l||{}).filter(([e])=>!["form","type"].includes(e)).map(([e,t])=>"boolean"==typeof t?t?e:"":`${e}="${t}"`).filter(Boolean).join(" "),J=K?` ${K}`:"";return`<button type="${Z}" id="${y}"${Q}${J} part="button">${e.label||"Button"}</button>`;case"image":let X=l?.src||"",Y=l?.alt||e.label||"Submit",ee=$?` form="${$}"`:"",et=Object.entries(l||{}).filter(([e])=>!["form","src","alt","type"].includes(e)).map(([e,t])=>"boolean"==typeof t?t?e:"":`${e}="${t}"`).filter(Boolean).join(" "),er=et?` ${et}`:"";return`<input type="image" id="${y}" src="${X}" alt="${Y}"${ee}${er}>`;default:return`
<div ${C} part="field">
    <label for="${y}" part="label">${b}${n?" *":""}</label>
    <input type="${i}" ${T} part="input text-input">${R()}
</div>`}}generateHiddenFormsHTML(e){return 0===e.length?"":e.map(e=>this.generateHiddenFormHTML(e)).join("")}generateHiddenFormHTML(e){let t=[],r=[],i=[];Object.entries(e.attributes).forEach(([e,s])=>{if("boolean"==typeof s){s&&i.push(e);return}"layout"===e?t.push(`data-layout="${this.escapeHtml(String(s))}"`):"label-width"===e?r.push(`--formdown-label-width: ${this.escapeHtml(String(s))}`):"columns"===e?r.push(`--formdown-columns: ${this.escapeHtml(String(s))}`):"gap"===e?r.push(`--formdown-gap: ${this.escapeHtml(String(s))}`):e.startsWith("--")?r.push(`${e}: ${this.escapeHtml(String(s))}`):i.push(`${e}="${this.escapeHtml(String(s))}"`)});let s=[...t,...i];r.length>0&&s.push(`style="${r.join("; ")}"`);let n=s.filter(Boolean).join(" ");return`<form hidden id="${e.id}" ${n}></form>
`}generateDatalistHTML(e){return 0===e.length?"":e.map(e=>this.generateSingleDatalistHTML(e)).join("")}generateSingleDatalistHTML(e){let t=e.options.map(e=>`<option value="${this.escapeHtml(e)}">${this.escapeHtml(e)}</option>`).join("");return`<datalist id="${e.id}">${t}</datalist>
`}generateUniqueId(e,t){let r=e;for(this.usedIds.has(r)&&t&&(r=`${t.replace(/^formdown-form-/,"").replace(/-/g,"_")}_${e}`),this.usedIds.has(r)&&(r=`${e}_${++this.fieldCounter}`);this.usedIds.has(r);)r=`${e}_${++this.fieldCounter}`;return this.usedIds.add(r),r}}class eK{constructor(){this.parser=new I}extractSchema(e){let t=this.parser.parse(e),r={};return t.fields.forEach((e,t)=>{r[e.name]=this.convertFieldToSchema(e,t)}),r}convertFieldToSchema(e,t){let r={type:e.type,label:e.label,required:e.required,position:t+1,isInline:e.inline};e.placeholder&&(r.placeholder=e.placeholder),void 0!==e.value&&(r.value=e.value),e.options&&(r.options=e.options),e.allowOther&&(r.allowOther=e.allowOther),e.format&&(r.format=e.format),e.pattern&&(r.pattern=e.pattern),e.description&&(r.description=e.description),e.errorMessage&&(r.errorMessage=e.errorMessage);let i=this.extractValidationRules(e.attributes||{}),s=this.extractFieldValidationRules(e);(i||s)&&(r.validation={...i,...s});let n=this.extractHtmlAttributes(e.attributes||{});return n&&Object.keys(n).length>0&&(r.htmlAttributes=n),r.layout=e.inline?"inline":"vertical",e.group&&(r.group=e.group),e.conditions&&(r.conditions=e.conditions),r}extractValidationRules(e){let t={},r=!1;return void 0!==e.min&&(t.min=e.min,r=!0),void 0!==e.max&&(t.max=e.max,r=!0),void 0!==e.step&&(t.step=e.step,r=!0),void 0!==e.minlength&&(t.minlength=e.minlength,r=!0),void 0!==e.maxlength&&(t.maxlength=e.maxlength,r=!0),void 0!==e.pattern&&(t.pattern=e.pattern,r=!0),void 0!==e.accept&&(t.accept=e.accept,r=!0),r?t:void 0}extractFieldValidationRules(e){let t={},r=!1;return void 0!==e.pattern&&(t.pattern=e.pattern,r=!0),r?t:void 0}extractHtmlAttributes(e){let t={},r=new Set(["min","max","step","minlength","maxlength","pattern","accept","required","placeholder","options","allow-other","format"]),i=!1;for(let[s,n]of Object.entries(e))r.has(s)||(t[s]=n,i=!0);return i?t:void 0}}class eJ{constructor(e=null,t={}){this.schema=e,this.data={},this.changeListeners=new Set,this.fieldChangeListeners=new Set,this.validationListeners=new Set,this.isUpdating=!1,this.initializeFromSchema(),this.updateInternal(t,!1)}set(e,t){this.isUpdating||this.data[e]===t||(this.data[e]=t,this.notifyFieldChange(e,t),this.notifyChange(),this.validateField(e,t))}get(e){return e in this.data?this.data[e]:this.schema&&this.schema[e]&&void 0!==this.schema[e].value?this.schema[e].value:void 0}getAll(){return{...this.getSchemaDefaults(),...this.data}}updateAll(e){this.updateInternal(e,!0)}reset(){let e=this.getSchemaDefaults();this.data={},this.updateInternal(e,!0)}isDirty(){let e=this.getAll(),t=this.getSchemaDefaults();return JSON.stringify(e)!==JSON.stringify(t)}validateField(e,t){if(!this.schema||!this.schema[e])return[];let r=e8(void 0!==t?t:this.get(e),{...this.schema[e],name:e});return this.notifyValidation(e,r),r}validate(){var e,t;let r;if(!this.schema)return{isValid:!0,errors:[]};let i=(e=this.getAll(),t=this.schema,r=[],Object.entries(t).forEach(([t,i])=>{let s=e8(e[t],{...i,name:t});r.push(...s)}),{isValid:0===r.length,errors:r}),s=new Map;return i.errors.forEach(e=>{s.has(e.field)||s.set(e.field,[]),s.get(e.field).push(e)}),s.forEach((e,t)=>{this.notifyValidation(t,e)}),i}subscribe(e){return this.changeListeners.add(e),()=>this.changeListeners.delete(e)}subscribeToField(e){return this.fieldChangeListeners.add(e),()=>this.fieldChangeListeners.delete(e)}subscribeToValidation(e){return this.validationListeners.add(e),()=>this.validationListeners.delete(e)}updateSchema(e){this.schema=e,this.initializeFromSchema(),this.notifyChange()}getSchemaDefaults(){if(!this.schema)return{};let e={};return Object.entries(this.schema).forEach(([t,r])=>{void 0!==r.value&&(e[t]=r.value)}),e}getModifiedFields(){return Object.keys(this.data)}clear(e){if(e in this.data){delete this.data[e];let t=this.get(e);this.notifyFieldChange(e,t),this.notifyChange()}}hasExplicitValue(e){return e in this.data}createSnapshot(){return{...this.data}}restoreSnapshot(e){this.data={...e},this.notifyChange()}updateInternal(e,t){if(!this.isUpdating){this.isUpdating=!0;try{let r=[];Object.entries(e).forEach(([e,t])=>{this.data[e]!==t&&(this.data[e]=t,r.push({field:e,value:t}))}),t&&r.length>0&&(r.forEach(({field:e,value:t})=>{this.notifyFieldChange(e,t),this.validateField(e,t)}),this.notifyChange())}finally{this.isUpdating=!1}}}initializeFromSchema(){this.schema&&Object.entries(this.schema).forEach(([e,t])=>{void 0===t.value||e in this.data||(this.data[e]=t.value)})}notifyChange(){if(this.isUpdating)return;let e=this.getAll();this.changeListeners.forEach(t=>{try{t(e)}catch(e){console.error("Error in FormDataBinding change listener:",e)}})}notifyFieldChange(e,t){if(this.isUpdating)return;let r=this.getAll();this.fieldChangeListeners.forEach(i=>{try{i(e,t,r)}catch(e){console.error("Error in FormDataBinding field change listener:",e)}})}notifyValidation(e,t){this.validationListeners.forEach(r=>{try{r(e,t)}catch(e){console.error("Error in FormDataBinding validation listener:",e)}})}}class eX{processCheckboxGroup(e,t){try{let r=t.querySelectorAll(`input[type="checkbox"][name="${e}"]`);if(0===r.length)return{success:!1,value:null,errors:["No checkboxes found"]};if(1===r.length&&"true"===r[0].value)return{success:!0,value:r[0].checked||!1};{let e=[];return r.forEach(r=>{if(r.checked)if(""===r.value&&r.id.includes("_other_checkbox")){let i=t.querySelector(`#${r.id.replace("_checkbox","_input")}`);i&&i.value.trim()&&e.push(i.value.trim())}else""!==r.value&&e.push(r.value)}),{success:!0,value:e}}}catch(e){return{success:!1,value:null,errors:[`Checkbox processing error: ${e}`]}}}processRadioGroup(e,t){try{let r=t.querySelectorAll(`input[type="radio"][name="${e}"]`);if(0===r.length)return{success:!1,value:"",errors:["No radio buttons found"]};let i="";return r.forEach(e=>{if(e.checked)if(""===e.value&&e.id.includes("_other_radio")){let r=t.querySelector(`#${e.id.replace("_radio","_input")}`);r&&r.value.trim()&&(i=r.value.trim())}else i=e.value}),{success:!0,value:i}}catch(e){return{success:!1,value:"",errors:[`Radio processing error: ${e}`]}}}processOtherOption(e,t){let r=!t.includes(e)&&""!==e.trim();return{hasOtherValue:r,otherValue:r?e:void 0,regularValues:t}}extractFieldValue(e,t){if(e.hasAttribute("contenteditable"))return e.textContent?.trim()||"";switch(t){case"checkbox":return e.checked||!1;case"radio":return e.checked?e.value:"";case"number":case"range":let r=parseFloat(e.value);return isNaN(r)?0:r;case"date":case"time":case"datetime-local":case"month":case"week":default:return e.value||"";case"file":return e.value&&e.value.split("\\").pop()||""}}computeValueSetting(e,t,r){try{if(e.hasAttribute("contenteditable")){let r=Array.isArray(t)?t.join(", "):String(t??"");return{success:!0,elementId:e.id,settingType:"textContent",value:r}}switch(r){case"checkbox":if(!Array.isArray(t))return"boolean"==typeof t?{success:!0,elementId:e.id,settingType:"checked",value:t}:{success:!0,elementId:e.id,settingType:"checked",value:!!t};{let r=t.includes(e.value);return{success:!0,elementId:e.id,settingType:"checked",value:r}}case"radio":let i=String(t??""),s=e.value===i;return{success:!0,elementId:e.id,settingType:"checked",value:s};case"select":let n=Array.isArray(t)?t.join(", "):String(t??"");return{success:!0,elementId:e.id,settingType:"value",value:n};case"number":case"range":let a="number"==typeof t?t:parseFloat(String(t));return isNaN(a)?{success:!1,elementId:e.id,settingType:"value",value:"",error:"Invalid number value"}:{success:!0,elementId:e.id,settingType:"value",value:String(a)};default:let l=Array.isArray(t)?t.join(", "):String(t??"");return{success:!0,elementId:e.id,settingType:"value",value:l}}}catch(t){return{success:!1,elementId:e.id,settingType:"value",value:"",error:`Value computation error: ${t}`}}}setFieldValue(e,t,r,i){return this.computeValueSetting(e,t,r).success}validateFieldValue(e,t,r){let i=[];switch(r?.required&&(null==e||""===e||Array.isArray(e)&&0===e.length)&&i.push("This field is required"),t){case"email":e&&"string"==typeof e&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||i.push("Please enter a valid email address"));break;case"url":if(e&&"string"==typeof e)try{new URL(e)}catch{i.push("Please enter a valid URL")}break;case"number":case"range":if(""!==e&&null!=e){let t=Number(e);isNaN(t)?i.push("Please enter a valid number"):(r?.min!==void 0&&t<r.min&&i.push(`Value must be at least ${r.min}`),r?.max!==void 0&&t>r.max&&i.push(`Value must be at most ${r.max}`))}break;case"tel":e&&"string"==typeof e&&(/^[\d\s\-\+\(\)]+$/.test(e)||i.push("Please enter a valid phone number"))}return r?.pattern&&e&&"string"==typeof e&&(new RegExp(r.pattern).test(e)||i.push(r.patternMessage||"Value does not match required format")),"string"==typeof e&&(r?.minLength&&e.length<r.minLength&&i.push(`Must be at least ${r.minLength} characters`),r?.maxLength&&e.length>r.maxLength&&i.push(`Must be at most ${r.maxLength} characters`)),{success:0===i.length,value:e,errors:i.length>0?i:void 0}}getFieldType(e){switch(e.type?.toLowerCase()){case"email":return"email";case"password":return"password";case"tel":return"tel";case"url":return"url";case"number":return"number";case"date":return"date";case"time":return"time";case"datetime-local":return"datetime-local";case"month":return"month";case"week":return"week";case"radio":return"radio";case"checkbox":return"checkbox";case"file":return"file";case"color":return"color";case"range":return"range";case"search":return"search";case"hidden":return"hidden";case"button":return"button";case"submit":return"submit";case"reset":return"reset";case"textarea":return"textarea";case"select":return"select";default:return"text"}}}class eY{constructor(){this.fieldRegistry={},this.syncLock=!1,this.fieldProcessor=new eX}bindFieldToElement(e,t){return this.fieldRegistry[e]||(this.fieldRegistry[e]=new Set),this.fieldRegistry[e].add(t),{fieldName:e,elements:this.fieldRegistry[e],unbind:()=>this.unbindElement(e,t)}}extractFieldValue(e,t,r){let i=this.fieldProcessor.getFieldType(e);if("checkbox"===e.type){let e=this.fieldProcessor.processCheckboxGroup(t,r);return e.success?e.value:null}if("radio"===e.type){let e=this.fieldProcessor.processRadioGroup(t,r);return e.success?e.value:""}return this.fieldProcessor.extractFieldValue(e,i)}getValueAssignments(e){let t=[];return[...new Set([...Object.keys(this.fieldRegistry),...Object.keys(e)])].forEach(r=>{let i=e[r]??"",s=this.fieldRegistry[r];s&&s.forEach(e=>{t.push({fieldName:r,element:e,value:i,fieldType:this.fieldProcessor.getFieldType(e)})})}),t}acquireSyncLock(){return!this.syncLock&&(this.syncLock=!0,!0)}releaseSyncLock(){this.syncLock=!1}isSyncing(){return this.syncLock}createFieldChangeEvent(e,t,r){return{type:"field-change",detail:{fieldName:e,value:t,sourceElement:r}}}getFieldProcessor(){return this.fieldProcessor}unbindElement(e,t){this.fieldRegistry[e]&&(this.fieldRegistry[e].delete(t),0===this.fieldRegistry[e].size&&delete this.fieldRegistry[e])}getRegisteredFields(){return Object.keys(this.fieldRegistry)}getFieldElements(e){return this.fieldRegistry[e]}clearAllBindings(){this.fieldRegistry={},this.syncLock=!1}validateAllFields(e,t){let r={};return Object.keys(this.fieldRegistry).forEach(i=>{let s=e[i],n=t?.[i];if(n){let e=this.fieldProcessor.getFieldType(n),t=this.fieldProcessor.validateFieldValue(s,e,n);r[i]=t}}),r}}class e0{constructor(){this.customValidators=new Map,this.validationCache=new Map,this.asyncValidationTimers=new Map}registerCustomValidator(e,t){this.customValidators.set(e,t)}createValidationPipeline(e){return{rules:e,executeOrder:"fail-fast",skipOnError:!0}}async validateAsync(e,t,r){let i=this.getCacheKey(e.fieldName,t);if(this.validationCache.has(i))return this.validationCache.get(i);let s=this.buildValidationRules(e),n=this.createValidationPipeline(s),a=await this.executeValidationPipeline(n,e,t,r);return this.validationCache.set(i,a),a}async executeValidationPipeline(e,t,r,i){let s=[],n=[];switch(e.executeOrder){case"fail-fast":for(let a of e.rules){let l=await this.executeValidationRule(a,t,r,i);if(!l.isValid&&(s.push(...l.errors),e.skipOnError))break;l.warnings&&n.push(...l.warnings)}break;case"sequential":for(let a of e.rules){let e=await this.executeValidationRule(a,t,r,i);e.isValid||s.push(...e.errors),e.warnings&&n.push(...e.warnings)}break;case"parallel":(await Promise.all(e.rules.map(e=>this.executeValidationRule(e,t,r,i)))).forEach(e=>{e.isValid||s.push(...e.errors),e.warnings&&n.push(...e.warnings)})}return{isValid:0===s.length,errors:s,warnings:n.length>0?n:void 0}}async executeValidationRule(e,t,r,i){try{let s=await e.validator(r,t,i);return"boolean"==typeof s?{isValid:s,errors:s?[]:[{field:t.fieldName,code:e.name,message:e.message||`Validation failed for ${t.fieldName}`,severity:"error"}]}:"string"==typeof s?{isValid:!1,errors:[{field:t.fieldName,code:e.name,message:s,severity:"error"}]}:s}catch(e){return{isValid:!1,errors:[{field:t.fieldName,code:"validation_error",message:`Validation error: ${e}`,severity:"error"}]}}}buildValidationRules(e){let t=[];if(e.constraints.required&&t.push({name:"required",validator:t=>!(null==t||""===t||Array.isArray(t)&&0===t.length)||e.constraints.requiredMessage||`${e.schema.label||e.fieldName} is required`}),t.push(...this.getTypeSpecificRules(e)),e.constraints.pattern){let r=e.constraints.pattern,i=e.constraints.patternMessage;t.push({name:"pattern",validator:e=>!e||new RegExp(r).test(String(e))||i||"Value does not match required format"})}if((e.constraints.minLength||e.constraints.maxLength)&&t.push({name:"length",validator:t=>{if(!t)return!0;let r=String(t);return e.constraints.minLength&&r.length<e.constraints.minLength?`Must be at least ${e.constraints.minLength} characters`:!e.constraints.maxLength||!(r.length>e.constraints.maxLength)||`Must be at most ${e.constraints.maxLength} characters`}}),e.constraints.customValidator&&this.customValidators.has(e.constraints.customValidator)){let r=this.customValidators.get(e.constraints.customValidator);t.push({name:e.constraints.customValidator,validator:r,async:!0})}return e.constraints.serverValidation&&t.push({name:"server_validation",validator:(e,t,r)=>this.validateOnServer(e,t,r),async:!0}),t}getTypeSpecificRules(e){let t=[];switch(e.fieldType){case"email":t.push({name:"email_format",validator:e=>!e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e))||"Please enter a valid email address"});break;case"url":t.push({name:"url_format",validator:e=>{if(!e)return!0;try{return new URL(String(e)),!0}catch{return"Please enter a valid URL"}}});break;case"number":case"range":t.push({name:"number_format",validator:(e,t)=>{if(!e&&0!==e)return!0;let r=Number(e);if(isNaN(r))return"Please enter a valid number";let i=void 0!==t.constraints.min?Number(t.constraints.min):void 0,s=void 0!==t.constraints.max?Number(t.constraints.max):void 0;return void 0!==i&&r<i?`Value must be at least ${i}`:void 0===s||!(r>s)||`Value must be at most ${s}`}});break;case"tel":t.push({name:"phone_format",validator:e=>!e||/^[\d\s\-\+\(\)]+$/.test(String(e))||"Please enter a valid phone number"});break;case"date":t.push({name:"date_format",validator:(e,t)=>{if(!e)return!0;let r=new Date(String(e));if(isNaN(r.getTime()))return"Please enter a valid date";if(t.constraints.min){let e=new Date(t.constraints.min);if(r<e)return`Date must be after ${e.toLocaleDateString()}`}if(t.constraints.max){let e=new Date(t.constraints.max);if(r>e)return`Date must be before ${e.toLocaleDateString()}`}return!0}})}return t}async validateOnServer(e,t,r){let i=t.constraints.serverValidation;return new Promise(s=>{let n=this.asyncValidationTimers.get(t.fieldName);n&&clearTimeout(n);let a=setTimeout(async()=>{try{let n=await this.makeValidationRequest(e,t,r,i);s(n)}catch{s({isValid:!1,errors:[{field:t.fieldName,code:"server_error",message:"Server validation failed",severity:"error"}]})}},i.debounceMs||500);this.asyncValidationTimers.set(t.fieldName,a)})}async makeValidationRequest(e,t,r,i){return t.fieldName,{isValid:!0,errors:[]}}validateCrossFields(e,t){let r=[];return t.forEach(t=>{try{let i=t.validator(e);"string"==typeof i?r.push({field:t.fields[0],code:t.name,message:i,severity:"error"}):"object"!=typeof i||i.isValid||r.push(...i.errors)}catch(e){r.push({field:t.fields[0],code:"cross_field_error",message:`Cross-field validation error: ${e}`,severity:"error"})}}),{isValid:0===r.length,errors:r}}clearCache(e){if(e)for(let t of this.validationCache.keys())t.startsWith(`${e}:`)&&this.validationCache.delete(t);else this.validationCache.clear()}getCacheKey(e,t){return`${e}:${JSON.stringify(t)}`}dispose(){this.asyncValidationTimers.forEach(e=>clearTimeout(e)),this.asyncValidationTimers.clear(),this.validationCache.clear()}}let e1="formdown:field:change",e3="formdown:field:invalid",e2="formdown:data:change",e5="formdown:validation:success",e9="formdown:validation:error",e6="formdown:schema:change";class e4{constructor(e={}){this.eventBuses=new Map,this.eventBridges=new Map,this.globalEventConfig={enableFormEvents:!0,enableFieldEvents:!0,enableValidationEvents:!0,enableLifecycleEvents:!0,bubbleEvents:!0,eventPrefix:"formdown",...e},this.globalEventBus=this.createEventBus("global")}createEventBus(e=`bus_${Date.now()}`){let t=new Map,r={emit:(r,i)=>{let s=t.get(r);s&&s.forEach(e=>{try{e(i)}catch(e){console.error(`Error in event handler for ${r}:`,e)}}),this.globalEventConfig.bubbleEvents&&"global"!==e&&this.globalEventBus.emit(r,{source:e,data:i})},on:(e,r)=>(t.has(e)||t.set(e,new Set),t.get(e).add(r),()=>{t.get(e)?.delete(r)}),off:(e,r)=>{t.get(e)?.delete(r)},once:(e,t)=>{let i=s=>{t(s),r.off(e,i)};return r.on(e,i)},clear:()=>{t.clear()}};return this.eventBuses.set(e,r),r}bridgeComponentEvents(e,t,r){let i=`${e.id}_to_${t.id}`,s={source:e,target:t,eventMappings:r,isActive:!0};return r.forEach(r=>{e.on&&e.on(r.sourceEvent,e=>{if(!s.isActive||r.condition&&!r.condition(e))return;let i=e;if(r.transformer)try{i=r.transformer(e)}catch(e){console.error(`Error in event transformer for ${r.sourceEvent}:`,e);return}t.emit&&t.emit(r.targetEvent,i)})}),this.eventBridges.set(i,s),i}setupGlobalEventHandling(){this.globalEventConfig.enableFormEvents&&this.setupFormEventHandlers(),this.globalEventConfig.enableFieldEvents&&this.setupFieldEventHandlers(),this.globalEventConfig.enableValidationEvents&&this.setupValidationEventHandlers(),this.globalEventConfig.enableLifecycleEvents&&this.setupLifecycleEventHandlers()}setupFormEventHandlers(){this.globalEventBus.on("formdown:form:initialized",e=>{console.debug("Form initialized:",e)}),this.globalEventBus.on(e2,e=>{this.globalEventBus.emit("formdown:data:sync",e)}),this.globalEventBus.on("formdown:form:destroyed",e=>{this.cleanupFormEventBridges(e?.formId)})}setupFieldEventHandlers(){this.globalEventBus.on(e1,e=>{this.globalEventBus.emit("formdown:validation:start",{fieldName:e.fieldName,value:e.value})}),this.globalEventBus.on(e3,e=>{console.debug("Field validation error:",e)})}setupValidationEventHandlers(){this.globalEventBus.on(e9,e=>{console.debug("Validation error:",e)}),this.globalEventBus.on(e5,e=>{console.debug("Validation success:",e)})}setupLifecycleEventHandlers(){this.globalEventBus.on("formdown:ui:render:complete",e=>{this.globalEventBus.emit("formdown:form:ready",e)}),this.globalEventBus.on("formdown:extension:loaded",e=>{console.debug("Extension loaded:",e)})}createCoreUIBridge(e,t){let r=[{sourceEvent:e2,targetEvent:"formdown:ui:update",transformer:e=>({formData:e.formData})},{sourceEvent:e9,targetEvent:e3,transformer:e=>({fieldName:e.field,errors:e.errors})},{sourceEvent:e5,targetEvent:"formdown:field:valid",transformer:e=>({fieldName:e.field})},{sourceEvent:e1,targetEvent:e2,transformer:e=>({fieldName:e.fieldName,value:e.value,formData:e.formData})}];return this.bridgeComponentEvents(e,t,r)}createCoreEditorBridge(e,t){let r=[{sourceEvent:e6,targetEvent:"formdown:editor:preview:update",transformer:e=>({schema:e.schema})},{sourceEvent:"formdown:editor:content:change",targetEvent:e6,transformer:e=>({content:e.content})},{sourceEvent:e9,targetEvent:"formdown:editor:error",transformer:e=>({errors:e.errors})}];return this.bridgeComponentEvents(e,t,r)}getGlobalEventBus(){return this.globalEventBus}getEventBus(e){return this.eventBuses.get(e)}removeBridge(e){let t=this.eventBridges.get(e);t&&(t.isActive=!1,this.eventBridges.delete(e))}cleanupFormEventBridges(e){if(e)for(let[t,r]of this.eventBridges.entries())t.includes(e)&&this.removeBridge(t)}getActiveBridges(){return Array.from(this.eventBridges.values()).filter(e=>e.isActive)}dispose(){this.eventBuses.forEach(e=>e.clear()),this.eventBuses.clear(),this.eventBridges.forEach(e=>{e.isActive=!1}),this.eventBridges.clear(),this.globalEventBus.clear()}configureEvents(e){this.globalEventConfig={...this.globalEventConfig,...e},this.setupGlobalEventHandling()}getEventStats(){return{totalEventBuses:this.eventBuses.size,totalBridges:this.eventBridges.size,activeBridges:this.getActiveBridges().length}}}class e7{constructor(e={}){this.options=e,this.content="",this.parsedContent=null,this.schema=null,this.dataBinding=null,this.eventListeners=new Map,this.fieldProcessor=null,this.domBinder=null,this.validationManager=null,this.eventOrchestrator=null,this.parser=new I(e),this.generator=new eQ,[].forEach(e=>{this.eventListeners.set(e,new Set)})}parse(e){return this.content=e,this.parsedContent=this.parser.parseFormdown(e),this.schema=new eK().extractSchema(e),this.dataBinding=new eJ(this.schema),this.setupDataBindingEvents(),this.parsedContent}render(e={}){if(!this.parsedContent)throw Error("No content parsed. Call parse() first.");return"json"===e.outputFormat?JSON.stringify(this.parsedContent,null,2):this.generator.generateHTML(this.parsedContent)}getSchema(){return this.schema?{...this.schema}:null}getData(){return this.dataBinding?this.dataBinding.getAll():{}}setFieldValue(e,t){this.dataBinding&&this.dataBinding.set(e,t)}updateData(e){this.dataBinding&&this.dataBinding.updateAll(e)}reset(){this.dataBinding&&(this.dataBinding.reset(),this.emit("form-reset",{formData:this.getData()}))}validate(){return this.dataBinding?this.dataBinding.validate():{isValid:!0,errors:[]}}getDefaultValues(){return this.dataBinding?this.dataBinding.getSchemaDefaults():{}}isDirty(){return!!this.dataBinding&&this.dataBinding.isDirty()}getField(e){return this.parsedContent&&this.parsedContent.forms.find(t=>t.name===e)||null}getFields(){return this.parsedContent?.forms||[]}getFormDeclarations(){return this.parsedContent?.formDeclarations||[]}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t)}off(e,t){let r=this.eventListeners.get(e);r&&r.delete(t)}emit(e,t){let r=this.eventListeners.get(e);r&&r.forEach(r=>{try{r(t)}catch(t){console.error(`Error in FormManager event handler for '${e}':`,t)}})}setupDataBindingEvents(){this.dataBinding&&(this.dataBinding.subscribeToField((e,t,r)=>{this.emit("data-change",{field:e,value:t,formData:r})}),this.dataBinding.subscribeToValidation((e,t)=>{t.length>0&&this.emit("validation-error",{field:e,errors:t})}))}clone(){return new e7(this.options)}export(){return{content:this.content,data:this.getData(),schema:this.getSchema(),options:{...this.options}}}import(e){e.options&&(Object.assign(this.options,e.options),this.parser=new I(this.options)),this.parse(e.content),e.data&&this.updateData(e.data)}createFieldProcessor(){return this.fieldProcessor||(this.fieldProcessor=new eX),this.fieldProcessor}createDOMBinder(){return this.domBinder||(this.domBinder=new eY),this.domBinder}createValidationManager(){return this.validationManager||(this.validationManager=new e0),this.validationManager}createEventOrchestrator(){return this.eventOrchestrator||(this.eventOrchestrator=new e4),this.eventOrchestrator}processFieldValue(e,t){let r=this.createFieldProcessor(),i=this.getField(e);if(!i)return console.warn(`Field ${e} not found in schema`),t;let s=r.getFieldType({id:e,name:e,value:String(t),type:i.type||"text",hasAttribute:()=>!1,getAttribute:()=>null});return r.extractFieldValue({id:e,name:e,value:String(t),type:i.type||"text",hasAttribute:()=>!1,getAttribute:()=>null},s)}async validateFieldWithPipeline(e,t){let r=this.createValidationManager(),i=this.getField(e),s=this.createFieldProcessor();if(!i)return{isValid:!1,errors:[`Field ${e} not found`]};let n=s.getFieldType({id:e,name:e,value:String(t),type:i.type||"text",hasAttribute:()=>!1,getAttribute:()=>null}),a={fieldName:e,fieldType:n,constraints:i.attributes||{},schema:i};return await r.validateAsync(a,t,this.getData())}setupComponentBridge(e){let t=this.createEventOrchestrator(),r={id:"formdown-core",type:"core",emit:(e,t)=>{"formdown:data:change"===e?this.emit("data-change",t):"formdown:validation:error"===e&&this.emit("validation-error",t)},on:(e,t)=>("formdown:field:change"===e&&this.on("data-change",t),()=>{})};return"ui"===e.type?t.createCoreUIBridge(r,e):"editor"===e.type?t.createCoreEditorBridge(r,e):t.bridgeComponentEvents(r,e,[])}renderToTemplate(e={}){if(!this.parsedContent)throw Error("No content parsed. Call parse() first.");return{fields:this.getFields(),formDeclarations:this.getFormDeclarations(),schema:this.getSchema(),data:this.getData(),html:this.render(),options:e}}handleUIEvent(e,t){t||(t=this.createDOMBinder());let r=e.target,i=r?.name||r?.id;if(i&&"change"===e.type){let e=this.createFieldProcessor(),t=e.getFieldType(r),s=e.extractFieldValue(r,t);this.setFieldValue(i,s)}}createPreviewTemplate(e){try{let t=new e7(this.options);return t.parse(e),{html:t.render(),errors:[],schema:t.getSchema(),fields:t.getFields()}}catch(e){return{html:"",errors:[String(e)],schema:null,fields:[]}}}getCoreModules(){return{fieldProcessor:this.fieldProcessor,domBinder:this.domBinder,validationManager:this.validationManager,eventOrchestrator:this.eventOrchestrator}}dispose(){this.validationManager&&(this.validationManager.dispose(),this.validationManager=null),this.domBinder&&(this.domBinder.clearAllBindings(),this.domBinder=null),this.eventOrchestrator&&(this.eventOrchestrator.dispose(),this.eventOrchestrator=null),this.fieldProcessor=null,this.eventListeners.clear(),this.dataBinding&&(this.dataBinding=null)}}function e8(e,t){let r=[];return t.required&&(!e||""===String(e).trim())&&r.push({field:t.name||"field",message:t.errorMessage||`${t.label||"Field"} is required`}),r}let te=class e{constructor(){this.initialized=!1}static getInstance(){return e.instance||(e.instance=new e),e.instance}async initialize(){if(!this.initialized)try{await z.initialize(),this.setupEditorHooks(),this.initialized=!0}catch{}}setupEditorHooks(){L({name:"pre-parse",priority:1,handler:this.handlePreParse.bind(this)}),L({name:"post-parse",priority:1,handler:this.handlePostParse.bind(this)}),L({name:"field-validate",priority:1,handler:this.handleFieldValidate.bind(this)})}handlePreParse(e){return e}handlePostParse(e){return e}handleFieldValidate(e,t){return{valid:!0,message:""}}async registerEditorPlugin(e){await D(e)}getExtensionStats(){return z.getStats()}async executeEditorHooks(e,t,...r){return z.executeHooks(e,t,...r)}async validateContent(e){try{let t=await this.executeEditorHooks("field-validate",{input:e},e),r=[];return t.forEach(e=>{e&&!e.valid&&e.message&&r.push(e.message)}),{isValid:0===r.length,errors:r}}catch(e){return{isValid:!1,errors:[e instanceof Error?e.message:"Validation error"]}}}};te.instance=null;let tt=te.getInstance();var tr=Object.defineProperty,ti=Object.getOwnPropertyDescriptor,ts=(e,t,r,i)=>{for(var s,n=i>1?void 0:i?ti(t,r):t,a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i?s(t,r,n):s(n))||n);return i&&n&&tr(t,r,n),n},tn=`# Contact Form

Fill out the form below to get in touch:

@full_name: [text required placeholder="Enter your full name"]
@email_address: [email required]
@phone_number: [tel]
@message: [textarea rows=4 placeholder="Your message here..."]
@contact_method: [radio options="Email, Phone, Either"]
@newsletter_signup: [checkbox]`;let ta=class extends i.LitElement{constructor(){super(...arguments),this.content=tn,this.mode="split",this.placeholder='Try FormDown with smart labels! Field names like "full_name" become "Full Name" automatically...',this.header=!1,this.toolbar=!0,this._data={},this.parseResult={fields:[],errors:[]}}get data(){if(this.formManager){let e=this.formManager.getData();if(e&&Object.keys(e).length>0)return e}return this._data}set data(e){let t={};null!=e&&"object"==typeof e&&(t="formData"in e&&"object"==typeof e.formData?{...e.formData}:{...e}),this._data=t,this.formManager&&this.formManager.updateData(t),this.requestUpdate("data")}async connectedCallback(){super.connectedCallback(),this.formManager=new e7,this.formManager.setupComponentBridge({id:"formdown-editor",type:"editor",emit:(e,t)=>{this.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,composed:!0}))},on:(e,t)=>()=>{}}),this.formManager.on("data-change",({formData:e})=>{this._data=e,this.requestUpdate("data"),this.dispatchEvent(new CustomEvent("formdown-data-update",{detail:e,bubbles:!0,composed:!0}))}),this._data&&Object.keys(this._data).length>0&&this.formManager.updateData(this._data);try{await tt.initialize()}catch{}this.content===tn&&this.textContent?.trim()&&(this.content=this.textContent.trim(),this.textContent=""),await this.updateParseResult()}willUpdate(e){if(super.willUpdate(e),e.has("content")){let e=this.shadowRoot?.querySelector(".editor-textarea");if(e&&document.activeElement===e)return}}render(){return s.html`
            <div class="editor-container mode-${this.mode}">
                ${"view"!==this.mode?s.html`
                    <div class="editor-panel">
                        ${this.header?s.html`<div class="panel-header">Formdown Editor</div>`:""}
                        ${this.renderToolbar()}
                        <textarea
                            class="editor-textarea"
                            .value=${this.content}
                            @input=${this.handleInput}
                            @keydown=${this.handleKeydown}
                            placeholder=${this.placeholder}
                            spellcheck="false"
                        ></textarea>
                        <div class="stats">
                            <span>Lines: ${this.content.split(`
`).length}</span>
                            <span>Characters: ${this.content.length}</span>
                        </div>
                    </div>
                `:""}
                ${"edit"!==this.mode?s.html`
                    <div class="preview-panel">
                        ${this.header?s.html`<div class="panel-header">Formdown UI</div>`:""}
                        <div class="preview-content">
                            ${this.renderErrors()}
                            <div id="formdown-ui-container"></div>
                        </div>
                    </div>
                `:""}
            </div>
        `}updated(e){if(super.updated(e),e.has("mode")){let e=this._data;"edit"!==this.mode&&(this.updateFormdownUI(),e&&Object.keys(e).length>0&&setTimeout(()=>{let t=this.shadowRoot?.querySelector("#formdown-ui-container")?.querySelector("formdown-ui");t&&(t.data=e)},0));return}if("edit"!==this.mode&&(e.has("content")||e.has("parseResult"))&&this.updateFormdownUI(),e.has("data")&&"edit"!==this.mode){let e=this.shadowRoot?.querySelector("#formdown-ui-container")?.querySelector("formdown-ui");e&&(e.data=this.data||{})}}firstUpdated(e){super.firstUpdated(e),"edit"!==this.mode&&this.updateFormdownUI()}updateFormdownUI(){let e=this.shadowRoot?.querySelector("#formdown-ui-container");if(e)try{if(!customElements.get("formdown-ui")){e.innerHTML='<div style="padding: 1rem; color: #666;">Loading form preview...</div>';return}let t=e.querySelector("formdown-ui");t||((t=document.createElement("formdown-ui")).style.width="100%",t.style.height="100%",t.addEventListener("formdown-data-update",e=>{let t=e.detail?.formData||e.detail;this.formManager.updateData(t)}),t.addEventListener("formdown-change",e=>{this.dispatchEvent(new CustomEvent("formdown-change",{detail:e.detail,bubbles:!0,composed:!0}))}),e.appendChild(t)),t.setAttribute("content",this.content),this._data&&Object.keys(this._data).length>0&&(t.data=this._data)}catch(t){e.innerHTML=`<div style="padding: 1rem; color: #dc2626;">Preview Error: ${t instanceof Error?t.message:"Unknown error"}</div>`}}handleInput(e){let t=e.target;this.content=t.value,this.updateParseResult(),this.dispatchContentChange()}handleKeydown(e){if("Tab"===e.key){e.preventDefault();let t=e.target,r=t.selectionStart,i=t.selectionEnd,s=t.value.substring(0,r),n=t.value.substring(i);t.value=s+"  "+n,t.selectionStart=t.selectionEnd=r+2,this.content=t.value,this.updateParseResult(),this.dispatchContentChange()}}insertSnippet(e){let t=this.shadowRoot?.querySelector(".editor-textarea");if(!t)return;let r=t.selectionStart,i=t.selectionEnd,s=this.content.substring(0,r),n=this.content.substring(i);this.content=s+e+n,this.updateParseResult(),this.dispatchContentChange(),this.updateComplete.then(()=>{t.focus(),t.selectionStart=t.selectionEnd=r+e.length})}async updateParseResult(){try{this.formManager.parse(this.content);let e=await tt.validateContent(this.content),t=this.formManager.getFields();this.parseResult={fields:t||[],errors:e.errors.map(e=>({line:0,message:e}))}}catch(e){this.parseResult={fields:[],errors:[{line:0,message:e instanceof Error?e.message:"Parse error"}]}}}dispatchContentChange(){this.dispatchEvent(new CustomEvent("contentChange",{detail:{content:this.content},bubbles:!0,composed:!0}))}renderToolbar(){return this.toolbar?s.html`
            <div class="toolbar">
                ${[{name:"Text",snippet:"@name: [text required]"},{name:"Textarea",snippet:"@bio: [textarea rows=4]"},{name:"Radio",snippet:'@gender: [radio required options="Option 1,Option 2"]'},{name:"Check",snippet:'@interests: [checkbox options="Item 1,Item 2"]'},{name:"Select",snippet:'@country: [select required options="USA,Canada,UK"]'},{name:"Range",snippet:'@volume: [range min=0 max=100 unit="%"]'}].map(e=>s.html`
                    <button class="toolbar-button" @click=${()=>this.insertSnippet(e.snippet)}>
                        ${e.name}
                    </button>
                `)}
            </div>
        `:""}renderErrors(){return 0===this.parseResult.errors.length?"":s.html`
            <div class="error-list">
                <strong>Errors:</strong>
                ${this.parseResult.errors.map(e=>s.html`
                    <div class="error-item">${e}</div>
                `)}
            </div>
        `}validate(){let e=this.shadowRoot?.querySelector(".preview-content")?.querySelector("formdown-ui");return e&&"function"==typeof e.validate?e.validate():{isValid:!1,errors:[{field:"general",message:"FormdownUI component not found for validation"}]}}getFormData(){let e=this.shadowRoot?.querySelector(".preview-content")?.querySelector("formdown-ui");return e&&"function"==typeof e.getFormData?e.getFormData():{}}};ta.styles=r.css`${(0,r.unsafeCSS)(":host{display:block;font-family:system-ui,-apple-system,sans-serif;height:600px;border:1px solid var(--theme-border, #d1d5db);border-radius:.375rem;overflow:hidden;background:var(--theme-bg-primary, #ffffff)}.editor-container{display:flex;height:100%;background:var(--theme-bg-primary, #ffffff)}.editor-panel{flex:1;display:flex;flex-direction:column;border-right:1px solid var(--theme-border, #d1d5db);background:var(--theme-bg-primary, #ffffff)}.preview-panel{flex:1;display:flex;flex-direction:column;background-color:var(--theme-bg-secondary, #f9fafb)}.panel-header{padding:.75rem 1rem;background-color:var(--theme-bg-secondary, #f3f4f6);border-bottom:1px solid var(--theme-border, #d1d5db);font-weight:500;font-size:.875rem;color:var(--theme-text-primary, #374151)}.editor-textarea{flex:1;width:100%;border:none;outline:none;padding:1rem;font-family:Monaco,Menlo,Ubuntu Mono,monospace;font-size:.875rem;line-height:1.5;resize:none;background-color:var(--theme-bg-primary, white);color:var(--theme-text-primary, #1f2937);height:0}.preview-content{flex:1;padding:1rem;overflow-y:auto;height:0}.toolbar{display:flex;padding:.5rem;background-color:var(--theme-bg-secondary, #f9fafb);border-bottom:1px solid var(--theme-border, #d1d5db);gap:.5rem}.toolbar-button{padding:.25rem .5rem;background-color:var(--theme-bg-primary, white);border:1px solid var(--theme-border, #d1d5db);border-radius:.25rem;font-size:.75rem;cursor:pointer;transition:background-color .15s ease-in-out;color:var(--theme-text-primary, #1f2937)}.toolbar-button:hover{background-color:var(--theme-bg-secondary, #f3f4f6)}.stats{padding:.5rem 1rem;background-color:var(--theme-bg-secondary, #f9fafb);border-top:1px solid var(--theme-border, #d1d5db);font-size:.75rem;color:var(--theme-text-secondary, #6b7280);display:flex;justify-content:space-between}.error-list{background-color:var(--theme-error-bg, #fef2f2);border-left:4px solid var(--theme-error, #dc2626);padding:1rem;margin-bottom:1rem}.error-item{color:var(--theme-error, #dc2626);font-size:.875rem;margin-bottom:.25rem}.mode-edit .preview-panel,.mode-view .editor-panel{display:none}.mode-edit .editor-panel{border-right:none}.mode-view{overflow-y:auto}.mode-view .preview-panel{border-right:none;height:auto;min-height:100%}@media(max-width:768px){.editor-container{flex-direction:column}.editor-panel{border-right:none;border-bottom:1px solid var(--theme-border, #d1d5db)}}")}`,ts([F()],ta.prototype,"content",2),ts([F({type:String})],ta.prototype,"mode",2),ts([F({type:String})],ta.prototype,"placeholder",2),ts([F({type:Boolean})],ta.prototype,"header",2),ts([F({type:Boolean})],ta.prototype,"toolbar",2),ts([T()],ta.prototype,"_data",2),ts([T()],ta.prototype,"parseResult",2),ta=ts([(t="formdown-editor",(e,r)=>{void 0!==r?r.addInitializer(()=>{customElements.define(t,e)}):customElements.define(t,e)})],ta);let tl=(e,t={})=>{let r=document.createElement("formdown-editor");return t.content&&(r.content=t.content),void 0!==t.showPreview&&(r.showPreview=t.showPreview),void 0!==t.showToolbar&&(r.showToolbar=t.showToolbar),t.placeholder&&(r.placeholder=t.placeholder),e.appendChild(r),r},to=()=>{};e.s(["EditorExtensionSupport",()=>te,"FormdownEditor",()=>ta,"createFormdownEditor",()=>tl,"editorExtensionSupport",()=>tt,"registerFormdownEditor",()=>to])}]);