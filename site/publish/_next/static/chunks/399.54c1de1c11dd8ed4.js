"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[399],{5547:(e,t,r)=>{r.d(t,{WF:()=>el,AH:()=>c,qy:()=>j,iz:()=>l});let i=globalThis,n=i.ShadowRoot&&(void 0===i.ShadyCSS||i.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,s=Symbol(),a=new WeakMap;class o{constructor(e,t,r){if(this._$cssResult$=!0,r!==s)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o,t=this.t;if(n&&void 0===e){let r=void 0!==t&&1===t.length;r&&(e=a.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&a.set(t,e))}return e}toString(){return this.cssText}}let l=e=>new o("string"==typeof e?e:e+"",void 0,s),c=(e,...t)=>new o(1===e.length?e[0]:t.reduce((t,r,i)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(r)+e[i+1],e[0]),e,s),h=n?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(let r of e.cssRules)t+=r.cssText;return l(t)})(e):e,{is:d,defineProperty:u,getOwnPropertyDescriptor:p,getOwnPropertyNames:m,getOwnPropertySymbols:f,getPrototypeOf:g}=Object,b=globalThis,v=b.trustedTypes,y=v?v.emptyScript:"",w=b.reactiveElementPolyfillSupport,k={toAttribute(e,t){switch(t){case Boolean:e=e?y:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let r=e;switch(t){case Boolean:r=null!==e;break;case Number:r=null===e?null:Number(e);break;case Object:case Array:try{r=JSON.parse(e)}catch(e){r=null}}return r}},x=(e,t)=>!d(e,t),E={attribute:!0,type:String,converter:k,reflect:!1,useDefault:!1,hasChanged:x};Symbol.metadata??=Symbol("metadata"),b.litPropertyMetadata??=new WeakMap;class _ extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=E){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){let r=Symbol(),i=this.getPropertyDescriptor(e,r,t);void 0!==i&&u(this.prototype,e,i)}}static getPropertyDescriptor(e,t,r){let{get:i,set:n}=p(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:i,set(t){let s=i?.call(this);n?.call(this,t),this.requestUpdate(e,s,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??E}static _$Ei(){if(this.hasOwnProperty("elementProperties"))return;let e=g(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty("finalized"))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty("properties")){let e=this.properties;for(let t of[...m(e),...f(e)])this.createProperty(t,e[t])}let e=this[Symbol.metadata];if(null!==e){let t=litPropertyMetadata.get(e);if(void 0!==t)for(let[e,r]of t)this.elementProperties.set(e,r)}for(let[e,t]of(this._$Eh=new Map,this.elementProperties)){let r=this._$Eu(e,t);void 0!==r&&this._$Eh.set(r,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e))for(let r of new Set(e.flat(1/0).reverse()))t.unshift(h(r));else void 0!==e&&t.push(h(e));return t}static _$Eu(e,t){let r=t.attribute;return!1===r?void 0:"string"==typeof r?r:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){let e=new Map;for(let t of this.constructor.elementProperties.keys())this.hasOwnProperty(t)&&(e.set(t,this[t]),delete this[t]);e.size>0&&(this._$Ep=e)}createRenderRoot(){let e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(n)e.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(let r of t){let t=document.createElement("style"),n=i.litNonce;void 0!==n&&t.setAttribute("nonce",n),t.textContent=r.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,r){this._$AK(e,r)}_$ET(e,t){let r=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,r);if(void 0!==i&&!0===r.reflect){let n=(void 0!==r.converter?.toAttribute?r.converter:k).toAttribute(t,r.type);this._$Em=e,null==n?this.removeAttribute(i):this.setAttribute(i,n),this._$Em=null}}_$AK(e,t){let r=this.constructor,i=r._$Eh.get(e);if(void 0!==i&&this._$Em!==i){let e=r.getPropertyOptions(i),n="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:k;this._$Em=i,this[i]=n.fromAttribute(t,e.type)??this._$Ej?.get(i)??null,this._$Em=null}}requestUpdate(e,t,r){if(void 0!==e){let i=this.constructor,n=this[e];if(!(((r??=i.getPropertyOptions(e)).hasChanged??x)(n,t)||r.useDefault&&r.reflect&&n===this._$Ej?.get(e)&&!this.hasAttribute(i._$Eu(e,r))))return;this.C(e,t,r)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:r,reflect:i,wrapped:n},s){r&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,s??t??this[e]),!0!==n||void 0!==s)||(this._$AL.has(e)||(this.hasUpdated||r||(t=void 0),this._$AL.set(e,t)),!0===i&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}let e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(let[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}let e=this.constructor.elementProperties;if(e.size>0)for(let[t,r]of e){let{wrapped:e}=r,i=this[t];!0!==e||this._$AL.has(t)||void 0===i||this.C(t,void 0,r,i)}}let e=!1,t=this._$AL;try{(e=this.shouldUpdate(t))?(this.willUpdate(t),this._$EO?.forEach(e=>e.hostUpdate?.()),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach(e=>e.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(e=>this._$ET(e,this[e])),this._$EM()}updated(e){}firstUpdated(e){}}_.elementStyles=[],_.shadowRootOptions={mode:"open"},_.elementProperties=new Map,_.finalized=new Map,w?.({ReactiveElement:_}),(b.reactiveElementVersions??=[]).push("2.1.0");let A=globalThis,S=A.trustedTypes,$=S?S.createPolicy("lit-html",{createHTML:e=>e}):void 0,C="$lit$",T=`lit$${Math.random().toFixed(9).slice(2)}$`,R="?"+T,F=`<${R}>`,P=document,M=()=>P.createComment(""),I=e=>null===e||"object"!=typeof e&&"function"!=typeof e,O=Array.isArray,L="[ 	\n\f\r]",D=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,z=/-->/g,q=/>/g,B=RegExp(`>|${L}(?:([^\\s"'>=/]+)(${L}*=${L}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),H=/'/g,N=/"/g,U=/^(?:script|style|textarea|title)$/i,V=e=>(t,...r)=>({_$litType$:e,strings:t,values:r}),j=V(1),W=(V(2),V(3),Symbol.for("lit-noChange")),G=Symbol.for("lit-nothing"),Z=new WeakMap,Q=P.createTreeWalker(P,129);function K(e,t){if(!O(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==$?$.createHTML(t):t}class J{constructor({strings:e,_$litType$:t},r){let i;this.parts=[];let n=0,s=0,a=e.length-1,o=this.parts,[l,c]=((e,t)=>{let r=e.length-1,i=[],n,s=2===t?"<svg>":3===t?"<math>":"",a=D;for(let t=0;t<r;t++){let r=e[t],o,l,c=-1,h=0;for(;h<r.length&&(a.lastIndex=h,null!==(l=a.exec(r)));)h=a.lastIndex,a===D?"!--"===l[1]?a=z:void 0!==l[1]?a=q:void 0!==l[2]?(U.test(l[2])&&(n=RegExp("</"+l[2],"g")),a=B):void 0!==l[3]&&(a=B):a===B?">"===l[0]?(a=n??D,c=-1):void 0===l[1]?c=-2:(c=a.lastIndex-l[2].length,o=l[1],a=void 0===l[3]?B:'"'===l[3]?N:H):a===N||a===H?a=B:a===z||a===q?a=D:(a=B,n=void 0);let d=a===B&&e[t+1].startsWith("/>")?" ":"";s+=a===D?r+F:c>=0?(i.push(o),r.slice(0,c)+C+r.slice(c)+T+d):r+T+(-2===c?t:d)}return[K(e,s+(e[r]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),i]})(e,t);if(this.el=J.createElement(l,r),Q.currentNode=this.el.content,2===t||3===t){let e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(i=Q.nextNode())&&o.length<a;){if(1===i.nodeType){if(i.hasAttributes())for(let e of i.getAttributeNames())if(e.endsWith(C)){let t=c[s++],r=i.getAttribute(e).split(T),a=/([.?@])?(.*)/.exec(t);o.push({type:1,index:n,name:a[2],strings:r,ctor:"."===a[1]?er:"?"===a[1]?ei:"@"===a[1]?en:et}),i.removeAttribute(e)}else e.startsWith(T)&&(o.push({type:6,index:n}),i.removeAttribute(e));if(U.test(i.tagName)){let e=i.textContent.split(T),t=e.length-1;if(t>0){i.textContent=S?S.emptyScript:"";for(let r=0;r<t;r++)i.append(e[r],M()),Q.nextNode(),o.push({type:2,index:++n});i.append(e[t],M())}}}else if(8===i.nodeType)if(i.data===R)o.push({type:2,index:n});else{let e=-1;for(;-1!==(e=i.data.indexOf(T,e+1));)o.push({type:7,index:n}),e+=T.length-1}n++}}static createElement(e,t){let r=P.createElement("template");return r.innerHTML=e,r}}function Y(e,t,r=e,i){if(t===W)return t;let n=void 0!==i?r._$Co?.[i]:r._$Cl,s=I(t)?void 0:t._$litDirective$;return n?.constructor!==s&&(n?._$AO?.(!1),void 0===s?n=void 0:(n=new s(e))._$AT(e,r,i),void 0!==i?(r._$Co??=[])[i]=n:r._$Cl=n),void 0!==n&&(t=Y(e,n._$AS(e,t.values),n,i)),t}class X{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){let{el:{content:t},parts:r}=this._$AD,i=(e?.creationScope??P).importNode(t,!0);Q.currentNode=i;let n=Q.nextNode(),s=0,a=0,o=r[0];for(;void 0!==o;){if(s===o.index){let t;2===o.type?t=new ee(n,n.nextSibling,this,e):1===o.type?t=new o.ctor(n,o.name,o.strings,this,e):6===o.type&&(t=new es(n,this,e)),this._$AV.push(t),o=r[++a]}s!==o?.index&&(n=Q.nextNode(),s++)}return Q.currentNode=P,i}p(e){let t=0;for(let r of this._$AV)void 0!==r&&(void 0!==r.strings?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}}class ee{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,r,i){this.type=2,this._$AH=G,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){let r;I(e=Y(this,e,t))?e===G||null==e||""===e?(this._$AH!==G&&this._$AR(),this._$AH=G):e!==this._$AH&&e!==W&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):O(r=e)||"function"==typeof r?.[Symbol.iterator]?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==G&&I(this._$AH)?this._$AA.nextSibling.data=e:this.T(P.createTextNode(e)),this._$AH=e}$(e){let{values:t,_$litType$:r}=e,i="number"==typeof r?this._$AC(e):(void 0===r.el&&(r.el=J.createElement(K(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===i)this._$AH.p(t);else{let e=new X(i,this),r=e.u(this.options);e.p(t),this.T(r),this._$AH=e}}_$AC(e){let t=Z.get(e.strings);return void 0===t&&Z.set(e.strings,t=new J(e)),t}k(e){O(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,r,i=0;for(let n of e)i===t.length?t.push(r=new ee(this.O(M()),this.O(M()),this,this.options)):r=t[i],r._$AI(n),i++;i<t.length&&(this._$AR(r&&r._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){let t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class et{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,r,i,n){this.type=1,this._$AH=G,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=n,r.length>2||""!==r[0]||""!==r[1]?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=G}_$AI(e,t=this,r,i){let n=this.strings,s=!1;if(void 0===n)(s=!I(e=Y(this,e,t,0))||e!==this._$AH&&e!==W)&&(this._$AH=e);else{let i,a,o=e;for(e=n[0],i=0;i<n.length-1;i++)(a=Y(this,o[r+i],t,i))===W&&(a=this._$AH[i]),s||=!I(a)||a!==this._$AH[i],a===G?e=G:e!==G&&(e+=(a??"")+n[i+1]),this._$AH[i]=a}s&&!i&&this.j(e)}j(e){e===G?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class er extends et{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===G?void 0:e}}class ei extends et{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==G)}}class en extends et{constructor(e,t,r,i,n){super(e,t,r,i,n),this.type=5}_$AI(e,t=this){if((e=Y(this,e,t,0)??G)===W)return;let r=this._$AH,i=e===G&&r!==G||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,n=e!==G&&(r===G||i);i&&this.element.removeEventListener(this.name,this,r),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class es{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){Y(this,e)}}let ea=A.litHtmlPolyfillSupport;ea?.(J,ee),(A.litHtmlVersions??=[]).push("3.3.0");let eo=globalThis;class el extends _{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){let e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){let t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,r)=>{let i=r?.renderBefore??t,n=i._$litPart$;if(void 0===n){let e=r?.renderBefore??null;i._$litPart$=n=new ee(t.insertBefore(M(),e),e,void 0,r??{})}return n._$AI(e),n})(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return W}}el._$litElement$=!0,el.finalized=!0,eo.litElementHydrateSupport?.({LitElement:el});let ec=eo.litElementPolyfillSupport;ec?.({LitElement:el}),(eo.litElementVersions??=[]).push("4.2.0")},8858:(e,t,r)=>{r.d(t,{_:()=>i});function i(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}},9399:(e,t,r)=>{r.r(t),r.d(t,{EditorExtensionSupport:()=>tm,FormdownEditor:()=>tw,createFormdownEditor:()=>tk,editorExtensionSupport:()=>tf,registerFormdownEditor:()=>tx});var i=r(8858),n=r(5547);function s(){let e=(0,i._)(['<div class="panel-header">Formdown Editor</div>']);return s=function(){return e},e}function a(){let e=(0,i._)(['\n                    <div class="editor-panel">\n                        ',"\n                        ",'\n                        <textarea\n                            class="editor-textarea"\n                            .value=',"\n                            @input=","\n                            @keydown=","\n                            placeholder=",'\n                            spellcheck="false"\n                        ></textarea>\n                        <div class="stats">\n                            <span>Lines: ',"</span>\n                            <span>Characters: ","</span>\n                        </div>\n                    </div>\n                "]);return a=function(){return e},e}function o(){let e=(0,i._)(['<div class="panel-header">Formdown UI</div>']);return o=function(){return e},e}function l(){let e=(0,i._)(['\n                    <div class="preview-panel">\n                        ','\n                        <div class="preview-content">\n                            ','\n                            <div id="formdown-ui-container"></div>\n                        </div>\n                    </div>\n                ']);return l=function(){return e},e}function c(){let e=(0,i._)(['\n            <div class="editor-container mode-','">\n                ',"\n                ","\n            </div>\n        "]);return c=function(){return e},e}function h(){let e=(0,i._)(['\n                    <button class="toolbar-button" @click=',">\n                        ","\n                    </button>\n                "]);return h=function(){return e},e}function d(){let e=(0,i._)(['\n            <div class="toolbar">\n                ',"\n            </div>\n        "]);return d=function(){return e},e}function u(){let e=(0,i._)(['\n                    <div class="error-item">',"</div>\n                "]);return u=function(){return e},e}function p(){let e=(0,i._)(['\n            <div class="error-list">\n                <strong>Errors:</strong>\n                ',"\n            </div>\n        "]);return p=function(){return e},e}function m(){let e=(0,i._)(["",""]);return m=function(){return e},e}var f=Object.defineProperty,g=(e,t,r)=>((e,t,r)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);let b=globalThis,v=b.ShadowRoot&&(void 0===b.ShadyCSS||b.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,y=Symbol(),w=new WeakMap,k=class{get styleSheet(){let e=this.o,t=this.t;if(v&&void 0===e){let r=void 0!==t&&1===t.length;r&&(e=w.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&w.set(t,e))}return e}toString(){return this.cssText}constructor(e,t,r){if(this._$cssResult$=!0,r!==y)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}},x=v?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(let r of e.cssRules)t+=r.cssText;return(e=>new k("string"==typeof e?e:e+"",void 0,y))(t)})(e):e,{is:E,defineProperty:_,getOwnPropertyDescriptor:A,getOwnPropertyNames:S,getOwnPropertySymbols:$,getPrototypeOf:C}=Object,T=globalThis,R=T.trustedTypes,F=R?R.emptyScript:"",P=T.reactiveElementPolyfillSupport,M={toAttribute(e,t){switch(t){case Boolean:e=e?F:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let r=e;switch(t){case Boolean:r=null!==e;break;case Number:r=null===e?null:Number(e);break;case Object:case Array:try{r=JSON.parse(e)}catch(e){r=null}}return r}},I=(e,t)=>!E(e,t),O={attribute:!0,type:String,converter:M,reflect:!1,useDefault:!1,hasChanged:I};null!=Symbol.metadata||(Symbol.metadata=Symbol("metadata")),null!=T.litPropertyMetadata||(T.litPropertyMetadata=new WeakMap);class L extends HTMLElement{static addInitializer(e){var t;this._$Ei(),(null!=(t=this.l)?t:this.l=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O;if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){let r=Symbol(),i=this.getPropertyDescriptor(e,r,t);void 0!==i&&_(this.prototype,e,i)}}static getPropertyDescriptor(e,t,r){var i;let{get:n,set:s}=null!=(i=A(this.prototype,e))?i:{get(){return this[t]},set(e){this[t]=e}};return{get:n,set(t){let i=null==n?void 0:n.call(this);null==s||s.call(this,t),this.requestUpdate(e,i,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){var t;return null!=(t=this.elementProperties.get(e))?t:O}static _$Ei(){if(this.hasOwnProperty("elementProperties"))return;let e=C(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty("finalized"))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty("properties")){let e=this.properties;for(let t of[...S(e),...$(e)])this.createProperty(t,e[t])}let e=this[Symbol.metadata];if(null!==e){let t=litPropertyMetadata.get(e);if(void 0!==t)for(let[e,r]of t)this.elementProperties.set(e,r)}for(let[e,t]of(this._$Eh=new Map,this.elementProperties)){let r=this._$Eu(e,t);void 0!==r&&this._$Eh.set(r,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e))for(let r of new Set(e.flat(1/0).reverse()))t.unshift(x(r));else void 0!==e&&t.push(x(e));return t}static _$Eu(e,t){let r=t.attribute;return!1===r?void 0:"string"==typeof r?r:"string"==typeof e?e.toLowerCase():void 0}_$Ev(){var e;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),null==(e=this.constructor.l)||e.forEach(e=>e(this))}addController(e){var t,r;(null!=(r=this._$EO)?r:this._$EO=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&(null==(t=e.hostConnected)||t.call(e))}removeController(e){var t;null==(t=this._$EO)||t.delete(e)}_$E_(){let e=new Map;for(let t of this.constructor.elementProperties.keys())this.hasOwnProperty(t)&&(e.set(t,this[t]),delete this[t]);e.size>0&&(this._$Ep=e)}createRenderRoot(){var e;let t=null!=(e=this.shadowRoot)?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(v)e.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(let r of t){let t=document.createElement("style"),i=b.litNonce;void 0!==i&&t.setAttribute("nonce",i),t.textContent=r.cssText,e.appendChild(t)}})(t,this.constructor.elementStyles),t}connectedCallback(){var e;null!=this.renderRoot||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null==(e=this._$EO)||e.forEach(e=>{var t;return null==(t=e.hostConnected)?void 0:t.call(e)})}enableUpdating(e){}disconnectedCallback(){var e;null==(e=this._$EO)||e.forEach(e=>{var t;return null==(t=e.hostDisconnected)?void 0:t.call(e)})}attributeChangedCallback(e,t,r){this._$AK(e,r)}_$ET(e,t){var r;let i=this.constructor.elementProperties.get(e),n=this.constructor._$Eu(e,i);if(void 0!==n&&!0===i.reflect){let s=((null==(r=i.converter)?void 0:r.toAttribute)!==void 0?i.converter:M).toAttribute(t,i.type);this._$Em=e,null==s?this.removeAttribute(n):this.setAttribute(n,s),this._$Em=null}}_$AK(e,t){var r,i,n,s;let a=this.constructor,o=a._$Eh.get(e);if(void 0!==o&&this._$Em!==o){let e=a.getPropertyOptions(o),l="function"==typeof e.converter?{fromAttribute:e.converter}:(null==(r=e.converter)?void 0:r.fromAttribute)!==void 0?e.converter:M;this._$Em=o,this[o]=null!=(s=null!=(n=l.fromAttribute(t,e.type))?n:null==(i=this._$Ej)?void 0:i.get(o))?s:null,this._$Em=null}}requestUpdate(e,t,r){var i,n;if(void 0!==e){let s=this.constructor,a=this[e];if(null!=r||(r=s.getPropertyOptions(e)),!((null!=(n=r.hasChanged)?n:I)(a,t)||r.useDefault&&r.reflect&&a===(null==(i=this._$Ej)?void 0:i.get(e))&&!this.hasAttribute(s._$Eu(e,r))))return;this.C(e,t,r)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,r,i){var n,s,a;let{useDefault:o,reflect:l,wrapped:c}=r;o&&!(null!=(n=this._$Ej)?n:this._$Ej=new Map).has(e)&&(this._$Ej.set(e,null!=(s=null!=i?i:t)?s:this[e]),!0!==c||void 0!==i)||(this._$AL.has(e)||(this.hasUpdated||o||(t=void 0),this._$AL.set(e,t)),!0===l&&this._$Em!==e&&(null!=(a=this._$Eq)?a:this._$Eq=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}let e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(null!=this.renderRoot||(this.renderRoot=this.createRenderRoot()),this._$Ep){for(let[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}let e=this.constructor.elementProperties;if(e.size>0)for(let[t,r]of e){let{wrapped:e}=r,i=this[t];!0!==e||this._$AL.has(t)||void 0===i||this.C(t,void 0,r,i)}}let t=!1,r=this._$AL;try{(t=this.shouldUpdate(r))?(this.willUpdate(r),null==(e=this._$EO)||e.forEach(e=>{var t;return null==(t=e.hostUpdate)?void 0:t.call(e)}),this.update(r)):this._$EM()}catch(e){throw t=!1,this._$EM(),e}t&&this._$AE(r)}willUpdate(e){}_$AE(e){var t;null==(t=this._$EO)||t.forEach(e=>{var t;return null==(t=e.hostUpdated)?void 0:t.call(e)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(e=>this._$ET(e,this[e]))),this._$EM()}updated(e){}firstUpdated(e){}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}}L.elementStyles=[],L.shadowRootOptions={mode:"open"},L.elementProperties=new Map,L.finalized=new Map,null==P||P({ReactiveElement:L}),(null!=(e3=T.reactiveElementVersions)?e3:T.reactiveElementVersions=[]).push("2.1.0");let D={attribute:!0,type:String,converter:M,reflect:!1,hasChanged:I},z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,{kind:i,metadata:n}=r,s=globalThis.litPropertyMetadata.get(n);if(void 0===s&&globalThis.litPropertyMetadata.set(n,s=new Map),"setter"===i&&((e=Object.create(e)).wrapped=!0),s.set(r.name,e),"accessor"===i){let{name:i}=r;return{set(r){let n=t.get.call(this);t.set.call(this,r),this.requestUpdate(i,n,e)},init(t){return void 0!==t&&this.C(i,void 0,e,t),t}}}if("setter"===i){let{name:i}=r;return function(r){let n=this[i];t.call(this,r),this.requestUpdate(i,n,e)}}throw Error("Unsupported decorator location: "+i)};function q(e){return(t,r)=>"object"==typeof r?z(e,t,r):((e,t,r)=>{let i=t.hasOwnProperty(r);return t.constructor.createProperty(r,e),i?Object.getOwnPropertyDescriptor(t,r):void 0})(e,t,r)}function B(e){return q({...e,state:!0,attribute:!1})}class H{register(e){let t=this.hooks.get(e.name)||[];t.push(e),t.sort((e,t)=>t.priority-e.priority),this.hooks.set(e.name,t),this.emit("hook-registered",{hook:e.name,priority:e.priority}),this.options.debug&&console.debug("[Formdown] Hook registered: ".concat(e.name," (priority: ").concat(e.priority,")"))}unregister(e,t){let r=this.hooks.get(e)||[],i=r.filter(e=>e.handler!==t);i.length!==r.length&&(this.hooks.set(e,i),this.emit("hook-unregistered",{hook:e}),this.options.debug&&console.debug("[Formdown] Hook unregistered: ".concat(e)))}async execute(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];let s=this.hooks.get(e)||[],a=[];for(let r of(this.emit("hooks-executing",{hook:e,count:s.length}),s)){let n=null;try{n=this.options.timeout?this.createTimeoutPromise(this.options.timeout):null;let s=Promise.resolve(r.handler(t,...i)),o=n?await Promise.race([s,n.promise]):await s;null==n||n.cleanup(),void 0!==o&&a.push(o),this.emit("hook-executed",{hook:e,success:!0})}catch(t){null==n||n.cleanup(),this.handleHookError(e,t)}}return this.emit("hooks-completed",{hook:e,results:a.length}),a}executeSync(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];let s=this.hooks.get(e)||[],a=[];for(let r of(this.emit("hooks-executing",{hook:e,count:s.length}),s))try{let n=r.handler(t,...i);void 0!==n&&a.push(n),this.emit("hook-executed",{hook:e,success:!0})}catch(t){this.handleHookError(e,t)}return this.emit("hooks-completed",{hook:e,results:a.length}),a}clear(e){e?(this.hooks.delete(e),this.emit("hooks-cleared",{hook:e})):(this.hooks.clear(),this.emit("hooks-cleared",{all:!0})),this.options.debug&&console.debug("[Formdown] Hooks cleared: ".concat(e||"all"))}getHooks(e){return[...this.hooks.get(e)||[]]}getHookNames(){return Array.from(this.hooks.keys())}getHookCount(){return Array.from(this.hooks.values()).reduce((e,t)=>e+t.length,0)}createTimeoutPromise(e){let t;return{promise:new Promise((r,i)=>{t=setTimeout(()=>{i(Error("Hook execution timeout after ".concat(e,"ms")))},e)}),cleanup:()=>{clearTimeout(t)}}}handleHookError(e,t){let r="Hook execution failed: ".concat(e," - ").concat(t.message||t);switch(this.emit("hook-error",{hook:e,error:r}),this.options.errorStrategy){case"ignore":break;case"warn":console.warn("[Formdown] ".concat(r));break;default:throw Error(r)}}emit(e,t){if(this.eventEmitter){let r={type:e,data:t,timestamp:Date.now()};this.eventEmitter.emit(e,r)}}constructor(e={},t){this.options=e,this.hooks=new Map,this.eventEmitter=t}}class N{async register(e){var t;if(this.plugins.has(e.metadata.name))throw Error("Plugin '".concat(e.metadata.name,"' is already registered"));if(await this.validateDependencies(e),this.plugins.set(e.metadata.name,e),e.hooks)for(let t of e.hooks)this.hookManager.register(t);if(e.fieldTypes)for(let r of e.fieldTypes)this.fieldTypes.set(r.type,r),null==(t=this.fieldTypeRegistry)||t.register(r);if(e.validators)for(let t of e.validators)this.validators.set(t.name,t);if(e.renderers)for(let t of e.renderers)this.renderers.set(t.template,t);if(e.themes)for(let t of e.themes)this.themes.set(t.name,t);if(this.emit("plugin-registered",{plugin:e.metadata.name,version:e.metadata.version}),this.options.debug&&console.debug("[Formdown] Plugin registered: ".concat(e.metadata.name," v").concat(e.metadata.version)),this.initialized&&e.initialize)try{await e.initialize(),this.emit("plugin-initialized",{plugin:e.metadata.name})}catch(t){this.handlePluginError(e.metadata.name,"initialization",t)}}async unregister(e){var t;let r=this.plugins.get(e);if(r){if(r.destroy)try{await r.destroy(),this.emit("plugin-destroyed",{plugin:e})}catch(t){this.handlePluginError(e,"cleanup",t)}if(r.hooks)for(let e of r.hooks)this.hookManager.unregister(e.name,e.handler);if(r.fieldTypes)for(let e of r.fieldTypes)this.fieldTypes.delete(e.type),null==(t=this.fieldTypeRegistry)||t.unregister(e.type);if(r.validators)for(let e of r.validators)this.validators.delete(e.name);if(r.renderers)for(let e of r.renderers)this.renderers.delete(e.template);if(r.themes)for(let e of r.themes)this.themes.delete(e.name);this.plugins.delete(e),this.emit("plugin-unregistered",{plugin:e}),this.options.debug&&console.debug("[Formdown] Plugin unregistered: ".concat(e))}}get(e){return this.plugins.get(e)}getAll(){return Array.from(this.plugins.values())}isRegistered(e){return this.plugins.has(e)}async initialize(){if(this.initialized)return;this.emit("plugins-initializing",{count:this.plugins.size});let e=[];for(let t of this.plugins.values())t.initialize&&e.push(Promise.resolve(t.initialize()).catch(e=>this.handlePluginError(t.metadata.name,"initialization",e)));await Promise.all(e),this.initialized=!0,this.emit("plugins-initialized",{count:this.plugins.size}),this.options.debug&&console.debug("[Formdown] ".concat(this.plugins.size," plugins initialized"))}async destroy(){if(!this.initialized)return;this.emit("plugins-destroying",{count:this.plugins.size});let e=[];for(let t of this.plugins.values())t.destroy&&e.push(Promise.resolve(t.destroy()).catch(e=>this.handlePluginError(t.metadata.name,"cleanup",e)));await Promise.all(e),this.plugins.clear(),this.fieldTypes.clear(),this.validators.clear(),this.renderers.clear(),this.themes.clear(),this.initialized=!1,this.emit("plugins-destroyed",{count:0}),this.options.debug&&console.debug("[Formdown] All plugins destroyed and cleared")}getFieldTypes(){return new Map(this.fieldTypes)}getFieldType(e){return this.fieldTypes.get(e)}hasFieldType(e){return this.fieldTypes.has(e)}getValidators(){return new Map(this.validators)}getRenderers(){return new Map(this.renderers)}getThemes(){return new Map(this.themes)}async validateDependencies(e){if(e.metadata.dependencies){for(let t of e.metadata.dependencies)if(!this.isRegistered(t))throw Error("Plugin '".concat(e.metadata.name,"' requires dependency '").concat(t,"' which is not registered"))}}handlePluginError(e,t,r){let i="Plugin ".concat(t," failed: ").concat(e," - ").concat(r.message||r);switch(this.emit("plugin-error",{plugin:e,operation:t,error:i}),this.options.errorStrategy){case"ignore":break;case"warn":console.warn("[Formdown] ".concat(i));break;default:throw Error(i)}}emit(e,t){this.eventEmitter&&this.eventEmitter.emit(e,t)}constructor(e,t={},r,i){this.hookManager=e,this.options=t,this.eventEmitter=r,this.fieldTypeRegistry=i,this.plugins=new Map,this.fieldTypes=new Map,this.validators=new Map,this.renderers=new Map,this.themes=new Map,this.initialized=!1}}class U{on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){let r=this.listeners.get(e);r&&(r.delete(t),0===r.size&&this.listeners.delete(e))}emit(e,t){let r=this.listeners.get(e);if(!r)return;let i={type:e,data:t,timestamp:Date.now()};for(let t of r)try{t(i)}catch(t){console.error("[Formdown] Event listener error in '".concat(e,"':"),t)}}once(e,t){let r=e=>{t(e),this.off(e.type,r)};this.on(e,r)}removeAllListeners(e){e?this.listeners.delete(e):this.listeners.clear()}listenerCount(e){var t;return(null==(t=this.listeners.get(e))?void 0:t.size)||0}eventNames(){return Array.from(this.listeners.keys())}constructor(){this.listeners=new Map}}class V{register(e){if(this.fieldTypes.has(e.type))throw Error("Field type '".concat(e.type,"' is already registered"));this.fieldTypes.set(e.type,e),e.styles&&this.styleCache.set(e.type,e.styles),e.clientScript&&this.scriptCache.set(e.type,e.clientScript)}unregister(e){this.fieldTypes.delete(e),this.styleCache.delete(e),this.scriptCache.delete(e)}get(e){return this.fieldTypes.get(e)}has(e){return this.fieldTypes.has(e)}getAll(){return new Map(this.fieldTypes)}parseField(e,t){for(let r of this.fieldTypes.values())if(r.parser){let i=r.parser(e,t);if(i)return r.defaultAttributes&&(i.attributes={...r.defaultAttributes,...i.attributes}),i}return null}generateFieldHTML(e,t){let r=this.fieldTypes.get(e.type);return null!=r&&r.generator?r.generator(e,t):null}validateField(e,t){let r=this.fieldTypes.get(e.type);return null!=r&&r.validator?r.validator(e,t):[]}processFieldData(e,t,r){var i,n,s,a,o,l,c,h;let d=this.fieldTypes.get(e.type),u=null==d?void 0:d.dataProcessor;if(!u)return t;switch(r){case"input":return null!=(o=null==(i=u.processInput)?void 0:i.call(u,t,e))?o:t;case"output":return null!=(l=null==(n=u.processOutput)?void 0:n.call(u,t,e))?l:t;case"serialize":return null!=(c=null==(s=u.serialize)?void 0:s.call(u,t,e))?c:t;case"deserialize":return null!=(h=null==(a=u.deserialize)?void 0:a.call(u,t,e))?h:t;default:return t}}validateFieldData(e,t){let r=this.fieldTypes.get(e.type),i=null==r?void 0:r.dataProcessor;return null!=i&&i.validate?i.validate(t,e):{valid:!0}}generateFieldSchema(e){let t=this.fieldTypes.get(e.type);return null!=t&&t.schemaGenerator?t.schemaGenerator(e):null}getAllStyles(){return Array.from(this.styleCache.values()).join("\n")}getStylesForTypes(e){return e.map(e=>this.styleCache.get(e)).filter(Boolean).join("\n")}getAllScripts(){return Array.from(this.scriptCache.values()).join("\n")}getScriptsForTypes(e){return e.map(e=>this.scriptCache.get(e)).filter(Boolean).join("\n")}getStats(){return{registeredTypes:Array.from(this.fieldTypes.keys()),totalTypes:this.fieldTypes.size,typesWithStyles:Array.from(this.styleCache.keys()),typesWithScripts:Array.from(this.scriptCache.keys())}}clear(){this.fieldTypes.clear(),this.styleCache.clear(),this.scriptCache.clear()}constructor(){this.fieldTypes=new Map,this.styleCache=new Map,this.scriptCache=new Map}}let j={metadata:{name:"formdown-core",version:"1.0.0",description:"Built-in field types and validators for Formdown",author:"Formdown Team"},fieldTypes:[{type:"text",parser:e=>{let t=e.match(/@(\w+):\s*\[text\](.*)/);if(!t)return null;let[,r,i]=t,n=W(i);return{name:r,type:"text",label:n.label||r,required:n.required||!1,placeholder:n.placeholder,pattern:n.pattern,attributes:n}},validator:(e,t)=>{let r=[];return e.required&&(!t||""===t.trim())&&r.push({type:"required",message:"".concat(e.label," is required")}),e.pattern&&t&&!new RegExp(e.pattern).test(t)&&r.push({type:"pattern",value:e.pattern,message:"".concat(e.label," does not match the required pattern")}),r},generator:e=>"<input ".concat(['type="text"','name="'.concat(e.name,'"'),'id="'.concat(e.name,'"'),e.placeholder?'placeholder="'.concat(e.placeholder,'"'):"",e.required?"required":"",e.pattern?'pattern="'.concat(e.pattern,'"'):""].filter(Boolean).join(" ")," />")},{type:"email",parser:e=>{let t=e.match(/@(\w+):\s*\[email\](.*)/);if(!t)return null;let[,r,i]=t,n=W(i);return{name:r,type:"email",label:n.label||r,required:n.required||!1,placeholder:n.placeholder,attributes:n}},validator:(e,t)=>{let r=[];return e.required&&(!t||""===t.trim())&&r.push({type:"required",message:"".concat(e.label," is required")}),t&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)&&r.push({type:"pattern",message:"".concat(e.label," must be a valid email address")}),r},generator:e=>"<input ".concat(['type="email"','name="'.concat(e.name,'"'),'id="'.concat(e.name,'"'),e.placeholder?'placeholder="'.concat(e.placeholder,'"'):"",e.required?"required":""].filter(Boolean).join(" ")," />")},{type:"select",parser:e=>{let t=e.match(/@(\w+):\s*\[select\](.*)/);if(!t)return null;let[,r,i]=t,n=W(i),s=function(e){let t=e.match(/options=\[([^\]]*)\]/);return t?t[1].split(",").map(e=>e.trim().replace(/"/g,"")).filter(Boolean):[]}(i);return{name:r,type:"select",label:n.label||r,required:n.required||!1,options:s,allowOther:n.allowOther||!1,attributes:n}},generator:e=>{let t=['name="'.concat(e.name,'"'),'id="'.concat(e.name,'"'),e.required?"required":""].filter(Boolean).join(" "),r=(e.options||[]).map(e=>'<option value="'.concat(e,'">').concat(e,"</option>")).join("\n");return"<select ".concat(t,">\n").concat(r,"\n</select>")}},{type:"range",parser:(e,t)=>{for(let t of[/@(\w+)(?:\(([^)]+)\))?\s*:\s*\[range\](.*)/,/@(\w+)(?:\(([^)]+)\))?\s*:\s*\[range\s+([^\]]+)\](.*)/]){let r=e.match(t);if(r){let[,e,t,i="",n=""]=r,s=function(e){let t={},r=e.match(/min=(\d+)/);r&&(t.min=parseInt(r[1]));let i=e.match(/max=(\d+)/);i&&(t.max=parseInt(i[1]));let n=e.match(/step=(\d+\.?\d*)/);n&&(t.step=parseFloat(n[1]));let s=e.match(/value=(\d+\.?\d*)/);s&&(t.value=parseFloat(s[1]));let a=e.match(/unit="([^"]*)"/);a&&(t.unit=a[1]),e.includes("hideValue")&&(t.showValue=!1),e.includes("required")&&(t.required=!0);let o=e.match(/label="([^"]*)"/);return o&&(t.label=o[1]),t}((i||"")+(n||""));return{name:e,type:"range",label:t||s.label||e.split(/[_-]/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),required:s.required||!1,attributes:{min:s.min||0,max:s.max||100,step:s.step||1,value:s.value||Math.floor(((s.min||0)+(s.max||100))/2),showValue:!1!==s.showValue,unit:s.unit||"",...s}}}}return null},validator:(e,t)=>{var r,i,n;let s=[],a=Number(t);if(e.required&&(null==t||""===t)&&s.push({type:"required",message:"".concat(e.label," is required")}),null!=t&&""!==t)if(isNaN(a))s.push({type:"type",message:"".concat(e.label," must be a number")});else{let t=(null==(r=e.attributes)?void 0:r.min)||0,o=(null==(i=e.attributes)?void 0:i.max)||100;a<t&&s.push({type:"min",value:t,message:"".concat(e.label," must be at least ").concat(t)}),a>o&&s.push({type:"max",value:o,message:"".concat(e.label," must be at most ").concat(o)});let l=(null==(n=e.attributes)?void 0:n.step)||1;l>0&&(a-t)%l!=0&&s.push({type:"step",value:l,message:"".concat(e.label," must be a multiple of ").concat(l)})}return s},generator:(e,t)=>{var r;let{name:i,label:n,required:s,attributes:a={}}=e,{min:o=0,max:l=100,step:c=1,value:h=Math.floor((o+l)/2),showValue:d=!0,unit:u=""}=a,p="".concat(i,"-output"),m=null==(r=t.metadata)?void 0:r.formId,f=Object.entries({type:"range",id:i,name:i,min:o,max:l,step:c,value:h,...s&&{required:!0},...m&&{form:m},...Object.fromEntries(Object.entries(a).filter(e=>{let[t]=e;return!["min","max","step","value","showValue","unit","label"].includes(t)}))}).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" "),g=d?'<output id="'.concat(p,'" for="').concat(i,'" class="formdown-range-output">').concat(h).concat(u,"</output>"):"";return'\n<div class="formdown-field formdown-range-field">\n    <label for="'.concat(i,'">').concat(n).concat(s?" *":"",'</label>\n    <div class="formdown-range-container">\n        <input ').concat(f," oninput=\"document.getElementById('").concat(p,"').textContent = this.value + '").concat(u,"'\">\n        ").concat(g,"\n    </div>\n</div>")},dataProcessor:{processInput:(e,t)=>{let r=Number(e);return isNaN(r)?null:r},processOutput:(e,t)=>{var r;if(null==e)return"";let i=(null==(r=t.attributes)?void 0:r.unit)||"";return"".concat(e).concat(i)},validate:(e,t)=>{let r=Number(e);return null!=e&&""!==e&&isNaN(r)?{valid:!1,error:"Value must be a number"}:{valid:!0}},serialize:(e,t)=>String(e),deserialize:(e,t)=>{let r=Number(e);return isNaN(r)?null:r}},schemaGenerator:e=>{var t,r,i;let n={type:"number",minimum:(null==(t=e.attributes)?void 0:t.min)||0,maximum:(null==(r=e.attributes)?void 0:r.max)||100};return null!=(i=e.attributes)&&i.step&&(n.multipleOf=e.attributes.step),e.required&&(n.required=!0),e.label&&(n.title=e.label),n},styles:'\n        .formdown-range-field .formdown-range-container {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n        \n        .formdown-range-field input[type="range"] {\n            flex: 1;\n            min-width: 100px;\n        }\n        \n        .formdown-range-output {\n            min-width: 60px;\n            text-align: center;\n            font-weight: 600;\n            padding: 4px 8px;\n            background: #f5f5f5;\n            border-radius: 4px;\n            font-family: monospace;\n        }\n        \n        .formdown-range-field label {\n            display: block;\n            margin-bottom: 8px;\n            font-weight: 500;\n        }\n    ',clientScript:"\n        // Enhanced range field interactions\n        document.addEventListener('DOMContentLoaded', function() {\n            const rangeFields = document.querySelectorAll('.formdown-range-field input[type=\"range\"]');\n            \n            rangeFields.forEach(function(input) {\n                // Add keyboard navigation enhancement\n                input.addEventListener('keydown', function(e) {\n                    const step = parseFloat(this.step) || 1;\n                    const currentValue = parseFloat(this.value);\n                    \n                    if (e.key === 'ArrowLeft' || e.key === 'ArrowDown') {\n                        e.preventDefault();\n                        this.value = Math.max(parseFloat(this.min), currentValue - step);\n                        this.dispatchEvent(new Event('input', { bubbles: true }));\n                    } else if (e.key === 'ArrowRight' || e.key === 'ArrowUp') {\n                        e.preventDefault();\n                        this.value = Math.min(parseFloat(this.max), currentValue + step);\n                        this.dispatchEvent(new Event('input', { bubbles: true }));\n                    }\n                });\n                \n                // Add visual feedback on interaction\n                input.addEventListener('input', function() {\n                    this.classList.add('active');\n                    setTimeout(() => this.classList.remove('active'), 150);\n                });\n            });\n        });\n    ",defaultAttributes:{min:0,max:100,step:1,showValue:!0}}],validators:[{name:"required",validate:e=>null!=e&&""!==e,getMessage:(e,t)=>e.message||"".concat(t.label," is required")},{name:"pattern",validate:(e,t)=>!e||!t.value||new RegExp(t.value).test(e),getMessage:(e,t)=>e.message||"".concat(t.label," does not match the required pattern")},{name:"minlength",validate:(e,t)=>!e||e.length>=(t.value||0),getMessage:(e,t)=>e.message||"".concat(t.label," must be at least ").concat(e.value," characters long")}]};function W(e){let t={};e.includes("required")&&(t.required=!0);let r=e.match(/placeholder="([^"]*)"/);r&&(t.placeholder=r[1]);let i=e.match(/label="([^"]*)"/);i&&(t.label=i[1]);let n=e.match(/pattern="([^"]*)"/);return n&&(t.pattern=n[1]),e.includes("allowOther")&&(t.allowOther=!0),t}class G{async initialize(){if(!this.initialized){this.eventEmitter.emit("extension-system-initializing");try{await this.pluginManager.register(j),await this.pluginManager.initialize(),this.initialized=!0,this.eventEmitter.emit("extension-system-initialized"),this.context.options.debug&&console.debug("[Formdown] Extension system initialized")}catch(e){throw this.eventEmitter.emit("extension-system-error",{phase:"initialization",error:e instanceof Error?e.message:String(e)}),e}}}async destroy(){if(this.initialized){this.eventEmitter.emit("extension-system-destroying");try{await this.pluginManager.destroy(),this.hookManager.clear(),this.eventEmitter.removeAllListeners(),this.initialized=!1,this.eventEmitter.emit("extension-system-destroyed"),this.context.options.debug&&console.debug("[Formdown] Extension system destroyed")}catch(e){throw this.eventEmitter.emit("extension-system-error",{phase:"destruction",error:e instanceof Error?e.message:String(e)}),e}}}async registerPlugin(e){return this.ensureInitialized(),this.pluginManager.register(e)}async unregisterPlugin(e){return this.ensureInitialized(),this.pluginManager.unregister(e)}registerHook(e){this.ensureInitialized(),this.hookManager.register(e)}async executeHooks(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return this.ensureInitialized(),this.hookManager.execute(e,t,...i)}executeHooksSync(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return this.ensureInitialized(),this.hookManager.executeSync(e,t,...i)}getContext(){return{...this.context}}getFieldTypeRegistry(){return this.fieldTypeRegistry}getEventEmitter(){return this.eventEmitter}getStats(){return{initialized:this.initialized,plugins:this.pluginManager.getAll().map(e=>({name:e.metadata.name,version:e.metadata.version})),hookCount:this.hookManager.getHookCount(),registeredHooks:this.hookManager.getHookNames(),fieldTypes:Array.from(this.pluginManager.getFieldTypes().keys()),validators:Array.from(this.pluginManager.getValidators().keys()),renderers:Array.from(this.pluginManager.getRenderers().keys()),themes:Array.from(this.pluginManager.getThemes().keys())}}enableDebug(){this.context.options.debug=!0,console.debug("[Formdown] Debug mode enabled"),console.debug("[Formdown] Extension system stats:",this.getStats())}disableDebug(){this.context.options.debug=!1}setupErrorHandling(){this.eventEmitter.on("hook-error",e=>{this.context.options.debug&&console.error("[Formdown] Hook error:",e.data)}),this.eventEmitter.on("plugin-error",e=>{this.context.options.debug&&console.error("[Formdown] Plugin error:",e.data)}),this.eventEmitter.on("extension-system-error",e=>{console.error("[Formdown] Extension system error:",e.data)})}ensureInitialized(){if(!this.initialized)throw Error("Extension system must be initialized before use")}constructor(e={}){this.initialized=!1;let t={async:!0,timeout:1e3,errorStrategy:"warn",debug:!1,...e};this.eventEmitter=new U,this.hookManager=new H(t,this.eventEmitter),this.fieldTypeRegistry=new V,this.pluginManager=new N(this.hookManager,t,this.eventEmitter,this.fieldTypeRegistry),this.context={hooks:this.hookManager,plugins:this.pluginManager,fieldTypes:this.fieldTypeRegistry,options:t},this.setupErrorHandling()}}let Z=new G;async function Q(e){return Z.registerPlugin(e)}function K(e){return Z.registerHook(e)}class J{parseFormdown(e){this.formDeclarations=[],this.datalistDeclarations=[],this.currentFormId=null,this.formCounter=1,this.defaultFormCreated=!1;let{fields:t,cleanedMarkdown:r}=this.extractFields(e);return{markdown:this.options.preserveMarkdown?r:"",forms:t,formDeclarations:this.formDeclarations,datalistDeclarations:this.datalistDeclarations}}parse(e){let{fields:t}=this.extractFields(e);return{fields:t,errors:[]}}extractFields(e){let t=[],r=e.split("\n"),i=[];for(let e=0;e<r.length;e++){let n=r[e],s=this.parseFormDeclaration(n);if(s){this.formDeclarations.push(s),this.currentFormId=s.id,i.push("");continue}let a=this.parseDatalistDeclaration(n);if(a){this.datalistDeclarations.push(a),i.push("");continue}let o=this.parseBlockField(n);if(o){this.associateFieldWithForm(o),t.push(o),i.push("\x3c!--FORMDOWN_FIELD_".concat(t.length-1,"--\x3e"));continue}let{cleanedLine:l,inlineFields:c}=this.parseInlineFields(n);c.forEach(e=>this.associateFieldWithForm(e)),t.push(...c),i.push(l)}return{fields:t,cleanedMarkdown:i.join("\n")}}parseBlockField(e){let t=e.trim(),r=Z.getFieldTypeRegistry().parseField(t,{input:t});if(r)return r;let i=this.parseActionElement(t);if(i)return i;if(/^@\w+\*/.test(t)||/^@\w+\{[^}]*\}/.test(t)||/^@\w+\s*:\s*(dt|d|[#@%&t?TrscRFCMW$])\d*\[/.test(t)||/^@\w+\([^)]+\)\*/.test(t)||/^@\w+\([^)]+\)\{[^}]*\}/.test(t)||/^@\w+\([^)]+\)\s*:\s*(dt|d|[#@%&t?TrscRFCMW$])\d*\[/.test(t)){let e=this.parseShorthandBlockField(t);if(e)return e}let n=t.match(/^@(\w+)(?:\(([^)]+)\))?\s*:\s*\[((?:[^\]"']|"[^"]*"|'[^']*')*)\].*$/);if(!n)return null;let[,s,a,o]=n;return this.createField(s,a,o)}parseShorthandBlockField(e){let t=e.match(/^@(\w+)(\*)?(?:\{(.*?)\})?(?:\(([^)]+)\))?\s*:\s*(?:(dt|d|[#@%&t?TrscRFCMW$])(\d*)?)?\[([^\]]*)\].*$/);if(!t&&(t=e.match(/^@(\w+)(?:\(([^)]+)\))?(\*)?(?:\{(.*?)\})?\s*:\s*(?:(dt|d|[#@%&t?TrscRFCMW$])(\d*)?)?\[([^\]]*)\].*$/))){let[,e,r,i,n,s,a,o]=t;t=[t[0],e,i,n,r,s,a,o]}if(!t)return null;let[,r,i,n,s,a,o,l]=t;return i||void 0!==n||s||a||o?this.convertShorthandToField(r,i,n,s,a||"",o,l):null}parseInlineFields(e){let t=[],r=this.options.inlineFieldDelimiter,i=RegExp("(dt|d|[#@%&t?TrscRFCMW$]?)".concat(r,"@(\\w+)(\\*)?(?:\\{([^}]*)\\})?(?:\\(([^)]+)\\))?(?:\\[([^\\]]*)\\]|\\:\\s*([^\\s]*?)\\[([^\\]]*)\\])?"),"g"),n=e.replace(i,(e,r,i,n,s,a,o,l,c)=>{if(!r&&!n&&!s&&!o&&!l&&!c||!r&&o&&["text","email","password","number","tel","url","search","date","time","datetime-local","month","week","color","file","range","radio","checkbox","select","textarea","submit","reset","button","hidden"].includes(o.split(/\s/)[0]))return e;let h=o||c||"",d=this.convertShorthandToField(i,n,s,a,r||l||"","",h);if(d){d.inline=!0,t.push(d);let e=d.required?' data-required="true"':"";return'<span contenteditable="true" data-field-name="'.concat(i,'" data-field-type="').concat(d.type,'" data-placeholder="').concat(d.label||i,'" class="formdown-inline-field" role="textbox"').concat(e,">").concat(d.label||i,"</span>")}return e}),s=RegExp("".concat(r,"@(\\w+)(?:\\{([^}]*)\\})?(?:\\(([^)]+)\\))?(?:\\:\\s*([^\\s]*?)\\[([^\\]]*)\\]|\\[([^\\]]*)\\])?"),"g");return{cleanedLine:n=n.replace(s,(e,r,i,n,s,a,o)=>{if(t.some(e=>e.name===r))return e;let l="text";s&&void 0!==a?l=a.trim()?"".concat(s," ").concat(a):s:void 0!==o&&(l=o);let c=this.createField(r,n,l);if(c&&i){let e=i.split(",").map(e=>e.trim()).filter(e=>e.length>0);if(e.length>0)if(["select","radio","checkbox"].includes(c.type))c.options=e;else{let e="datalist-".concat(Math.floor(1e9*Math.random()));c.attributes=c.attributes||{},c.attributes.list=e}}if(c){c.inline=!0,t.push(c);let e=c.required?' data-required="true"':"";return'<span contenteditable="true" data-field-name="'.concat(r,'" data-field-type="').concat(c.type,'" data-placeholder="').concat(c.label||r,'" class="formdown-inline-field" role="textbox"').concat(e,">").concat(c.label||r,"</span>")}return e}),inlineFields:t}}convertShorthandToField(e,t,r,i,n,s,a){let o={"@":"email","#":"number","%":"tel","&":"url",d:"date",t:"time",dt:"datetime-local","?":"password",T:"textarea",r:"radio",s:"select",c:"checkbox",R:"range",F:"file",C:"color",M:"month",W:"week",$:"number"}[n]||"text",l=a?this.parseAttributes(a):{};if("*"===t&&(l.required=!0),"textarea"===o&&s&&(l.rows=parseInt(s,10)),"$"===n&&(l.inputmode="decimal",l.step="0.01",l.placeholder||(l.placeholder="0.00")),r){let e=this.interpretContent(r,n);l={...l,...e}}let c=this.buildTypeAndAttributesString(o,l);return this.createField(e,i,c)}interpretContent(e,t){if(["r","s","c"].includes(t)){let t=e.split(",").map(e=>e.trim()).filter(e=>e.length>0),r=!1,i="Other",n={options:t.filter(e=>"*"===e?(r=!0,!1):!(e.startsWith("*(")&&e.endsWith(")"))||(r||(r=!0,i=e.slice(2,-1)),!1)).join(",")||""};return r&&(n["allow-other"]=!0,"Other"!==i&&(n["other-label"]=i)),n}if(["d","t","dt"].includes(t))return{format:e};let r=e.includes(","),i=e.match(/^\^.*\$$/)||e.includes("[")&&e.includes("]")&&!r||e.includes("\\"),n=e.includes("#")||!r&&e.includes("*");if(i||n){let t=e;return(e.includes("#")||e.includes("*")&&!e.match(/^\^.*\$$/))&&(t="^"+e.replace(/[().\/]/g,"\\$&").replace(/-/g,"\\-").replace(/#{1,}/g,e=>"\\d{".concat(e.length,"}")).replace(/\*/g,".*").replace(/\?/g,".")+"$"),{pattern:t}}if(e&&!["r","s","c","d","t","dt"].includes(t)&&(r||!i&&e.length>0)){let t=e.split(",").map(e=>e.trim()).filter(e=>e.length>0);if(t.length>0){let r=this.generateDatalistId(e);return this.datalistDeclarations.find(e=>e.id===r)||this.datalistDeclarations.push({id:r,options:t}),{list:r}}}return{pattern:e}}parseAttributes(e){let t={};for(let r of Array.from(e.matchAll(/([\w-]+)(?:=(?:"((?:[^"\\]|\\.)*)"|'((?:[^'\\]|\\.)*)'|([^\s]+)))?/g))){let[,e,i,n,s]=r;if("required"===e)t.required=!0;else if(void 0!==i||void 0!==n||void 0!==s){let r=void 0!==i?i:void 0!==n?n:s;t[e]=this.parseAttributeValue(r)}else t[e]=!0}return t}buildTypeAndAttributesString(e,t){let r=[e];for(let[e,i]of Object.entries(t))!0===i?r.push(e):"string"==typeof i?r.push("".concat(e,'="').concat(i,'"')):r.push("".concat(e,"=").concat(i));return r.join(" ")}createField(e,t,r){if(/^\d/.test(e)||!e.trim())return null;if(!r.trim())return{name:e,type:"text",label:t||this.formatLabel(e),attributes:{}};let i=Array.from(r.matchAll(/([\w-]+)(?:=(?:"([^"]*)"|'([^']*)'|([^\s]+)))?/g));if(0===i.length)return null;let n="text",s=-1;for(let e=0;e<i.length;e++){let[,t,r,a,o]=i[e];if(!r&&!a&&!o){let r={s:"select",r:"radio",c:"checkbox",T:"textarea","@":"email","#":"number","%":"tel",$:"number","?":"password",t:"time",d:"date",dt:"datetime-local"}[t]||t;if(["text","email","password","number","tel","url","search","date","time","datetime-local","month","week","color","file","range","radio","checkbox","select","textarea","submit","reset","button","hidden"].includes(r)){n=r,s=e;break}}}let a={name:e,type:n,label:t||this.formatLabel(e),attributes:{}};for(let e=0;e<i.length;e++){if(e===s)continue;let[,t,r,o,l]=i[e];if("required"===t)a.required=!0;else if("label"===t&&(void 0!==r||void 0!==o||void 0!==l))a.label=r||o||l;else if("placeholder"===t&&(void 0!==r||void 0!==o||void 0!==l))a.placeholder=r||o||l;else if("options"===t&&(void 0!==r||void 0!==o||void 0!==l)){let e=r||o||l;if(["radio","checkbox","select"].includes(n))if(e){let t=e.split(",").map(e=>e.trim()).filter(e=>e.length>0),r=!1,i="Other";a.options=t.filter(e=>"*"===e?(r=!0,!1):!(e.startsWith("*(")&&e.endsWith(")"))||(r||(r=!0,i=e.slice(2,-1)),!1)),r&&(a.allowOther=!0,"Other"!==i&&(a.otherLabel=i))}else a.options=[]}else if("allow-other"===t)a.allowOther=!0;else if("other-label"===t&&(void 0!==r||void 0!==o||void 0!==l))a.otherLabel=r||o||l;else if("format"===t&&(void 0!==r||void 0!==o||void 0!==l))a.format=r||o||l;else if("pattern"===t&&(void 0!==r||void 0!==o||void 0!==l))a.pattern=r||o||l;else if("content"===t&&(void 0!==r||void 0!==o||void 0!==l))a.content=r||o||l;else if("value"===t)void 0!==r||void 0!==o?a.value=void 0!==r?r:o:void 0!==l?a.value=this.parseAttributeValue(l):a.value="";else if("datalist"===t&&(void 0!==r||void 0!==o||void 0!==l))a.attributes.list=r||o||l;else if(void 0!==r||void 0!==o||void 0!==l){let e=r||o||l;a.attributes[t]=this.parseAttributeValue(e)}else a.attributes[t]=!0}return a}formatLabel(e){return e.includes("_")?e.split("_").map(e=>this.capitalizeWord(e)).join(" "):/[a-z][A-Z]/.test(e)?e.replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(e=>this.capitalizeWord(e)).join(" "):this.capitalizeWord(e)}capitalizeWord(e){return e&&e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}parseActionElement(e){let t=e.match(/^@\[(\w+)\s+"([^"]+)"([^\]]*)\]$/);if(!t)return null;let[,r,i,n]=t;if(!["submit","reset","button","image"].includes(r))return null;let s="".concat(r,"_").concat(Math.random().toString(36).substr(2,9)),a={};n.trim()&&Object.assign(a,this.parseAttributes(n.trim()));let o={name:s,type:"image"===r?"image":"button",label:i,attributes:{type:r,...a}};return"image"!==r||a.src||console.warn("Image action element missing src attribute: ".concat(e)),o}parseAttributeValue(e){if(""===e)return"";let t=e.replace(/\\(.)/g,"$1");return/^-?\d+$/.test(t)?parseInt(t,10):/^-?\d*\.\d+$/.test(t)?parseFloat(t):"true"===t||"false"!==t&&t}parseFormDeclaration(e){let t=e.trim().match(/^@form\[([^\]]*)\]\s*$/);if(!t)return null;let r=t[1],i=this.parseAttributes(r),n=i.id||this.generateFormId();return i.id&&delete i.id,{id:n,attributes:i}}generateFormId(){return"formdown-form-".concat(this.formCounter++)}generateDatalistId(e){let t=e.toLowerCase().replace(/\s+/g,"").replace(/,/g,"-").split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0);return"datalist-".concat(Math.abs(t))}parseDatalistDeclaration(e){let t=e.trim().match(/^@datalist\[([^\]]*)\]\s*$/);if(!t)return null;let r=t[1],i=this.parseAttributes(r);if(!i.id)return console.warn("Datalist declaration missing required id attribute:",e),null;if(void 0===i.options)return console.warn("Datalist declaration missing required options attribute:",e),null;let n="string"==typeof i.options?i.options.split(",").map(e=>e.trim()).filter(e=>e.length>0):[];return 0===n.length?(console.warn("Datalist declaration has empty options:",e),null):{id:i.id,options:n}}getDefaultFormId(){return this.defaultFormCreated||(this.defaultFormCreated=!0,this.formDeclarations.push({id:"formdown-form-default",attributes:{action:".",method:"GET"}})),"formdown-form-default"}associateFieldWithForm(e){var t;if(null!=(t=e.attributes)&&t.form){this.formDeclarations.some(t=>t.id===e.attributes.form)||(console.warn('FormDown: Referenced form "'.concat(e.attributes.form,'" does not exist. Using current or default form.')),e.attributes.form=this.currentFormId||this.getDefaultFormId());return}this.currentFormId?(e.attributes||(e.attributes={}),e.attributes.form=this.currentFormId):(e.attributes||(e.attributes={}),e.attributes.form=this.getDefaultFormId())}constructor(e={}){this.formDeclarations=[],this.datalistDeclarations=[],this.currentFormId=null,this.formCounter=1,this.defaultFormCreated=!1,this.options={preserveMarkdown:!0,fieldPrefix:"@",inlineFieldDelimiter:"___",autoGenerateFormIds:!0,...e}}}function Y(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var X=Y(),ee={exec:()=>null};function et(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r="string"==typeof e?e:e.source,i={replace:(e,t)=>{let n="string"==typeof t?t:t.source;return n=n.replace(er.caret,"$1"),r=r.replace(e,n),i},getRegex:()=>new RegExp(r,t)};return i}var er={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:RegExp("[\\p{L}\\p{N}]","u"),escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp("^( {0,3}".concat(e,")((?:[	 ][^\\n]*)?(?:\\n|$))")),nextBulletRegex:e=>new RegExp("^ {0,".concat(Math.min(3,e-1),"}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))")),hrRegex:e=>new RegExp("^ {0,".concat(Math.min(3,e-1),"}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)")),fencesBeginRegex:e=>new RegExp("^ {0,".concat(Math.min(3,e-1),"}(?:```|~~~)")),headingBeginRegex:e=>new RegExp("^ {0,".concat(Math.min(3,e-1),"}#")),htmlBeginRegex:e=>RegExp("^ {0,".concat(Math.min(3,e-1),"}<(?:[a-z].*>|!--)"),"i")},ei=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,en=/(?:[*+-]|\d{1,9}[.)])/,es=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,ea=et(es).replace(/bull/g,en).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),eo=et(es).replace(/bull/g,en).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),el=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,ec=/(?!\s*\])(?:\\.|[^\[\]\\])+/,eh=et(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",ec).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),ed=et(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,en).getRegex(),eu="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",ep=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,em=et("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",ep).replace("tag",eu).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),ef=et(el).replace("hr",ei).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",eu).getRegex(),eg={blockquote:et(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",ef).getRegex(),code:/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,def:eh,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:ei,html:em,lheading:ea,list:ed,newline:/^(?:[ \t]*(?:\n|$))+/,paragraph:ef,table:ee,text:/^[^\n]+/},eb=et("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",ei).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",eu).getRegex(),ev={...eg,lheading:eo,table:eb,paragraph:et(el).replace("hr",ei).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",eb).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",eu).getRegex()},ey={...eg,html:et("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",ep).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ee,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:et(el).replace("hr",ei).replace("heading"," *#{1,6} *[^\n]").replace("lheading",ea).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},ew=/^( {2,}|\\)\n(?!\s*$)/,ek=RegExp("[\\p{P}\\p{S}]","u"),ex=RegExp("[\\s\\p{P}\\p{S}]","u"),eE=RegExp("[^\\s\\p{P}\\p{S}]","u"),e_=et(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,ex).getRegex(),eA=RegExp("(?!~)[\\p{P}\\p{S}]","u"),eS=RegExp("(?!~)[\\s\\p{P}\\p{S}]","u"),e$=RegExp("(?:[^\\s\\p{P}\\p{S}]|~)","u"),eC=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,eT=et(eC,"u").replace(/punct/g,ek).getRegex(),eR=et(eC,"u").replace(/punct/g,eA).getRegex(),eF="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",eP=et(eF,"gu").replace(/notPunctSpace/g,eE).replace(/punctSpace/g,ex).replace(/punct/g,ek).getRegex(),eM=et(eF,"gu").replace(/notPunctSpace/g,e$).replace(/punctSpace/g,eS).replace(/punct/g,eA).getRegex(),eI=et("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,eE).replace(/punctSpace/g,ex).replace(/punct/g,ek).getRegex(),eO=et(/\\(punct)/,"gu").replace(/punct/g,ek).getRegex(),eL=et(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),eD=et(ep).replace("(?:--\x3e|$)","--\x3e").getRegex(),ez=et("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",eD).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),eq=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,eB=et(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",eq).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),eH=et(/^!?\[(label)\]\[(ref)\]/).replace("label",eq).replace("ref",ec).getRegex(),eN=et(/^!?\[(ref)\](?:\[\])?/).replace("ref",ec).getRegex(),eU=et("reflink|nolink(?!\\()","g").replace("reflink",eH).replace("nolink",eN).getRegex(),eV={_backpedal:ee,anyPunctuation:eO,autolink:eL,blockSkip:/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,br:ew,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:ee,emStrongLDelim:eT,emStrongRDelimAst:eP,emStrongRDelimUnd:eI,escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,link:eB,nolink:eN,punctuation:e_,reflink:eH,reflinkSearch:eU,tag:ez,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:ee},ej={...eV,link:et(/^!?\[(label)\]\((.*?)\)/).replace("label",eq).getRegex(),reflink:et(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",eq).getRegex()},eW={...eV,emStrongRDelimAst:eM,emStrongLDelim:eR,url:et(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},eG={...eW,br:et(ew).replace("{2,}","*").getRegex(),text:et(eW.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},eZ={normal:eg,gfm:ev,pedantic:ey},eQ={normal:eV,gfm:eW,breaks:eG,pedantic:ej},eK={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},eJ=e=>eK[e];function eY(e,t){if(t){if(er.escapeTest.test(e))return e.replace(er.escapeReplace,eJ)}else if(er.escapeTestNoEncode.test(e))return e.replace(er.escapeReplaceNoEncode,eJ);return e}function eX(e){try{e=encodeURI(e).replace(er.percentDecode,"%")}catch(e){return null}return e}function e0(e,t){var r;let i=e.replace(er.findPipe,(e,t,r)=>{let i=!1,n=t;for(;--n>=0&&"\\"===r[n];)i=!i;return i?"|":" |"}).split(er.splitPipe),n=0;if(i[0].trim()||i.shift(),i.length>0&&!(null!=(r=i.at(-1))&&r.trim())&&i.pop(),t)if(i.length>t)i.splice(t);else for(;i.length<t;)i.push("");for(;n<i.length;n++)i[n]=i[n].trim().replace(er.slashPipe,"|");return i}function e1(e,t,r){let i=e.length;if(0===i)return"";let n=0;for(;n<i&&e.charAt(i-n-1)===t;)n++;return e.slice(0,i-n)}function e2(e,t,r,i,n){let s=t.href,a=t.title||null,o=e[1].replace(n.other.outputLinkReplace,"$1");i.state.inLink=!0;let l={type:"!"===e[0].charAt(0)?"image":"link",raw:r,href:s,title:a,text:o,tokens:i.inlineTokens(o)};return i.state.inLink=!1,l}var e3,e5,e9=class{space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let e=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:e1(e,"\n")}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let e=t[0],r=function(e,t,r){let i=e.match(r.other.indentCodeCompensation);if(null===i)return t;let n=i[1];return t.split("\n").map(e=>{let t=e.match(r.other.beginningSpace);if(null===t)return e;let[i]=t;return i.length>=n.length?e.slice(n.length):e}).join("\n")}(e,t[3]||"",this.rules);return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:r}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(this.rules.other.endingHash.test(e)){let t=e1(e,"#");(this.options.pedantic||!t||this.rules.other.endingSpaceChar.test(t))&&(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:e1(t[0],"\n")}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let e=e1(t[0],"\n").split("\n"),r="",i="",n=[];for(;e.length>0;){let t,s=!1,a=[];for(t=0;t<e.length;t++)if(this.rules.other.blockquoteStart.test(e[t]))a.push(e[t]),s=!0;else if(s)break;else a.push(e[t]);e=e.slice(t);let o=a.join("\n"),l=o.replace(this.rules.other.blockquoteSetextReplace,"\n    $1").replace(this.rules.other.blockquoteSetextReplace2,"");r=r?"".concat(r,"\n").concat(o):o,i=i?"".concat(i,"\n").concat(l):l;let c=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(l,n,!0),this.lexer.state.top=c,0===e.length)break;let h=n.at(-1);if((null==h?void 0:h.type)==="code")break;if((null==h?void 0:h.type)==="blockquote"){let t=h.raw+"\n"+e.join("\n"),s=this.blockquote(t);n[n.length-1]=s,r=r.substring(0,r.length-h.raw.length)+s.raw,i=i.substring(0,i.length-h.text.length)+s.text;break}if((null==h?void 0:h.type)==="list"){let t=h.raw+"\n"+e.join("\n"),s=this.list(t);n[n.length-1]=s,r=r.substring(0,r.length-h.raw.length)+s.raw,i=i.substring(0,i.length-h.raw.length)+s.raw,e=t.substring(n.at(-1).raw.length).split("\n");continue}}return{type:"blockquote",raw:r,tokens:n,text:i}}}list(e){let t=this.rules.block.list.exec(e);if(t){let r=t[1].trim(),i=r.length>1,n={type:"list",raw:"",ordered:i,start:i?+r.slice(0,-1):"",loose:!1,items:[]};r=i?"\\d{1,9}\\".concat(r.slice(-1)):"\\".concat(r),this.options.pedantic&&(r=i?r:"[*+-]");let s=this.rules.other.listItemRegex(r),a=!1;for(;e;){let r=!1,i="",o="";if(!(t=s.exec(e))||this.rules.block.hr.test(e))break;i=t[0],e=e.substring(i.length);let l=t[2].split("\n",1)[0].replace(this.rules.other.listReplaceTabs,e=>" ".repeat(3*e.length)),c=e.split("\n",1)[0],h=!l.trim(),d=0;if(this.options.pedantic?(d=2,o=l.trimStart()):h?d=t[1].length+1:(d=(d=t[2].search(this.rules.other.nonSpaceChar))>4?1:d,o=l.slice(d),d+=t[1].length),h&&this.rules.other.blankLine.test(c)&&(i+=c+"\n",e=e.substring(c.length+1),r=!0),!r){let t=this.rules.other.nextBulletRegex(d),r=this.rules.other.hrRegex(d),n=this.rules.other.fencesBeginRegex(d),s=this.rules.other.headingBeginRegex(d),a=this.rules.other.htmlBeginRegex(d);for(;e;){let u,p=e.split("\n",1)[0];if(c=p,u=this.options.pedantic?c=c.replace(this.rules.other.listReplaceNesting,"  "):c.replace(this.rules.other.tabCharGlobal,"    "),n.test(c)||s.test(c)||a.test(c)||t.test(c)||r.test(c))break;if(u.search(this.rules.other.nonSpaceChar)>=d||!c.trim())o+="\n"+u.slice(d);else{if(h||l.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||n.test(l)||s.test(l)||r.test(l))break;o+="\n"+c}h||c.trim()||(h=!0),i+=p+"\n",e=e.substring(p.length+1),l=u.slice(d)}}n.loose||(a?n.loose=!0:this.rules.other.doubleBlankLine.test(i)&&(a=!0));let u=null,p;this.options.gfm&&(u=this.rules.other.listIsTask.exec(o))&&(p="[ ] "!==u[0],o=o.replace(this.rules.other.listReplaceTask,"")),n.items.push({type:"list_item",raw:i,task:!!u,checked:p,loose:!1,text:o,tokens:[]}),n.raw+=i}let o=n.items.at(-1);if(!o)return;o.raw=o.raw.trimEnd(),o.text=o.text.trimEnd(),n.raw=n.raw.trimEnd();for(let e=0;e<n.items.length;e++)if(this.lexer.state.top=!1,n.items[e].tokens=this.lexer.blockTokens(n.items[e].text,[]),!n.loose){let t=n.items[e].tokens.filter(e=>"space"===e.type);n.loose=t.length>0&&t.some(e=>this.rules.other.anyLine.test(e.raw))}if(n.loose)for(let e=0;e<n.items.length;e++)n.items[e].loose=!0;return n}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:"pre"===t[1]||"script"===t[1]||"style"===t[1],text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let e=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:r,title:i}}}table(e){var t;let r=this.rules.block.table.exec(e);if(!r||!this.rules.other.tableDelimiter.test(r[2]))return;let i=e0(r[1]),n=r[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=null!=(t=r[3])&&t.trim()?r[3].replace(this.rules.other.tableRowBlankLine,"").split("\n"):[],a={type:"table",raw:r[0],header:[],align:[],rows:[]};if(i.length===n.length){for(let e of n)this.rules.other.tableAlignRight.test(e)?a.align.push("right"):this.rules.other.tableAlignCenter.test(e)?a.align.push("center"):this.rules.other.tableAlignLeft.test(e)?a.align.push("left"):a.align.push(null);for(let e=0;e<i.length;e++)a.header.push({text:i[e],tokens:this.lexer.inline(i[e]),header:!0,align:a.align[e]});for(let e of s)a.rows.push(e0(e,a.header.length).map((e,t)=>({text:e,tokens:this.lexer.inline(e),header:!1,align:a.align[t]})));return a}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let e="\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let e=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(e)){if(!this.rules.other.endAngleBracket.test(e))return;let t=e1(e.slice(0,-1),"\\");if((e.length-t.length)%2==0)return}else{let e=function(e,t){if(-1===e.indexOf(")"))return -1;let r=0;for(let i=0;i<e.length;i++)if("\\"===e[i])i++;else if("("===e[i])r++;else if(e[i]===t[1]&&--r<0)return i;return r>0?-2:-1}(t[2],"()");if(-2===e)return;if(e>-1){let r=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,r).trim(),t[3]=""}}let r=t[2],i="";if(this.options.pedantic){let e=this.rules.other.pedanticHrefTitle.exec(r);e&&(r=e[1],i=e[3])}else i=t[3]?t[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(r=this.options.pedantic&&!this.rules.other.endAngleBracket.test(e)?r.slice(1):r.slice(1,-1)),e2(t,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let e=t[(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!e){let e=r[0].charAt(0);return{type:"text",raw:e,text:e}}return e2(r,e,r[0],this.lexer,this.rules)}}emStrong(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=this.rules.inline.emStrongLDelim.exec(e);if(!(!i||i[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(i[1]||i[2])||!r||this.rules.inline.punctuation.exec(r))){let r=[...i[0]].length-1,n,s,a=r,o=0,l="*"===i[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,t=t.slice(-1*e.length+r);null!=(i=l.exec(t));){if(!(n=i[1]||i[2]||i[3]||i[4]||i[5]||i[6]))continue;if(s=[...n].length,i[3]||i[4]){a+=s;continue}if((i[5]||i[6])&&r%3&&!((r+s)%3)){o+=s;continue}if((a-=s)>0)continue;s=Math.min(s,s+a+o);let t=[...i[0]][0].length,l=e.slice(0,r+i.index+t+s);if(Math.min(r,s)%2){let e=l.slice(1,-1);return{type:"em",raw:l,text:e,tokens:this.lexer.inlineTokens(e)}}let c=l.slice(2,-2);return{type:"strong",raw:l,text:c,tokens:this.lexer.inlineTokens(c)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(e),i=this.rules.other.startingSpaceChar.test(e)&&this.rules.other.endingSpaceChar.test(e);return r&&i&&(e=e.substring(1,e.length-1)),{type:"codespan",raw:t[0],text:e}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let e,r;return r="@"===t[2]?"mailto:"+(e=t[1]):e=t[1],{type:"link",raw:t[0],text:e,href:r,tokens:[{type:"text",raw:e,text:e}]}}}url(e){var t,r;let i;if(i=this.rules.inline.url.exec(e)){let e,n;if("@"===i[2])n="mailto:"+(e=i[0]);else{let s;do s=i[0],i[0]=null!=(r=null==(t=this.rules.inline._backpedal.exec(i[0]))?void 0:t[0])?r:"";while(s!==i[0]);e=i[0],n="www."===i[1]?"http://"+i[0]:i[0]}return{type:"link",raw:i[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let e=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:e}}}constructor(e){g(this,"options"),g(this,"rules"),g(this,"lexer"),this.options=e||X}},e6=class e{static get rules(){return{block:eZ,inline:eQ}}static lex(t,r){return new e(r).lex(t)}static lexInline(t,r){return new e(r).inlineTokens(t)}lex(e){e=e.replace(er.carriageReturn,"\n"),this.blockTokens(e,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){let t=this.inlineQueue[e];this.inlineTokens(t.src,t.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e){var t,r,i;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(this.options.pedantic&&(e=e.replace(er.tabCharGlobal,"    ").replace(er.spaceLine,""));e;){let a;if(null!=(r=null==(t=this.options.extensions)?void 0:t.block)&&r.some(t=>!!(a=t.call({lexer:this},e,n))&&(e=e.substring(a.raw.length),n.push(a),!0)))continue;if(a=this.tokenizer.space(e)){e=e.substring(a.raw.length);let t=n.at(-1);1===a.raw.length&&void 0!==t?t.raw+="\n":n.push(a);continue}if(a=this.tokenizer.code(e)){e=e.substring(a.raw.length);let t=n.at(-1);(null==t?void 0:t.type)==="paragraph"||(null==t?void 0:t.type)==="text"?(t.raw+="\n"+a.raw,t.text+="\n"+a.text,this.inlineQueue.at(-1).src=t.text):n.push(a);continue}if((a=this.tokenizer.fences(e))||(a=this.tokenizer.heading(e))||(a=this.tokenizer.hr(e))||(a=this.tokenizer.blockquote(e))||(a=this.tokenizer.list(e))||(a=this.tokenizer.html(e))){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.def(e)){e=e.substring(a.raw.length);let t=n.at(-1);(null==t?void 0:t.type)==="paragraph"||(null==t?void 0:t.type)==="text"?(t.raw+="\n"+a.raw,t.text+="\n"+a.raw,this.inlineQueue.at(-1).src=t.text):this.tokens.links[a.tag]||(this.tokens.links[a.tag]={href:a.href,title:a.title});continue}if((a=this.tokenizer.table(e))||(a=this.tokenizer.lheading(e))){e=e.substring(a.raw.length),n.push(a);continue}let o=e;if(null!=(i=this.options.extensions)&&i.startBlock){let t,r=1/0,i=e.slice(1);this.options.extensions.startBlock.forEach(e=>{"number"==typeof(t=e.call({lexer:this},i))&&t>=0&&(r=Math.min(r,t))}),r<1/0&&r>=0&&(o=e.substring(0,r+1))}if(this.state.top&&(a=this.tokenizer.paragraph(o))){let t=n.at(-1);s&&(null==t?void 0:t.type)==="paragraph"?(t.raw+="\n"+a.raw,t.text+="\n"+a.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=t.text):n.push(a),s=o.length!==e.length,e=e.substring(a.raw.length);continue}if(a=this.tokenizer.text(e)){e=e.substring(a.raw.length);let t=n.at(-1);(null==t?void 0:t.type)==="text"?(t.raw+="\n"+a.raw,t.text+="\n"+a.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=t.text):n.push(a);continue}if(e){let t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw Error(t)}}return this.state.top=!0,n}inline(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e){var t,r,i;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=e,a=null;if(this.tokens.links){let e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(a=this.tokenizer.rules.inline.reflinkSearch.exec(s));)e.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(s=s.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(a=this.tokenizer.rules.inline.anyPunctuation.exec(s));)s=s.slice(0,a.index)+"++"+s.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;null!=(a=this.tokenizer.rules.inline.blockSkip.exec(s));)s=s.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+s.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let o=!1,l="";for(;e;){let a;if(o||(l=""),o=!1,null!=(r=null==(t=this.options.extensions)?void 0:t.inline)&&r.some(t=>!!(a=t.call({lexer:this},e,n))&&(e=e.substring(a.raw.length),n.push(a),!0)))continue;if((a=this.tokenizer.escape(e))||(a=this.tokenizer.tag(e))||(a=this.tokenizer.link(e))){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(a.raw.length);let t=n.at(-1);"text"===a.type&&(null==t?void 0:t.type)==="text"?(t.raw+=a.raw,t.text+=a.text):n.push(a);continue}if((a=this.tokenizer.emStrong(e,s,l))||(a=this.tokenizer.codespan(e))||(a=this.tokenizer.br(e))||(a=this.tokenizer.del(e))||(a=this.tokenizer.autolink(e))||!this.state.inLink&&(a=this.tokenizer.url(e))){e=e.substring(a.raw.length),n.push(a);continue}let c=e;if(null!=(i=this.options.extensions)&&i.startInline){let t,r=1/0,i=e.slice(1);this.options.extensions.startInline.forEach(e=>{"number"==typeof(t=e.call({lexer:this},i))&&t>=0&&(r=Math.min(r,t))}),r<1/0&&r>=0&&(c=e.substring(0,r+1))}if(a=this.tokenizer.inlineText(c)){e=e.substring(a.raw.length),"_"!==a.raw.slice(-1)&&(l=a.raw.slice(-1)),o=!0;let t=n.at(-1);(null==t?void 0:t.type)==="text"?(t.raw+=a.raw,t.text+=a.text):n.push(a);continue}if(e){let t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw Error(t)}}return n}constructor(e){g(this,"tokens"),g(this,"options"),g(this,"state"),g(this,"tokenizer"),g(this,"inlineQueue"),this.tokens=[],this.tokens.links=Object.create(null),this.options=e||X,this.options.tokenizer=this.options.tokenizer||new e9,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:er,block:eZ.normal,inline:eQ.normal};this.options.pedantic?(t.block=eZ.pedantic,t.inline=eQ.pedantic):this.options.gfm&&(t.block=eZ.gfm,this.options.breaks?t.inline=eQ.breaks:t.inline=eQ.gfm),this.tokenizer.rules=t}},e4=class{space(e){return""}code(e){var t;let{text:r,lang:i,escaped:n}=e,s=null==(t=(i||"").match(er.notSpaceStart))?void 0:t[0],a=r.replace(er.endingNewline,"")+"\n";return s?'<pre><code class="language-'+eY(s)+'">'+(n?a:eY(a,!0))+"</code></pre>\n":"<pre><code>"+(n?a:eY(a,!0))+"</code></pre>\n"}blockquote(e){let{tokens:t}=e;return"<blockquote>\n".concat(this.parser.parse(t),"</blockquote>\n")}html(e){let{text:t}=e;return t}heading(e){let{tokens:t,depth:r}=e;return"<h".concat(r,">").concat(this.parser.parseInline(t),"</h").concat(r,">\n")}hr(e){return"<hr>\n"}list(e){let t=e.ordered,r=e.start,i="";for(let t=0;t<e.items.length;t++){let r=e.items[t];i+=this.listitem(r)}let n=t?"ol":"ul";return"<"+n+(t&&1!==r?' start="'+r+'"':"")+">\n"+i+"</"+n+">\n"}listitem(e){var t;let r="";if(e.task){let i=this.checkbox({checked:!!e.checked});e.loose?(null==(t=e.tokens[0])?void 0:t.type)==="paragraph"?(e.tokens[0].text=i+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&"text"===e.tokens[0].tokens[0].type&&(e.tokens[0].tokens[0].text=i+" "+eY(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:i+" ",text:i+" ",escaped:!0}):r+=i+" "}return r+=this.parser.parse(e.tokens,!!e.loose),"<li>".concat(r,"</li>\n")}checkbox(e){let{checked:t}=e;return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(e){let{tokens:t}=e;return"<p>".concat(this.parser.parseInline(t),"</p>\n")}table(e){let t="",r="";for(let t=0;t<e.header.length;t++)r+=this.tablecell(e.header[t]);t+=this.tablerow({text:r});let i="";for(let t=0;t<e.rows.length;t++){let n=e.rows[t];r="";for(let e=0;e<n.length;e++)r+=this.tablecell(n[e]);i+=this.tablerow({text:r})}return i&&(i="<tbody>".concat(i,"</tbody>")),"<table>\n<thead>\n"+t+"</thead>\n"+i+"</table>\n"}tablerow(e){let{text:t}=e;return"<tr>\n".concat(t,"</tr>\n")}tablecell(e){let t=this.parser.parseInline(e.tokens),r=e.header?"th":"td";return(e.align?"<".concat(r,' align="').concat(e.align,'">'):"<".concat(r,">"))+t+"</".concat(r,">\n")}strong(e){let{tokens:t}=e;return"<strong>".concat(this.parser.parseInline(t),"</strong>")}em(e){let{tokens:t}=e;return"<em>".concat(this.parser.parseInline(t),"</em>")}codespan(e){let{text:t}=e;return"<code>".concat(eY(t,!0),"</code>")}br(e){return"<br>"}del(e){let{tokens:t}=e;return"<del>".concat(this.parser.parseInline(t),"</del>")}link(e){let{href:t,title:r,tokens:i}=e,n=this.parser.parseInline(i),s=eX(t);if(null===s)return n;let a='<a href="'+(t=s)+'"';return r&&(a+=' title="'+eY(r)+'"'),a+=">"+n+"</a>"}image(e){let{href:t,title:r,text:i,tokens:n}=e;n&&(i=this.parser.parseInline(n,this.parser.textRenderer));let s=eX(t);if(null===s)return eY(i);t=s;let a='<img src="'.concat(t,'" alt="').concat(i,'"');return r&&(a+=' title="'.concat(eY(r),'"')),a+=">"}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:eY(e.text)}constructor(e){g(this,"options"),g(this,"parser"),this.options=e||X}},e8=class{strong(e){let{text:t}=e;return t}em(e){let{text:t}=e;return t}codespan(e){let{text:t}=e;return t}del(e){let{text:t}=e;return t}html(e){let{text:t}=e;return t}text(e){let{text:t}=e;return t}link(e){let{text:t}=e;return""+t}image(e){let{text:t}=e;return""+t}br(){return""}},e7=class e{static parse(t,r){return new e(r).parse(t)}static parseInline(t,r){return new e(r).parseInline(t)}parse(e){var t,r;let i=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n="";for(let s=0;s<e.length;s++){let a=e[s];if(null!=(r=null==(t=this.options.extensions)?void 0:t.renderers)&&r[a.type]){let e=this.options.extensions.renderers[a.type].call({parser:this},a);if(!1!==e||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(a.type)){n+=e||"";continue}}switch(a.type){case"space":n+=this.renderer.space(a);continue;case"hr":n+=this.renderer.hr(a);continue;case"heading":n+=this.renderer.heading(a);continue;case"code":n+=this.renderer.code(a);continue;case"table":n+=this.renderer.table(a);continue;case"blockquote":n+=this.renderer.blockquote(a);continue;case"list":n+=this.renderer.list(a);continue;case"html":n+=this.renderer.html(a);continue;case"paragraph":n+=this.renderer.paragraph(a);continue;case"text":{let t=a,r=this.renderer.text(t);for(;s+1<e.length&&"text"===e[s+1].type;)t=e[++s],r+="\n"+this.renderer.text(t);i?n+=this.renderer.paragraph({type:"paragraph",raw:r,text:r,tokens:[{type:"text",raw:r,text:r,escaped:!0}]}):n+=r;continue}default:{let e='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw Error(e)}}}return n}parseInline(e){var t,r;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.renderer,n="";for(let s=0;s<e.length;s++){let a=e[s];if(null!=(r=null==(t=this.options.extensions)?void 0:t.renderers)&&r[a.type]){let e=this.options.extensions.renderers[a.type].call({parser:this},a);if(!1!==e||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(a.type)){n+=e||"";continue}}switch(a.type){case"escape":case"text":n+=i.text(a);break;case"html":n+=i.html(a);break;case"link":n+=i.link(a);break;case"image":n+=i.image(a);break;case"strong":n+=i.strong(a);break;case"em":n+=i.em(a);break;case"codespan":n+=i.codespan(a);break;case"br":n+=i.br(a);break;case"del":n+=i.del(a);break;default:{let e='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw Error(e)}}}return n}constructor(e){g(this,"options"),g(this,"renderer"),g(this,"textRenderer"),this.options=e||X,this.options.renderer=this.options.renderer||new e4,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new e8}},te=(e5=class{preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?e6.lex:e6.lexInline}provideParser(){return this.block?e7.parse:e7.parseInline}constructor(e){g(this,"options"),g(this,"block"),this.options=e||X}},g(e5,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"])),e5),tt=new class{walkTokens(e,t){var r,i;let n=[];for(let s of e)switch(n=n.concat(t.call(this,s)),s.type){case"table":for(let e of s.header)n=n.concat(this.walkTokens(e.tokens,t));for(let e of s.rows)for(let r of e)n=n.concat(this.walkTokens(r.tokens,t));break;case"list":n=n.concat(this.walkTokens(s.items,t));break;default:{let e=s;null!=(i=null==(r=this.defaults.extensions)?void 0:r.childTokens)&&i[e.type]?this.defaults.extensions.childTokens[e.type].forEach(r=>{let i=e[r].flat(1/0);n=n.concat(this.walkTokens(i,t))}):e.tokens&&(n=n.concat(this.walkTokens(e.tokens,t)))}}return n}use(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(e=>{let t={...e};if(t.async=this.defaults.async||t.async||!1,e.extensions&&(e.extensions.forEach(e=>{if(!e.name)throw Error("extension name required");if("renderer"in e){let t=i.renderers[e.name];t?i.renderers[e.name]=function(){for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];let s=e.renderer.apply(this,i);return!1===s&&(s=t.apply(this,i)),s}:i.renderers[e.name]=e.renderer}if("tokenizer"in e){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw Error("extension level must be 'block' or 'inline'");let t=i[e.level];t?t.unshift(e.tokenizer):i[e.level]=[e.tokenizer],e.start&&("block"===e.level?i.startBlock?i.startBlock.push(e.start):i.startBlock=[e.start]:"inline"===e.level&&(i.startInline?i.startInline.push(e.start):i.startInline=[e.start]))}"childTokens"in e&&e.childTokens&&(i.childTokens[e.name]=e.childTokens)}),t.extensions=i),e.renderer){let r=this.defaults.renderer||new e4(this.defaults);for(let t in e.renderer){if(!(t in r))throw Error("renderer '".concat(t,"' does not exist"));if(["options","parser"].includes(t))continue;let i=e.renderer[t],n=r[t];r[t]=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=i.apply(r,t);return!1===a&&(a=n.apply(r,t)),a||""}}t.renderer=r}if(e.tokenizer){let r=this.defaults.tokenizer||new e9(this.defaults);for(let t in e.tokenizer){if(!(t in r))throw Error("tokenizer '".concat(t,"' does not exist"));if(["options","rules","lexer"].includes(t))continue;let i=e.tokenizer[t],n=r[t];r[t]=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=i.apply(r,t);return!1===a&&(a=n.apply(r,t)),a}}t.tokenizer=r}if(e.hooks){let r=this.defaults.hooks||new te;for(let t in e.hooks){if(!(t in r))throw Error("hook '".concat(t,"' does not exist"));if(["options","block"].includes(t))continue;let i=e.hooks[t],n=r[t];te.passThroughHooks.has(t)?r[t]=e=>{if(this.defaults.async)return Promise.resolve(i.call(r,e)).then(e=>n.call(r,e));let t=i.call(r,e);return n.call(r,t)}:r[t]=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];let a=i.apply(r,t);return!1===a&&(a=n.apply(r,t)),a}}t.hooks=r}if(e.walkTokens){let r=this.defaults.walkTokens,i=e.walkTokens;t.walkTokens=function(e){let t=[];return t.push(i.call(this,e)),r&&(t=t.concat(r.call(this,e))),t}}this.defaults={...this.defaults,...t}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return e6.lex(e,null!=t?t:this.defaults)}parser(e,t){return e7.parse(e,null!=t?t:this.defaults)}parseMarkdown(e){return(t,r)=>{let i={...r},n={...this.defaults,...i},s=this.onError(!!n.silent,!!n.async);if(!0===this.defaults.async&&!1===i.async)return s(Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||null===t)return s(Error("marked(): input parameter is undefined or null"));if("string"!=typeof t)return s(Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));n.hooks&&(n.hooks.options=n,n.hooks.block=e);let a=n.hooks?n.hooks.provideLexer():e?e6.lex:e6.lexInline,o=n.hooks?n.hooks.provideParser():e?e7.parse:e7.parseInline;if(n.async)return Promise.resolve(n.hooks?n.hooks.preprocess(t):t).then(e=>a(e,n)).then(e=>n.hooks?n.hooks.processAllTokens(e):e).then(e=>n.walkTokens?Promise.all(this.walkTokens(e,n.walkTokens)).then(()=>e):e).then(e=>o(e,n)).then(e=>n.hooks?n.hooks.postprocess(e):e).catch(s);try{n.hooks&&(t=n.hooks.preprocess(t));let e=a(t,n);n.hooks&&(e=n.hooks.processAllTokens(e)),n.walkTokens&&this.walkTokens(e,n.walkTokens);let r=o(e,n);return n.hooks&&(r=n.hooks.postprocess(r)),r}catch(e){return s(e)}}}onError(e,t){return r=>{if(r.message+="\nPlease report this to https://github.com/markedjs/marked.",e){let e="<p>An error occurred:</p><pre>"+eY(r.message+"",!0)+"</pre>";return t?Promise.resolve(e):e}if(t)return Promise.reject(r);throw r}}constructor(...e){g(this,"defaults",Y()),g(this,"options",this.setOptions),g(this,"parse",this.parseMarkdown(!0)),g(this,"parseInline",this.parseMarkdown(!1)),g(this,"Parser",e7),g(this,"Renderer",e4),g(this,"TextRenderer",e8),g(this,"Lexer",e6),g(this,"Tokenizer",e9),g(this,"Hooks",te),this.use(...e)}};function tr(e,t){return tt.parse(e,t)}tr.options=tr.setOptions=function(e){return tt.setOptions(e),tr.defaults=tt.defaults,X=tr.defaults,tr},tr.getDefaults=Y,tr.defaults=X,tr.use=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return tt.use(...t),tr.defaults=tt.defaults,X=tr.defaults,tr},tr.walkTokens=function(e,t){return tt.walkTokens(e,t)},tr.parseInline=tt.parseInline,tr.Parser=e7,tr.parser=e7.parse,tr.Renderer=e4,tr.TextRenderer=e8,tr.Lexer=e6,tr.lexer=e6.lex,tr.Tokenizer=e9,tr.Hooks=te,tr.parse=tr,tr.options,tr.setOptions,tr.use,tr.walkTokens,tr.parseInline,e7.parse,e6.lex;class ti{escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}generateSmartLabel(e){if(/^\d/.test(e))throw Error("Invalid field name '".concat(e,"': Field names cannot start with a number"));return e.includes("_")?e.split("_").map(e=>this.capitalizeWord(e)).join(" "):/[a-z][A-Z]/.test(e)?e.replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(e=>this.capitalizeWord(e)).join(" "):this.capitalizeWord(e)}capitalizeWord(e){return e&&e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}determineFormId(e,t){var r;return null!=(r=e.attributes)&&r.form?e.attributes.form:t||(t?void 0:this.generateDefaultFormId())}generateDefaultFormId(){return 0===this.formCounter?"formdown-form-default":"formdown-form-".concat(this.formCounter++)}ensureDefaultForm(e,t){return 0===t.length?e:0===e.length?[{id:this.generateDefaultFormId(),attributes:{}}]:e}createFormContext(e,t){let r=new Map;if(0===t.length)return r;let i=[...t].sort((e,t)=>(e.position||0)-(t.position||0)),n=i[0].id;return e.forEach(e=>{var s;if(null!=(s=e.attributes)&&s.form){let i=e.attributes.form;t.some(e=>e.id===i)?r.set(e,i):(console.warn("Form '".concat(i,"' referenced by field '").concat(e.name,"' does not exist. Using default form.")),r.set(e,n))}else{let t=this.findNearestForm(e,i);r.set(e,(null==t?void 0:t.id)||n)}}),r}findNearestForm(e,t){let r;if(!e.position)return t[0];for(let i of t)if(!i.position||i.position<=e.position)r=i;else break;return r||t[0]}generateHTML(e){this.usedIds.clear(),this.fieldCounter=0;let t=e.markdown?tr(e.markdown):"";return"string"==typeof t?this.processContentWithHiddenForms(t,e.forms,e.formDeclarations||[],e.datalistDeclarations||[]):this.generateLegacyHTML(e)}processContentWithHiddenForms(e,t,r,i){if(0===t.length&&0===r.length&&0===i.length)return e;let n=this.ensureDefaultForm(r,t),s=this.generateHiddenFormsHTML(n),a=this.generateDatalistHTML(i),o=this.createFormContext(t,n),l=[],c=[];t.forEach(e=>{e.inline?l.push(e):c.push(e)});let h=e;return l.forEach((e,r)=>{let i="\x3c!--FORMDOWN_FIELD_".concat(t.indexOf(e),"--\x3e"),n=o.get(e),s=this.generateInlineFieldHTML(e,n);h=h.replace(RegExp(i,"g"),s)}),c.forEach(e=>{let r="\x3c!--FORMDOWN_FIELD_".concat(t.indexOf(e),"--\x3e"),i=o.get(e),n=this.generateStandaloneFieldHTML(e,i);h=h.replace(RegExp(r,"g"),n)}),s+a+h}processContent(e,t){if(0===t.length)return e;let r=[],i=[];t.forEach(e=>{e.inline?r.push(e):i.push(e)});let n=e;return r.forEach((e,r)=>{let i="\x3c!--FORMDOWN_FIELD_".concat(t.indexOf(e),"--\x3e"),s=this.generateInlineFieldHTML(e);n=n.replace(RegExp(i,"g"),s)}),i.forEach(e=>{let r="\x3c!--FORMDOWN_FIELD_".concat(t.indexOf(e),"--\x3e"),i=this.generateSingleFieldFormHTML(e);n=n.replace(RegExp(r,"g"),i)}),n}processFieldPlaceholders(e,t){let r=e;return t.forEach((e,t)=>{let i=this.generateStandaloneFieldHTML(e);r=r.replace(RegExp("\x3c!--FORMDOWN_FIELD_".concat(t,"--\x3e"),"g"),i)}),r}generateLegacyHTML(e){return(e.markdown?tr(e.markdown):"")+this.generateFormHTML(e.forms)}generateStandaloneFieldHTML(e,t){if(e.inline)return this.generateInlineFieldHTML(e,t);let r=this.generateFieldHTML(e,t);if(r.includes('<div class="formdown-field">')||["submit","reset","button"].includes(e.type))return'\n<div class="formdown-field-container">\n'.concat(r,"\n</div>");let i=this.generateUniqueId(e.name,t),n=e.label||this.generateSmartLabel(e.name),s=this.determineFormId(e,t),a=e.required?" *":"";return'\n<div class="formdown-field-container">\n<div class="formdown-field">\n    <label for="'.concat(i,'">').concat(n).concat(a,"</label>\n    ").concat(r.replace(/id="[^"]*"/,'id="'.concat(i,'"')).replace(/form="[^"]*"/,s?'form="'.concat(s,'"'):""),"\n</div>\n</div>")}generateSingleFormHTML(e){if(console.warn("generateSingleFormHTML() is deprecated. Use Hidden Form Architecture instead."),0===e.length)return"";let t="form_multi_".concat(Math.random().toString(36).substr(2,9)),r=e.map(e=>this.generateFieldHTML(e,t)).join("\n");return'\n<form class="formdown-form" role="form" id="'.concat(t,'">\n').concat(r,"\n</form>")}generateSingleFieldFormHTML(e){console.warn("generateSingleFieldFormHTML() is deprecated and violates Hidden Form Architecture. Use generateStandaloneFieldHTML() instead.");let t="form_".concat(e.name,"_").concat(Math.random().toString(36).substr(2,9)),r=this.generateFieldHTML(e,t);return'\n<form class="formdown-form" role="form" id="'.concat(t,'">\n').concat(r,"\n</form>")}generateInlineFieldHTML(e,t){let{name:r,type:i,required:n,placeholder:s,attributes:a}=e,o=e.label||this.generateSmartLabel(r),l=this.determineFormId(e,t),c={"data-field-name":r,"data-field-type":i,"data-placeholder":s||o,class:"formdown-inline-field",contenteditable:"true",role:"textbox",...n&&{"data-required":"true"},...l&&{"data-form":l},...a&&a};return"<span ".concat(Object.entries(c).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" "),">").concat(o,"</span>")}generateFormHTML(e){if(console.warn("generateFormHTML() is deprecated. Use Hidden Form Architecture instead."),0===e.length)return"";let t="formdown-legacy-".concat(Math.random().toString(36).substr(2,9)),r=e.map(e=>this.generateFieldHTML(e,t)).join("\n");return'\n<form class="formdown-form" id="'.concat(t,'">\n').concat(r,"\n</form>")}generateFieldHTML(e,t){let{name:r,type:i,label:n,required:s,placeholder:a,attributes:o,options:l,description:c,errorMessage:h,pattern:d,format:u,allowOther:p,content:m,value:f}=e,g=Z.getFieldTypeRegistry().generateFieldHTML(e,{field:e,metadata:{formId:t}});if(g)return g;let b=n||this.generateSmartLabel(r),v="checkbox"===i?m||n||this.generateSmartLabel(r):b,y=this.generateUniqueId(r,t),w=c?"".concat(y,"-description"):void 0,k=h?"".concat(y,"-error"):void 0,x=this.determineFormId(e,t),E={name:"name",first_name:"given-name",last_name:"family-name",email:"email",phone:"tel",phone_number:"tel",password:"current-password",new_password:"new-password",confirm_password:"new-password",username:"username",company:"organization",address:"street-address",city:"address-level2",state:"address-level1",zip:"postal-code",country:"country",birth_date:"bday",birthday:"bday"}[r.toLowerCase()]||("email"===i?"email":"tel"===i?"tel":"password"===i?"current-password":void 0),_={id:y,name:r,...s&&{required:!0},...a&&{placeholder:a},...d&&{pattern:d},...u&&{format:u},...null!=f&&!["textarea","select","radio","checkbox","range","file"].includes(i)&&{value:f},...c&&{"aria-describedby":w},...h&&{"aria-describedby":"".concat(w?w+" ":"").concat(k)},...x&&{form:x},...E&&!(null!=o&&o.autocomplete)&&{autocomplete:E},...o},A=Object.entries(_).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" "),S=()=>{let e="";return c&&(e+='\n    <div id="'.concat(w,'" class="formdown-field-description">').concat(c,"</div>")),h&&(e+='\n    <div id="'.concat(k,'" class="formdown-field-error" role="alert">').concat(h,"</div>")),e};switch(i){case"textarea":let $=f?this.escapeHtml(String(f)):"";return'\n<div class="formdown-field">\n    <label for="'.concat(y,'">').concat(b).concat(s?" *":"","</label>\n    <textarea ").concat(A,">").concat($,"</textarea>").concat(S(),"\n</div>");case"select":let C=(null==l?void 0:l.map(e=>{let t=f&&String(f)===e?" selected":"";return'<option value="'.concat(e,'"').concat(t,">").concat(e,"</option>")}).join("\n"))||"",T=p?'\n        <option value="">'.concat(this.escapeHtml(e.otherLabel||"Other")," (please specify)</option>"):"",R=p?'\n    <input type="text" id="'.concat(y,'_other" placeholder="Please specify..." style="display: none; margin-top: 8px; padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; background: #fff; width: 100%; max-width: 300px;" class="formdown-other-input">'):"";return'\n<div class="formdown-field">\n    <label for="'.concat(y,'">').concat(b).concat(s?" *":"","</label>\n    <select ").concat(A," ").concat(p?"onchange=\"var container = this.closest('.formdown-field'); var otherInput = container ? container.querySelector('#".concat(y,"_other') : null; if(otherInput) { if(this.value === '') { otherInput.style.display = 'block'; otherInput.focus(); } else { otherInput.style.display = 'none'; } }\""):"",">\n        ").concat(C).concat(T,"\n    </select>").concat(R).concat(p?"\n    <script>\n        document.getElementById('".concat(y,"_other').addEventListener('input', function() {\n            var select = document.getElementById('").concat(y,"');\n            if (select && select.value === '') {\n                select.value = this.value;\n            }\n        });\n    <\/script>"):"").concat(S(),"\n</div>");case"radio":if(!l||0===l.length)return'\n<div class="formdown-field">\n    <label for="'.concat(y,'">').concat(b).concat(s?" *":"",'</label>\n    <input type="text" ').concat(A,">").concat(S(),"\n</div>");let F=l.map((e,i)=>{let n=this.generateUniqueId("".concat(r,"_").concat(i),t),a=s&&0===i,o=f&&String(f)===e;return'\n        <label for="'.concat(n,'" class="formdown-option-label">\n            <input type="radio" id="').concat(n,'" name="').concat(r,'" value="').concat(e,'"').concat(a?" required":"").concat(o?" checked":"").concat(w?' aria-describedby="'.concat(w,'"'):"").concat(p?" onchange=\"var container = this.closest('.formdown-field'); var otherInput = container ? container.querySelector('.formdown-other-input') : null; if(otherInput) { otherInput.style.display = 'none'; }\"":"",">\n            <span>").concat(e,"</span>\n        </label>")}).join("\n"),P=this.generateUniqueId("".concat(r,"_other_radio"),t),M=p?'\n        <label for="'.concat(P,'" class="formdown-option-label">\n            <input type="radio" id="').concat(P,'" name="').concat(r,'" value="" ').concat(w?'aria-describedby="'.concat(w,'"'):""," onchange=\"var container = this.closest('.formdown-field'); var otherInput = container ? container.querySelector('.formdown-other-input') : null; if(otherInput) { otherInput.style.display = 'inline-block'; otherInput.focus(); this.value = otherInput.value || ''; }\"\n            <span>").concat(this.escapeHtml(e.otherLabel||"Other"),':</span>\n            <input type="text" placeholder="Please specify..." style="display: none; margin-left: 8px; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; background: #fff;" class="formdown-other-input" onclick="var container = this.closest(\'.formdown-field\'); var otherRadio = container ? container.querySelector(\'#').concat(P,"') : null; if(otherRadio) { otherRadio.checked = true; otherRadio.value = this.value; }\" oninput=\"var container = this.closest('.formdown-field'); var otherRadio = container ? container.querySelector('#").concat(P,"') : null; if(otherRadio) { otherRadio.checked = true; otherRadio.value = this.value; otherRadio.dispatchEvent(new Event('change', {bubbles: true})); }\"\n        </label>"):"",I=(null==o?void 0:o.layout)==="vertical"?"radio-group vertical":"radio-group inline";return'\n<div class="formdown-field">\n    <fieldset '.concat(w?'aria-describedby="'.concat(w,'"'):"",">\n        <legend>").concat(b).concat(s?" *":"",'</legend>\n        <div class="').concat(I,'" role="radiogroup">\n').concat(F).concat(M,"\n        </div>\n    </fieldset>").concat(S(),"\n</div>");case"checkbox":if(l&&0!==l.length){let i=f?String(f).split(",").map(e=>e.trim()):[],n=l.map((e,n)=>{let a=this.generateUniqueId("".concat(r,"_").concat(n),t),o=s&&0===n,l=i.includes(e);return'\n        <label for="'.concat(a,'" class="formdown-option-label">\n            <input type="checkbox" id="').concat(a,'" name="').concat(r,'" value="').concat(e,'"').concat(o?" required":"").concat(l?" checked":"").concat(w?' aria-describedby="'.concat(w,'"'):"",">\n            <span>").concat(e,"</span>\n        </label>")}).join("\n"),a=this.generateUniqueId("".concat(r,"_other_checkbox"),t),c=p?'\n        <label for="'.concat(a,'" class="formdown-option-label">\n            <input type="checkbox" id="').concat(a,'" name="').concat(r,'" value="" ').concat(w?'aria-describedby="'.concat(w,'"'):""," onchange=\"var container = this.closest('.formdown-field'); var otherInput = container ? container.querySelector('.formdown-other-input') : null; if(otherInput) { if(this.checked) { otherInput.style.display = 'inline-block'; otherInput.focus(); this.value = otherInput.value || ''; } else { otherInput.style.display = 'none'; this.value = ''; } }\"\n            <span>").concat(this.escapeHtml(e.otherLabel||"Other"),':</span>\n            <input type="text" placeholder="Please specify..." style="display: none; margin-left: 8px; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; background: #fff;" class="formdown-other-input" onclick="var container = this.closest(\'.formdown-field\'); var otherCheckbox = container ? container.querySelector(\'#').concat(a,"') : null; if(otherCheckbox) { otherCheckbox.checked = true; otherCheckbox.value = this.value; }\" oninput=\"var container = this.closest('.formdown-field'); var otherCheckbox = container ? container.querySelector('#").concat(a,"') : null; if(otherCheckbox && otherCheckbox.checked) { otherCheckbox.value = this.value; otherCheckbox.dispatchEvent(new Event('change', {bubbles: true})); }\">\n        </label>"):"",h=(null==o?void 0:o.layout)==="vertical"?"checkbox-group vertical":"checkbox-group inline";return'\n<div class="formdown-field">\n    <fieldset '.concat(w?'aria-describedby="'.concat(w,'"'):"",">\n        <legend>").concat(b).concat(s?" *":"",'</legend>\n        <div class="').concat(h,'" role="group">\n').concat(n).concat(c,"\n        </div>\n    </fieldset>").concat(S(),"\n</div>")}{let e=f&&(!0===f||"true"===f||"true"===String(f).toLowerCase()),t={..._};delete t.id,delete t.name,delete t.form;let i=Object.entries(t).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" "),n=x?' form="'.concat(x,'"'):"";return'\n<div class="formdown-field">\n    <label for="'.concat(y,'" class="formdown-checkbox-label">\n        <input type="checkbox" id="').concat(y,'" name="').concat(r,'" value="true"').concat(s?" required":"").concat(e?" checked":"").concat(n," ").concat(i,">\n        <span>").concat(this.escapeHtml(v)).concat(s?" *":"","</span>\n    </label>").concat(S(),"\n</div>")}case"range":let O=(null==o?void 0:o.min)||0,L=(null==o?void 0:o.max)||100;null!=o&&o.step;let D=void 0!==f?f:(null==o?void 0:o.value)||Math.floor((O+L)/2);return'\n<div class="formdown-field">\n    <label for="'.concat(y,'">').concat(b).concat(s?" *":"",'</label>\n    <input type="range" ').concat(A,' value="').concat(D,'">\n    <output for="').concat(y,'" class="formdown-range-output">').concat(D,"</output>").concat(S(),"\n</div>");case"file":return'\n<div class="formdown-field">\n    <label for="'.concat(y,'">').concat(b).concat(s?" *":"",'</label>\n    <input type="file" ').concat(A,">").concat(S(),"\n</div>");case"color":return'\n<div class="formdown-field">\n    <label for="'.concat(y,'">').concat(b).concat(s?" *":"",'</label>\n    <input type="color" ').concat(A,">").concat(S(),"\n</div>");case"week":return'\n<div class="formdown-field">\n    <label for="'.concat(y,'">').concat(b).concat(s?" *":"",'</label>\n    <input type="week" ').concat(A,">").concat(S(),"\n</div>");case"month":return'\n<div class="formdown-field">\n    <label for="'.concat(y,'">').concat(b).concat(s?" *":"",'</label>\n    <input type="month" ').concat(A,">").concat(S(),"\n</div>");case"submit":let z=x?' form="'.concat(x,'"'):"",q=Object.entries(o||{}).filter(e=>{let[t]=e;return!["form"].includes(t)}).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" ");return'<button type="submit" id="'.concat(y,'"').concat(z).concat(q?" ".concat(q):"",">").concat(e.label||"Submit","</button>");case"reset":let B=x?' form="'.concat(x,'"'):"",H=Object.entries(o||{}).filter(e=>{let[t]=e;return!["form"].includes(t)}).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" ");return'<button type="reset" id="'.concat(y,'"').concat(B).concat(H?" ".concat(H):"",">").concat(e.label||"Reset","</button>");case"button":let N=(null==o?void 0:o.type)||"button",U=x?' form="'.concat(x,'"'):"",V=Object.entries(o||{}).filter(e=>{let[t]=e;return!["form","type"].includes(t)}).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" ");return'<button type="'.concat(N,'" id="').concat(y,'"').concat(U).concat(V?" ".concat(V):"",">").concat(e.label||"Button","</button>");case"image":let j=(null==o?void 0:o.src)||"",W=(null==o?void 0:o.alt)||e.label||"Submit",G=x?' form="'.concat(x,'"'):"",Q=Object.entries(o||{}).filter(e=>{let[t]=e;return!["form","src","alt","type"].includes(t)}).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" ");return'<input type="image" id="'.concat(y,'" src="').concat(j,'" alt="').concat(W,'"').concat(G).concat(Q?" ".concat(Q):"",">");default:return'\n<div class="formdown-field">\n    <label for="'.concat(y,'">').concat(b).concat(s?" *":"",'</label>\n    <input type="').concat(i,'" ').concat(A,">").concat(S(),"\n</div>")}}generateHiddenFormsHTML(e){return 0===e.length?"":e.map(e=>this.generateHiddenFormHTML(e)).join("")}generateHiddenFormHTML(e){let t=Object.entries(e.attributes).map(e=>{let[t,r]=e;return"boolean"==typeof r?r?t:"":"".concat(t,'="').concat(r,'"')}).filter(Boolean).join(" ");return'<form hidden id="'.concat(e.id,'" ').concat(t,"></form>\n")}generateDatalistHTML(e){return 0===e.length?"":e.map(e=>this.generateSingleDatalistHTML(e)).join("")}generateSingleDatalistHTML(e){let t=e.options.map(e=>'<option value="'.concat(this.escapeHtml(e),'">').concat(this.escapeHtml(e),"</option>")).join("");return'<datalist id="'.concat(e.id,'">').concat(t,"</datalist>\n")}generateUniqueId(e,t){let r=e;for(this.usedIds.has(r)&&t&&(r="".concat(t.replace(/^formdown-form-/,"").replace(/-/g,"_"),"_").concat(e)),this.usedIds.has(r)&&(r="".concat(e,"_").concat(++this.fieldCounter));this.usedIds.has(r);)r="".concat(e,"_").concat(++this.fieldCounter);return this.usedIds.add(r),r}constructor(){this.formCounter=0,this.fieldCounter=0,this.usedIds=new Set}}class tn{extractSchema(e){let t=this.parser.parse(e),r={};return t.fields.forEach((e,t)=>{r[e.name]=this.convertFieldToSchema(e,t)}),r}convertFieldToSchema(e,t){let r={type:e.type,label:e.label,required:e.required,position:t+1,isInline:e.inline};e.placeholder&&(r.placeholder=e.placeholder),void 0!==e.value&&(r.value=e.value),e.options&&(r.options=e.options),e.allowOther&&(r.allowOther=e.allowOther),e.format&&(r.format=e.format),e.pattern&&(r.pattern=e.pattern),e.description&&(r.description=e.description),e.errorMessage&&(r.errorMessage=e.errorMessage);let i=this.extractValidationRules(e.attributes||{}),n=this.extractFieldValidationRules(e);(i||n)&&(r.validation={...i,...n});let s=this.extractHtmlAttributes(e.attributes||{});return s&&Object.keys(s).length>0&&(r.htmlAttributes=s),r.layout=e.inline?"inline":"vertical",r}extractValidationRules(e){let t={},r=!1;return void 0!==e.min&&(t.min=e.min,r=!0),void 0!==e.max&&(t.max=e.max,r=!0),void 0!==e.step&&(t.step=e.step,r=!0),void 0!==e.minlength&&(t.minlength=e.minlength,r=!0),void 0!==e.maxlength&&(t.maxlength=e.maxlength,r=!0),void 0!==e.pattern&&(t.pattern=e.pattern,r=!0),void 0!==e.accept&&(t.accept=e.accept,r=!0),r?t:void 0}extractFieldValidationRules(e){let t={},r=!1;return void 0!==e.pattern&&(t.pattern=e.pattern,r=!0),r?t:void 0}extractHtmlAttributes(e){let t={},r=new Set(["min","max","step","minlength","maxlength","pattern","accept","required","placeholder","options","allow-other","format"]),i=!1;for(let[n,s]of Object.entries(e))r.has(n)||(t[n]=s,i=!0);return i?t:void 0}constructor(){this.parser=new J}}class ts{set(e,t){this.isUpdating||this.data[e]===t||(this.data[e]=t,this.notifyFieldChange(e,t),this.notifyChange(),this.validateField(e,t))}get(e){return e in this.data?this.data[e]:this.schema&&this.schema[e]&&void 0!==this.schema[e].value?this.schema[e].value:void 0}getAll(){return{...this.getSchemaDefaults(),...this.data}}updateAll(e){this.updateInternal(e,!0)}reset(){let e=this.getSchemaDefaults();this.data={},this.updateInternal(e,!0)}isDirty(){let e=this.getAll(),t=this.getSchemaDefaults();return JSON.stringify(e)!==JSON.stringify(t)}validateField(e,t){if(!this.schema||!this.schema[e])return[];let r=tu(void 0!==t?t:this.get(e),{...this.schema[e],name:e});return this.notifyValidation(e,r),r}validate(){if(!this.schema)return{isValid:!0,errors:[]};let e=function(e,t){let r=[];return Object.entries(t).forEach(t=>{let[i,n]=t,s=tu(e[i],{...n,name:i});r.push(...s)}),{isValid:0===r.length,errors:r}}(this.getAll(),this.schema),t=new Map;return e.errors.forEach(e=>{t.has(e.field)||t.set(e.field,[]),t.get(e.field).push(e)}),t.forEach((e,t)=>{this.notifyValidation(t,e)}),e}subscribe(e){return this.changeListeners.add(e),()=>this.changeListeners.delete(e)}subscribeToField(e){return this.fieldChangeListeners.add(e),()=>this.fieldChangeListeners.delete(e)}subscribeToValidation(e){return this.validationListeners.add(e),()=>this.validationListeners.delete(e)}updateSchema(e){this.schema=e,this.initializeFromSchema(),this.notifyChange()}getSchemaDefaults(){if(!this.schema)return{};let e={};return Object.entries(this.schema).forEach(t=>{let[r,i]=t;void 0!==i.value&&(e[r]=i.value)}),e}getModifiedFields(){return Object.keys(this.data)}clear(e){if(e in this.data){delete this.data[e];let t=this.get(e);this.notifyFieldChange(e,t),this.notifyChange()}}hasExplicitValue(e){return e in this.data}createSnapshot(){return{...this.data}}restoreSnapshot(e){this.data={...e},this.notifyChange()}updateInternal(e,t){if(!this.isUpdating){this.isUpdating=!0;try{let r=[];Object.entries(e).forEach(e=>{let[t,i]=e;this.data[t]!==i&&(this.data[t]=i,r.push({field:t,value:i}))}),t&&r.length>0&&(r.forEach(e=>{let{field:t,value:r}=e;this.notifyFieldChange(t,r),this.validateField(t,r)}),this.notifyChange())}finally{this.isUpdating=!1}}}initializeFromSchema(){this.schema&&Object.entries(this.schema).forEach(e=>{let[t,r]=e;void 0===r.value||t in this.data||(this.data[t]=r.value)})}notifyChange(){if(this.isUpdating)return;let e=this.getAll();this.changeListeners.forEach(t=>{try{t(e)}catch(e){console.error("Error in FormDataBinding change listener:",e)}})}notifyFieldChange(e,t){if(this.isUpdating)return;let r=this.getAll();this.fieldChangeListeners.forEach(i=>{try{i(e,t,r)}catch(e){console.error("Error in FormDataBinding field change listener:",e)}})}notifyValidation(e,t){this.validationListeners.forEach(r=>{try{r(e,t)}catch(e){console.error("Error in FormDataBinding validation listener:",e)}})}constructor(e=null,t={}){this.schema=e,this.data={},this.changeListeners=new Set,this.fieldChangeListeners=new Set,this.validationListeners=new Set,this.isUpdating=!1,this.initializeFromSchema(),this.updateInternal(t,!1)}}class ta{processCheckboxGroup(e,t){try{let r=t.querySelectorAll('input[type="checkbox"][name="'.concat(e,'"]'));if(0===r.length)return{success:!1,value:null,errors:["No checkboxes found"]};if(1===r.length&&"true"===r[0].value)return{success:!0,value:r[0].checked||!1};{let e=[];return r.forEach(r=>{if(r.checked)if(""===r.value&&r.id.includes("_other_checkbox")){let i=t.querySelector("#".concat(r.id.replace("_checkbox","_input")));i&&i.value.trim()&&e.push(i.value.trim())}else""!==r.value&&e.push(r.value)}),{success:!0,value:e}}}catch(e){return{success:!1,value:null,errors:["Checkbox processing error: ".concat(e)]}}}processRadioGroup(e,t){try{let r=t.querySelectorAll('input[type="radio"][name="'.concat(e,'"]'));if(0===r.length)return{success:!1,value:"",errors:["No radio buttons found"]};let i="";return r.forEach(e=>{if(e.checked)if(""===e.value&&e.id.includes("_other_radio")){let r=t.querySelector("#".concat(e.id.replace("_radio","_input")));r&&r.value.trim()&&(i=r.value.trim())}else i=e.value}),{success:!0,value:i}}catch(e){return{success:!1,value:"",errors:["Radio processing error: ".concat(e)]}}}processOtherOption(e,t){let r=!t.includes(e)&&""!==e.trim();return{hasOtherValue:r,otherValue:r?e:void 0,regularValues:t}}extractFieldValue(e,t){var r;if(e.hasAttribute("contenteditable"))return(null==(r=e.textContent)?void 0:r.trim())||"";switch(t){case"checkbox":return e.checked||!1;case"radio":return e.checked?e.value:"";case"number":case"range":let i=parseFloat(e.value);return isNaN(i)?0:i;case"date":case"time":case"datetime-local":case"month":case"week":default:return e.value||"";case"file":return e.value&&e.value.split("\\").pop()||""}}setFieldValue(e,t,r,i){try{if(e.hasAttribute("contenteditable"))return Array.isArray(t)?t.join(", "):String(t),e.textContent,!0;switch(r){case"checkbox":if(!Array.isArray(t))return!0;if(!t.includes(e.value)&&e.id.includes("_other_checkbox")&&""===e.value&&i){let r=e.name,n=i.querySelectorAll('input[type="checkbox"][name="'.concat(r,'"]:not([id*="_other_checkbox"])')).map(e=>e.value).filter(e=>""!==e);t.filter(e=>!n.includes(e)&&""!==e).length}return!0;case"radio":let n=String(t);if(e.value!==n&&e.id.includes("_other_radio")&&""===e.value&&i){let t=e.name,r=i.querySelectorAll('input[type="radio"][name="'.concat(t,'"]:not([id*="_other_radio"])')).map(e=>e.value).filter(e=>""!==e);n&&r.includes(n)}return!0;case"select":default:return Array.isArray(t)?t.join(", "):String(t),!0;case"number":case"range":let s="number"==typeof t?t:parseFloat(String(t));return!isNaN(s)}}catch(e){return!1}}validateFieldValue(e,t,r){let i=[];switch(null!=r&&r.required&&(null==e||""===e||Array.isArray(e)&&0===e.length)&&i.push("This field is required"),t){case"email":e&&"string"==typeof e&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||i.push("Please enter a valid email address"));break;case"url":if(e&&"string"==typeof e)try{new URL(e)}catch(e){i.push("Please enter a valid URL")}break;case"number":case"range":if(""!==e&&null!=e){let t=Number(e);isNaN(t)?i.push("Please enter a valid number"):((null==r?void 0:r.min)!==void 0&&t<r.min&&i.push("Value must be at least ".concat(r.min)),(null==r?void 0:r.max)!==void 0&&t>r.max&&i.push("Value must be at most ".concat(r.max)))}break;case"tel":e&&"string"==typeof e&&(/^[\d\s\-\+\(\)]+$/.test(e)||i.push("Please enter a valid phone number"))}return null!=r&&r.pattern&&e&&"string"==typeof e&&(new RegExp(r.pattern).test(e)||i.push(r.patternMessage||"Value does not match required format")),"string"==typeof e&&(null!=r&&r.minLength&&e.length<r.minLength&&i.push("Must be at least ".concat(r.minLength," characters")),null!=r&&r.maxLength&&e.length>r.maxLength&&i.push("Must be at most ".concat(r.maxLength," characters"))),{success:0===i.length,value:e,errors:i.length>0?i:void 0}}getFieldType(e){var t;switch(null==(t=e.type)?void 0:t.toLowerCase()){case"email":return"email";case"password":return"password";case"tel":return"tel";case"url":return"url";case"number":return"number";case"date":return"date";case"time":return"time";case"datetime-local":return"datetime-local";case"month":return"month";case"week":return"week";case"radio":return"radio";case"checkbox":return"checkbox";case"file":return"file";case"color":return"color";case"range":return"range";case"search":return"search";case"hidden":return"hidden";case"button":return"button";case"submit":return"submit";case"reset":return"reset";case"textarea":return"textarea";case"select":return"select";default:return"text"}}}class to{bindFieldToElement(e,t,r){return this.fieldRegistry[e]||(this.fieldRegistry[e]=new Set),this.fieldRegistry[e].add(t),this.setupElementEventHandlers(t,e,r),{fieldName:e,elements:this.fieldRegistry[e],unbind:()=>this.unbindElement(e,t)}}syncFormData(e,t){if(!this.isUpdatingUI){this.isUpdatingUI=!0;try{let r=Object.keys(this.fieldRegistry),i=Object.keys(e);[...new Set([...r,...i])].forEach(r=>{var i;let n=null!=(i=e[r])?i:"",s=this.fieldRegistry[r];s&&s.forEach(e=>{this.setElementValue(e,n,t)})})}finally{this.isUpdatingUI=!1}}}setupEventDelegation(e,t){}setupElementEventHandlers(e,t,r){let i=()=>{let i;if(!this.isUpdatingUI){if("checkbox"===e.type){let e=this.fieldProcessor.processCheckboxGroup(t,r);if(!e.success)return void console.error("Checkbox processing failed:",e.errors);i=e.value}else if("radio"===e.type){let e=this.fieldProcessor.processRadioGroup(t,r);if(!e.success)return void console.error("Radio processing failed:",e.errors);i=e.value}else{let t=this.fieldProcessor.getFieldType(e);i=this.fieldProcessor.extractFieldValue(e,t)}this.emitFieldChange(t,i,e)}};this.eventListeners.set(e,[{event:"input",handler:i},{event:"change",handler:i}])}setupOtherInputHandlers(e,t,r){let i=()=>{if(this.isUpdatingUI)return;let i=r.querySelector("#".concat(t,"_other_radio")),n=r.querySelector("#".concat(t,"_other_checkbox")),s=e.value.trim();if(i&&s)this.emitFieldChange(t,s,e);else if(n&&s){let i=this.fieldProcessor.processCheckboxGroup(t,r);i.success&&this.emitFieldChange(t,i.value,e)}};this.eventListeners.set(e,[{event:"input",handler:i},{event:"change",handler:i}])}setupContentEditableBehaviors(e,t){let{placeholder:r,selectOnFocus:i}=t,n=[{event:"focus",handler:()=>{var t;null==(t=e.textContent)||t.trim()}},{event:"blur",handler:()=>{var t;null!=(t=e.textContent)&&t.trim()}}];this.eventListeners.set(e,n)}setElementValue(e,t,r){let i=this.fieldProcessor.getFieldType(e);this.fieldProcessor.setFieldValue(e,t,i,r)}emitFieldChange(e,t,r){}unbindElement(e,t){this.fieldRegistry[e]&&(this.fieldRegistry[e].delete(t),0===this.fieldRegistry[e].size&&delete this.fieldRegistry[e]),this.eventListeners.get(t)&&this.eventListeners.delete(t)}getRegisteredFields(){return Object.keys(this.fieldRegistry)}getFieldElements(e){return this.fieldRegistry[e]}clearAllBindings(){Object.keys(this.fieldRegistry).forEach(e=>{this.fieldRegistry[e].forEach(t=>{this.unbindElement(e,t)})}),this.fieldRegistry={},this.eventListeners.clear()}validateAllFields(e,t){let r={};return Object.keys(this.fieldRegistry).forEach(i=>{let n=e[i],s=null==t?void 0:t[i];if(s){let e=this.fieldProcessor.getFieldType(s),t=this.fieldProcessor.validateFieldValue(n,e,s);r[i]=t}}),r}constructor(){this.fieldRegistry={},this.eventListeners=new Map,this.isUpdatingUI=!1,this.fieldProcessor=new ta}}class tl{registerCustomValidator(e,t){this.customValidators.set(e,t)}createValidationPipeline(e){return{rules:e,executeOrder:"fail-fast",skipOnError:!0}}async validateAsync(e,t,r){let i=this.getCacheKey(e.fieldName,t);if(this.validationCache.has(i))return this.validationCache.get(i);let n=this.buildValidationRules(e),s=this.createValidationPipeline(n),a=await this.executeValidationPipeline(s,e,t,r);return this.validationCache.set(i,a),a}async executeValidationPipeline(e,t,r,i){let n=[],s=[];switch(e.executeOrder){case"fail-fast":for(let a of e.rules){let o=await this.executeValidationRule(a,t,r,i);if(!o.isValid&&(n.push(...o.errors),e.skipOnError))break;o.warnings&&s.push(...o.warnings)}break;case"sequential":for(let a of e.rules){let e=await this.executeValidationRule(a,t,r,i);e.isValid||n.push(...e.errors),e.warnings&&s.push(...e.warnings)}break;case"parallel":(await Promise.all(e.rules.map(e=>this.executeValidationRule(e,t,r,i)))).forEach(e=>{e.isValid||n.push(...e.errors),e.warnings&&s.push(...e.warnings)})}return{isValid:0===n.length,errors:n,warnings:s.length>0?s:void 0}}async executeValidationRule(e,t,r,i){try{let n=await e.validator(r,t,i);return"boolean"==typeof n?{isValid:n,errors:n?[]:[{field:t.fieldName,code:e.name,message:e.message||"Validation failed for ".concat(t.fieldName),severity:"error"}]}:"string"==typeof n?{isValid:!1,errors:[{field:t.fieldName,code:e.name,message:n,severity:"error"}]}:n}catch(e){return{isValid:!1,errors:[{field:t.fieldName,code:"validation_error",message:"Validation error: ".concat(e),severity:"error"}]}}}buildValidationRules(e){let t=[];if(e.constraints.required&&t.push({name:"required",validator:t=>!(null==t||""===t||Array.isArray(t)&&0===t.length)||e.constraints.requiredMessage||"".concat(e.schema.label||e.fieldName," is required")}),t.push(...this.getTypeSpecificRules(e)),e.constraints.pattern&&t.push({name:"pattern",validator:t=>!t||new RegExp(e.constraints.pattern).test(String(t))||e.constraints.patternMessage||"Value does not match required format"}),(e.constraints.minLength||e.constraints.maxLength)&&t.push({name:"length",validator:t=>{if(!t)return!0;let r=String(t);return e.constraints.minLength&&r.length<e.constraints.minLength?"Must be at least ".concat(e.constraints.minLength," characters"):!e.constraints.maxLength||!(r.length>e.constraints.maxLength)||"Must be at most ".concat(e.constraints.maxLength," characters")}}),e.constraints.customValidator&&this.customValidators.has(e.constraints.customValidator)){let r=this.customValidators.get(e.constraints.customValidator);t.push({name:e.constraints.customValidator,validator:r,async:!0})}return e.constraints.serverValidation&&t.push({name:"server_validation",validator:(e,t,r)=>this.validateOnServer(e,t,r),async:!0}),t}getTypeSpecificRules(e){let t=[];switch(e.fieldType){case"email":t.push({name:"email_format",validator:e=>!e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e))||"Please enter a valid email address"});break;case"url":t.push({name:"url_format",validator:e=>{if(!e)return!0;try{return new URL(String(e)),!0}catch(e){return"Please enter a valid URL"}}});break;case"number":case"range":t.push({name:"number_format",validator:(e,t)=>{if(!e&&0!==e)return!0;let r=Number(e);return isNaN(r)?"Please enter a valid number":void 0!==t.constraints.min&&r<t.constraints.min?"Value must be at least ".concat(t.constraints.min):void 0===t.constraints.max||!(r>t.constraints.max)||"Value must be at most ".concat(t.constraints.max)}});break;case"tel":t.push({name:"phone_format",validator:e=>!e||/^[\d\s\-\+\(\)]+$/.test(String(e))||"Please enter a valid phone number"});break;case"date":t.push({name:"date_format",validator:(e,t)=>{if(!e)return!0;let r=new Date(String(e));if(isNaN(r.getTime()))return"Please enter a valid date";if(t.constraints.min){let e=new Date(t.constraints.min);if(r<e)return"Date must be after ".concat(e.toLocaleDateString())}if(t.constraints.max){let e=new Date(t.constraints.max);if(r>e)return"Date must be before ".concat(e.toLocaleDateString())}return!0}})}return t}async validateOnServer(e,t,r){let i=t.constraints.serverValidation;return new Promise(n=>{let s=this.asyncValidationTimers.get(t.fieldName);s&&clearTimeout(s);let a=setTimeout(async()=>{try{let s=await this.makeValidationRequest(e,t,r,i);n(s)}catch(e){n({isValid:!1,errors:[{field:t.fieldName,code:"server_error",message:"Server validation failed",severity:"error"}]})}},i.debounceMs||500);this.asyncValidationTimers.set(t.fieldName,a)})}async makeValidationRequest(e,t,r,i){return t.fieldName,{isValid:!0,errors:[]}}validateCrossFields(e,t){let r=[];return t.forEach(t=>{try{let i=t.validator(e);"string"==typeof i?r.push({field:t.fields[0],code:t.name,message:i,severity:"error"}):"object"!=typeof i||i.isValid||r.push(...i.errors)}catch(e){r.push({field:t.fields[0],code:"cross_field_error",message:"Cross-field validation error: ".concat(e),severity:"error"})}}),{isValid:0===r.length,errors:r}}clearCache(e){if(e)for(let t of this.validationCache.keys())t.startsWith("".concat(e,":"))&&this.validationCache.delete(t);else this.validationCache.clear()}getCacheKey(e,t){return"".concat(e,":").concat(JSON.stringify(t))}dispose(){this.asyncValidationTimers.forEach(e=>clearTimeout(e)),this.asyncValidationTimers.clear(),this.validationCache.clear()}constructor(){this.customValidators=new Map,this.validationCache=new Map,this.asyncValidationTimers=new Map}}let tc={FORM_INITIALIZED:"formdown:form:initialized",FORM_READY:"formdown:form:ready",FORM_DESTROYED:"formdown:form:destroyed",FIELD_CHANGE:"formdown:field:change",FIELD_INVALID:"formdown:field:invalid",FIELD_VALID:"formdown:field:valid",DATA_CHANGE:"formdown:data:change",DATA_SYNC:"formdown:data:sync",VALIDATION_START:"formdown:validation:start",VALIDATION_SUCCESS:"formdown:validation:success",VALIDATION_ERROR:"formdown:validation:error",UI_RENDER_COMPLETE:"formdown:ui:render:complete",UI_UPDATE:"formdown:ui:update",EDITOR_CONTENT_CHANGE:"formdown:editor:content:change",EDITOR_PREVIEW_UPDATE:"formdown:editor:preview:update",EDITOR_ERROR:"formdown:editor:error",EXTENSION_LOADED:"formdown:extension:loaded",SCHEMA_CHANGE:"formdown:schema:change"};class th{createEventBus(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"bus_".concat(Date.now()),t=new Map,r={emit:(r,i)=>{let n=t.get(r);n&&n.forEach(e=>{try{e(i)}catch(e){console.error("Error in event handler for ".concat(r,":"),e)}}),this.globalEventConfig.bubbleEvents&&"global"!==e&&this.globalEventBus.emit(r,{source:e,data:i})},on:(e,r)=>(t.has(e)||t.set(e,new Set),t.get(e).add(r),()=>{var i;null==(i=t.get(e))||i.delete(r)}),off:(e,r)=>{var i;null==(i=t.get(e))||i.delete(r)},once:(e,t)=>{let i=n=>{t(n),r.off(e,i)};return r.on(e,i)},clear:()=>{t.clear()}};return this.eventBuses.set(e,r),r}bridgeComponentEvents(e,t,r){let i="".concat(e.id,"_to_").concat(t.id),n={source:e,target:t,eventMappings:r,isActive:!0};return r.forEach(r=>{e.on&&e.on(r.sourceEvent,e=>{if(!n.isActive||r.condition&&!r.condition(e))return;let i=e;if(r.transformer)try{i=r.transformer(e)}catch(e){console.error("Error in event transformer for ".concat(r.sourceEvent,":"),e);return}t.emit&&t.emit(r.targetEvent,i)})}),this.eventBridges.set(i,n),i}setupGlobalEventHandling(){this.globalEventConfig.enableFormEvents&&this.setupFormEventHandlers(),this.globalEventConfig.enableFieldEvents&&this.setupFieldEventHandlers(),this.globalEventConfig.enableValidationEvents&&this.setupValidationEventHandlers(),this.globalEventConfig.enableLifecycleEvents&&this.setupLifecycleEventHandlers()}setupFormEventHandlers(){this.globalEventBus.on(tc.FORM_INITIALIZED,e=>{console.debug("Form initialized:",e)}),this.globalEventBus.on(tc.DATA_CHANGE,e=>{this.globalEventBus.emit(tc.DATA_SYNC,e)}),this.globalEventBus.on(tc.FORM_DESTROYED,e=>{this.cleanupFormEventBridges(null==e?void 0:e.formId)})}setupFieldEventHandlers(){this.globalEventBus.on(tc.FIELD_CHANGE,e=>{this.globalEventBus.emit(tc.VALIDATION_START,{fieldName:e.fieldName,value:e.value})}),this.globalEventBus.on(tc.FIELD_INVALID,e=>{console.debug("Field validation error:",e)})}setupValidationEventHandlers(){this.globalEventBus.on(tc.VALIDATION_ERROR,e=>{console.debug("Validation error:",e)}),this.globalEventBus.on(tc.VALIDATION_SUCCESS,e=>{console.debug("Validation success:",e)})}setupLifecycleEventHandlers(){this.globalEventBus.on(tc.UI_RENDER_COMPLETE,e=>{this.globalEventBus.emit(tc.FORM_READY,e)}),this.globalEventBus.on(tc.EXTENSION_LOADED,e=>{console.debug("Extension loaded:",e)})}createCoreUIBridge(e,t){let r=[{sourceEvent:tc.DATA_CHANGE,targetEvent:tc.UI_UPDATE,transformer:e=>({formData:e.formData})},{sourceEvent:tc.VALIDATION_ERROR,targetEvent:tc.FIELD_INVALID,transformer:e=>({fieldName:e.field,errors:e.errors})},{sourceEvent:tc.VALIDATION_SUCCESS,targetEvent:tc.FIELD_VALID,transformer:e=>({fieldName:e.field})},{sourceEvent:tc.FIELD_CHANGE,targetEvent:tc.DATA_CHANGE,transformer:e=>({fieldName:e.fieldName,value:e.value,formData:e.formData})}];return this.bridgeComponentEvents(e,t,r)}createCoreEditorBridge(e,t){let r=[{sourceEvent:tc.SCHEMA_CHANGE,targetEvent:tc.EDITOR_PREVIEW_UPDATE,transformer:e=>({schema:e.schema})},{sourceEvent:tc.EDITOR_CONTENT_CHANGE,targetEvent:tc.SCHEMA_CHANGE,transformer:e=>({content:e.content})},{sourceEvent:tc.VALIDATION_ERROR,targetEvent:tc.EDITOR_ERROR,transformer:e=>({errors:e.errors})}];return this.bridgeComponentEvents(e,t,r)}getGlobalEventBus(){return this.globalEventBus}getEventBus(e){return this.eventBuses.get(e)}removeBridge(e){let t=this.eventBridges.get(e);t&&(t.isActive=!1,this.eventBridges.delete(e))}cleanupFormEventBridges(e){if(e)for(let[t,r]of this.eventBridges.entries())t.includes(e)&&this.removeBridge(t)}getActiveBridges(){return Array.from(this.eventBridges.values()).filter(e=>e.isActive)}dispose(){this.eventBuses.forEach(e=>e.clear()),this.eventBuses.clear(),this.eventBridges.forEach(e=>{e.isActive=!1}),this.eventBridges.clear(),this.globalEventBus.clear()}configureEvents(e){this.globalEventConfig={...this.globalEventConfig,...e},this.setupGlobalEventHandling()}getEventStats(){return{totalEventBuses:this.eventBuses.size,totalBridges:this.eventBridges.size,activeBridges:this.getActiveBridges().length}}constructor(e={}){this.eventBuses=new Map,this.eventBridges=new Map,this.globalEventConfig={enableFormEvents:!0,enableFieldEvents:!0,enableValidationEvents:!0,enableLifecycleEvents:!0,bubbleEvents:!0,eventPrefix:"formdown",...e},this.globalEventBus=this.createEventBus("global")}}class td{parse(e){return this.content=e,this.parsedContent=this.parser.parseFormdown(e),this.schema=new tn().extractSchema(e),this.dataBinding=new ts(this.schema),this.setupDataBindingEvents(),this.parsedContent}render(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.parsedContent)throw Error("No content parsed. Call parse() first.");return"json"===e.outputFormat?JSON.stringify(this.parsedContent,null,2):this.generator.generateHTML(this.parsedContent)}getSchema(){return this.schema?{...this.schema}:null}getData(){return this.dataBinding?this.dataBinding.getAll():{}}setFieldValue(e,t){this.dataBinding&&this.dataBinding.set(e,t)}updateData(e){this.dataBinding&&this.dataBinding.updateAll(e)}reset(){this.dataBinding&&(this.dataBinding.reset(),this.emit("form-reset",{formData:this.getData()}))}validate(){return this.dataBinding?this.dataBinding.validate():{isValid:!0,errors:[]}}getDefaultValues(){return this.dataBinding?this.dataBinding.getSchemaDefaults():{}}isDirty(){return!!this.dataBinding&&this.dataBinding.isDirty()}getField(e){return this.parsedContent&&this.parsedContent.forms.find(t=>t.name===e)||null}getFields(){var e;return(null==(e=this.parsedContent)?void 0:e.forms)||[]}getFormDeclarations(){var e;return(null==(e=this.parsedContent)?void 0:e.formDeclarations)||[]}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t)}off(e,t){let r=this.eventListeners.get(e);r&&r.delete(t)}emit(e,t){let r=this.eventListeners.get(e);r&&r.forEach(r=>{try{r(t)}catch(t){console.error("Error in FormManager event handler for '".concat(e,"':"),t)}})}setupDataBindingEvents(){this.dataBinding&&(this.dataBinding.subscribeToField((e,t,r)=>{this.emit("data-change",{field:e,value:t,formData:r})}),this.dataBinding.subscribeToValidation((e,t)=>{t.length>0&&this.emit("validation-error",{field:e,errors:t})}))}clone(){return new td(this.options)}export(){return{content:this.content,data:this.getData(),schema:this.getSchema(),options:{...this.options}}}import(e){e.options&&(Object.assign(this.options,e.options),this.parser=new J(this.options)),this.parse(e.content),e.data&&this.updateData(e.data)}createFieldProcessor(){return this.fieldProcessor||(this.fieldProcessor=new ta),this.fieldProcessor}createDOMBinder(){return this.domBinder||(this.domBinder=new to),this.domBinder}createValidationManager(){return this.validationManager||(this.validationManager=new tl),this.validationManager}createEventOrchestrator(){return this.eventOrchestrator||(this.eventOrchestrator=new th),this.eventOrchestrator}processFieldValue(e,t){let r=this.createFieldProcessor(),i=this.getField(e);if(!i)return console.warn("Field ".concat(e," not found in schema")),t;let n=r.getFieldType({id:e,name:e,value:String(t),type:i.type||"text",hasAttribute:()=>!1,getAttribute:()=>null});return r.extractFieldValue({id:e,name:e,value:String(t),type:i.type||"text",hasAttribute:()=>!1,getAttribute:()=>null},n)}async validateFieldWithPipeline(e,t){let r=this.createValidationManager(),i=this.getField(e),n=this.createFieldProcessor();if(!i)return{isValid:!1,errors:["Field ".concat(e," not found")]};let s=n.getFieldType({id:e,name:e,value:String(t),type:i.type||"text",hasAttribute:()=>!1,getAttribute:()=>null}),a={fieldName:e,fieldType:s,constraints:i.attributes||{},schema:i};return await r.validateAsync(a,t,this.getData())}setupComponentBridge(e){let t=this.createEventOrchestrator(),r={id:"formdown-core",type:"core",emit:(e,t)=>{"formdown:data:change"===e?this.emit("data-change",t):"formdown:validation:error"===e&&this.emit("validation-error",t)},on:(e,t)=>("formdown:field:change"===e&&this.on("data-change",t),()=>{})};return"ui"===e.type?t.createCoreUIBridge(r,e):"editor"===e.type?t.createCoreEditorBridge(r,e):t.bridgeComponentEvents(r,e,[])}renderToTemplate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.parsedContent)throw Error("No content parsed. Call parse() first.");return{fields:this.getFields(),formDeclarations:this.getFormDeclarations(),schema:this.getSchema(),data:this.getData(),html:this.render(),options:e}}handleUIEvent(e,t){t||(t=this.createDOMBinder());let r=e.target,i=(null==r?void 0:r.name)||(null==r?void 0:r.id);if(i&&"change"===e.type){let e=this.createFieldProcessor(),t=e.getFieldType(r),n=e.extractFieldValue(r,t);this.setFieldValue(i,n)}}createPreviewTemplate(e){try{let t=new td(this.options);return t.parse(e),{html:t.render(),errors:[],schema:t.getSchema(),fields:t.getFields()}}catch(e){return{html:"",errors:[String(e)],schema:null,fields:[]}}}getCoreModules(){return{fieldProcessor:this.fieldProcessor,domBinder:this.domBinder,validationManager:this.validationManager,eventOrchestrator:this.eventOrchestrator}}dispose(){this.validationManager&&(this.validationManager.dispose(),this.validationManager=null),this.domBinder&&(this.domBinder.clearAllBindings(),this.domBinder=null),this.eventOrchestrator&&(this.eventOrchestrator.dispose(),this.eventOrchestrator=null),this.fieldProcessor=null,this.eventListeners.clear(),this.dataBinding&&(this.dataBinding=null)}constructor(e={}){this.options=e,this.content="",this.parsedContent=null,this.schema=null,this.dataBinding=null,this.eventListeners=new Map,this.fieldProcessor=null,this.domBinder=null,this.validationManager=null,this.eventOrchestrator=null,this.parser=new J(e),this.generator=new ti,[].forEach(e=>{this.eventListeners.set(e,new Set)})}}function tu(e,t){let r=[];return t.required&&(!e||""===e.toString().trim())&&r.push({field:t.name||"field",message:t.errorMessage||"".concat(t.label||"Field"," is required")}),r}let tp=class e{static getInstance(){return e.instance||(e.instance=new e),e.instance}async initialize(){if(!this.initialized)try{await Z.initialize(),this.setupEditorHooks(),this.initialized=!0}catch(e){console.debug("Extension system already initialized or error:",e)}}setupEditorHooks(){K({name:"pre-parse",priority:1,handler:this.handlePreParse.bind(this)}),K({name:"post-parse",priority:1,handler:this.handlePostParse.bind(this)}),K({name:"field-validate",priority:1,handler:this.handleFieldValidate.bind(this)})}handlePreParse(e){return e}handlePostParse(e){return e}handleFieldValidate(e,t){return{valid:!0,message:""}}async registerEditorPlugin(e){await Q(e)}getExtensionStats(){return Z.getStats()}async executeEditorHooks(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return Z.executeHooks(e,t,...i)}async validateContent(e){try{let t=await this.executeEditorHooks("field-validate",{input:e},e),r=[];return t.forEach(e=>{e&&!e.valid&&e.message&&r.push(e.message)}),{isValid:0===r.length,errors:r}}catch(e){return{isValid:!1,errors:[e instanceof Error?e.message:"Validation error"]}}}constructor(){this.initialized=!1}};tp.instance=null;let tm=tp,tf=tm.getInstance();var tg=Object.defineProperty,tb=Object.getOwnPropertyDescriptor,tv=(e,t,r,i)=>{for(var n,s=i>1?void 0:i?tb(t,r):t,a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i?n(t,r,s):n(s))||s);return i&&s&&tg(t,r,s),s},ty='# Contact Form\n\nFill out the form below to get in touch:\n\n@full_name: [text required placeholder="Enter your full name"]\n@email_address: [email required]\n@phone_number: [tel]\n@message: [textarea rows=4 placeholder="Your message here..."]\n@contact_method: [radio options="Email, Phone, Either"]\n@newsletter_signup: [checkbox]';let tw=class extends n.WF{get data(){if(this.formManager){let e=this.formManager.getData();if(e&&Object.keys(e).length>0)return e}return this._data}set data(e){let t={};null!=e&&"object"==typeof e&&(t="formData"in e&&"object"==typeof e.formData?{...e.formData}:{...e}),this._data=t,this.formManager&&this.formManager.updateData(t),this.requestUpdate("data")}async connectedCallback(){var e;super.connectedCallback(),this.formManager=new td,this.formManager.setupComponentBridge({id:"formdown-editor",type:"editor",emit:(e,t)=>{this.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,composed:!0}))},on:(e,t)=>()=>{}}),this.formManager.on("data-change",e=>{let{formData:t}=e;this._data=t,this.requestUpdate("data"),this.dispatchEvent(new CustomEvent("formdown-data-update",{detail:t,bubbles:!0,composed:!0}))}),this._data&&Object.keys(this._data).length>0&&this.formManager.updateData(this._data);try{await tf.initialize()}catch(e){console.debug("Extension system initialization:",e)}this.content===ty&&null!=(e=this.textContent)&&e.trim()&&(this.content=this.textContent.trim(),this.textContent=""),await this.updateParseResult()}willUpdate(e){var t;if(super.willUpdate(e),e.has("content")){let e=null==(t=this.shadowRoot)?void 0:t.querySelector(".editor-textarea");if(e&&document.activeElement===e)return}}render(){return(0,n.qy)(c(),this.mode,"view"!==this.mode?(0,n.qy)(a(),this.header?(0,n.qy)(s()):"",this.renderToolbar(),this.content,this.handleInput,this.handleKeydown,this.placeholder,this.content.split("\n").length,this.content.length):"","edit"!==this.mode?(0,n.qy)(l(),this.header?(0,n.qy)(o()):"",this.renderErrors()):"")}updated(e){var t;if(super.updated(e),e.has("mode")){let e=this._data;"edit"!==this.mode&&(this.updateFormdownUI(),e&&Object.keys(e).length>0&&setTimeout(()=>{var t;let r=null==(t=this.shadowRoot)?void 0:t.querySelector("#formdown-ui-container"),i=null==r?void 0:r.querySelector("formdown-ui");i&&(i.data=e)},0));return}if("edit"!==this.mode&&(e.has("content")||e.has("parseResult"))&&this.updateFormdownUI(),e.has("data")&&"edit"!==this.mode){let e=null==(t=this.shadowRoot)?void 0:t.querySelector("#formdown-ui-container"),r=null==e?void 0:e.querySelector("formdown-ui");r&&(r.data=this.data||{})}}firstUpdated(e){super.firstUpdated(e),"edit"!==this.mode&&this.updateFormdownUI()}updateFormdownUI(){var e;let t=null==(e=this.shadowRoot)?void 0:e.querySelector("#formdown-ui-container");if(t)try{if(!customElements.get("formdown-ui")){t.innerHTML='<div style="padding: 1rem; color: #666;">Loading form preview...</div>';return}let e=t.querySelector("formdown-ui");e||((e=document.createElement("formdown-ui")).style.width="100%",e.style.height="100%",e.addEventListener("formdown-data-update",e=>{var t;let r=(null==(t=e.detail)?void 0:t.formData)||e.detail;this.formManager.updateData(r)}),e.addEventListener("formdown-change",e=>{this.dispatchEvent(new CustomEvent("formdown-change",{detail:e.detail,bubbles:!0,composed:!0}))}),t.appendChild(e)),e.setAttribute("content",this.content),this._data&&Object.keys(this._data).length>0&&(e.data=this._data)}catch(e){t.innerHTML='<div style="padding: 1rem; color: #dc2626;">Preview Error: '.concat(e instanceof Error?e.message:"Unknown error","</div>")}}handleInput(e){let t=e.target;this.content=t.value,this.updateParseResult(),this.dispatchContentChange()}handleKeydown(e){if("Tab"===e.key){e.preventDefault();let t=e.target,r=t.selectionStart,i=t.selectionEnd,n=t.value.substring(0,r),s=t.value.substring(i);t.value=n+"  "+s,t.selectionStart=t.selectionEnd=r+2,this.content=t.value,this.updateParseResult(),this.dispatchContentChange()}}insertSnippet(e){var t;let r=null==(t=this.shadowRoot)?void 0:t.querySelector(".editor-textarea");if(!r)return;let i=r.selectionStart,n=r.selectionEnd,s=this.content.substring(0,i),a=this.content.substring(n);this.content=s+e+a,this.updateParseResult(),this.dispatchContentChange(),this.updateComplete.then(()=>{r.focus(),r.selectionStart=r.selectionEnd=i+e.length})}async updateParseResult(){try{this.formManager.parse(this.content);let e=await tf.validateContent(this.content),t=this.formManager.getFields();this.parseResult={fields:t||[],errors:e.errors.map(e=>({line:0,message:e}))}}catch(e){this.parseResult={fields:[],errors:[{line:0,message:e instanceof Error?e.message:"Parse error"}]}}}dispatchContentChange(){this.dispatchEvent(new CustomEvent("contentChange",{detail:{content:this.content},bubbles:!0,composed:!0}))}renderToolbar(){return this.toolbar?(0,n.qy)(d(),[{name:"Text",snippet:"@name: [text required]"},{name:"Textarea",snippet:"@bio: [textarea rows=4]"},{name:"Radio",snippet:'@gender: [radio required options="Option 1,Option 2"]'},{name:"Check",snippet:'@interests: [checkbox options="Item 1,Item 2"]'},{name:"Select",snippet:'@country: [select required options="USA,Canada,UK"]'},{name:"Range",snippet:'@volume: [range min=0 max=100 unit="%"]'}].map(e=>(0,n.qy)(h(),()=>this.insertSnippet(e.snippet),e.name))):""}renderErrors(){return 0===this.parseResult.errors.length?"":(0,n.qy)(p(),this.parseResult.errors.map(e=>(0,n.qy)(u(),e)))}validate(){var e;let t=null==(e=this.shadowRoot)?void 0:e.querySelector(".preview-content"),r=null==t?void 0:t.querySelector("formdown-ui");return r&&"function"==typeof r.validate?r.validate():{isValid:!1,errors:[{field:"general",message:"FormdownUI component not found for validation"}]}}getFormData(){var e;let t=null==(e=this.shadowRoot)?void 0:e.querySelector(".preview-content"),r=null==t?void 0:t.querySelector("formdown-ui");return r&&"function"==typeof r.getFormData?r.getFormData():{}}constructor(){super(...arguments),this.content=ty,this.mode="split",this.placeholder='Try FormDown with smart labels! Field names like "full_name" become "Full Name" automatically...',this.header=!1,this.toolbar=!0,this._data={},this.parseResult={fields:[],errors:[]}}};tw.styles=(0,n.AH)(m(),(0,n.iz)(":host{display:block;font-family:system-ui,-apple-system,sans-serif;height:600px;border:1px solid var(--theme-border, #d1d5db);border-radius:.375rem;overflow:hidden;background:var(--theme-bg-primary, #ffffff)}.editor-container{display:flex;height:100%;background:var(--theme-bg-primary, #ffffff)}.editor-panel{flex:1;display:flex;flex-direction:column;border-right:1px solid var(--theme-border, #d1d5db);background:var(--theme-bg-primary, #ffffff)}.preview-panel{flex:1;display:flex;flex-direction:column;background-color:var(--theme-bg-secondary, #f9fafb)}.panel-header{padding:.75rem 1rem;background-color:var(--theme-bg-secondary, #f3f4f6);border-bottom:1px solid var(--theme-border, #d1d5db);font-weight:500;font-size:.875rem;color:var(--theme-text-primary, #374151)}.editor-textarea{flex:1;width:100%;border:none;outline:none;padding:1rem;font-family:Monaco,Menlo,Ubuntu Mono,monospace;font-size:.875rem;line-height:1.5;resize:none;background-color:var(--theme-bg-primary, white);color:var(--theme-text-primary, #1f2937);height:0}.preview-content{flex:1;padding:1rem;overflow-y:auto;height:0}.toolbar{display:flex;padding:.5rem;background-color:var(--theme-bg-secondary, #f9fafb);border-bottom:1px solid var(--theme-border, #d1d5db);gap:.5rem}.toolbar-button{padding:.25rem .5rem;background-color:var(--theme-bg-primary, white);border:1px solid var(--theme-border, #d1d5db);border-radius:.25rem;font-size:.75rem;cursor:pointer;transition:background-color .15s ease-in-out;color:var(--theme-text-primary, #1f2937)}.toolbar-button:hover{background-color:var(--theme-bg-secondary, #f3f4f6)}.stats{padding:.5rem 1rem;background-color:var(--theme-bg-secondary, #f9fafb);border-top:1px solid var(--theme-border, #d1d5db);font-size:.75rem;color:var(--theme-text-secondary, #6b7280);display:flex;justify-content:space-between}.error-list{background-color:var(--theme-error-bg, #fef2f2);border-left:4px solid var(--theme-error, #dc2626);padding:1rem;margin-bottom:1rem}.error-item{color:var(--theme-error, #dc2626);font-size:.875rem;margin-bottom:.25rem}.mode-edit .preview-panel,.mode-view .editor-panel{display:none}.mode-edit .editor-panel{border-right:none}.mode-view{overflow-y:auto}.mode-view .preview-panel{border-right:none;height:auto;min-height:100%}@media (max-width: 768px){.editor-container{flex-direction:column}.editor-panel{border-right:none;border-bottom:1px solid var(--theme-border, #d1d5db)}}")),tv([q()],tw.prototype,"content",2),tv([q({type:String})],tw.prototype,"mode",2),tv([q({type:String})],tw.prototype,"placeholder",2),tv([q({type:Boolean})],tw.prototype,"header",2),tv([q({type:Boolean})],tw.prototype,"toolbar",2),tv([B()],tw.prototype,"_data",2),tv([B()],tw.prototype,"parseResult",2),tw=tv([(e=>(t,r)=>{void 0!==r?r.addInitializer(()=>{customElements.define(e,t)}):customElements.define(e,t)})("formdown-editor")],tw);let tk=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.createElement("formdown-editor");return t.content&&(r.content=t.content),void 0!==t.showPreview&&(r.showPreview=t.showPreview),void 0!==t.showToolbar&&(r.showToolbar=t.showToolbar),t.placeholder&&(r.placeholder=t.placeholder),e.appendChild(r),r},tx=()=>{}}}]);